webpackJsonpjwplayer([2],{8:function(g,d,f){var c,b;c=[f(1),f(11),f(2),f(13),f(12)],b=function(aj,Q,X,af,an){function ab(k){if(this._currentTextTrackIndex=-1,k){if(this._textTracks?(this._textTracks=aj.reject(this._textTracks,function(i){if(this.renderNatively&&"nativecaptions"===i._id){return delete this._tracksById[i._id],!0}},this),delete this._tracksById.nativemetadata):this._initTextTracks(),k.length){var h=0,v=k.length;for(h;h<v;h++){var m=k[h];if(!m._id){if("captions"===m.kind||"metadata"===m.kind){if(m._id="native"+m.kind,!m.label&&"captions"===m.kind){var r=an.createLabel(m,this._unknownCount);m.name=r.label,this._unknownCount=r.unknownCount}}else{m._id=an.createId(m,this._textTracks.length)}if(this._tracksById[m._id]){continue}m.inuse=!0}if(m.inuse&&!this._tracksById[m._id]){if("metadata"===m.kind){m.mode="hidden",m.oncuechange=U.bind(this),this._tracksById[m._id]=m}else{if(x(m.kind)){var a,e=m.mode;if(m.mode="hidden",!m.cues.length&&m.embedded){continue}if(m.mode=e,this._cuesByTrackId[m._id]&&!this._cuesByTrackId[m._id].loaded){for(var p=this._cuesByTrackId[m._id].cues;a=p.shift();){am(this.renderNatively,m,a)}m.mode=e,this._cuesByTrackId[m._id].loaded=!0}F.call(this,m)}}}}}this.renderNatively&&(this.textTrackChangeHandler=this.textTrackChangeHandler||ac.bind(this),this.addTracksListener(this.video.textTracks,"change",this.textTrackChangeHandler),(X.isEdge()||X.isFF()||X.isSafari())&&(this.addTrackHandler=this.addTrackHandler||j.bind(this),this.addTracksListener(this.video.textTracks,"addtrack",this.addTrackHandler))),this._textTracks.length&&this.trigger("subtitlesTracks",{tracks:this._textTracks})}}function V(h){if(this.renderNatively){var a=h===this._itemTracks;a||af.cancelXhr(this._itemTracks),this._itemTracks=h,h&&(a||(this.disableTextTrack(),J.call(this),this.addTextTracks(h)))}}function aa(){return this._currentTextTrackIndex}function ad(a){return this.renderNatively?void (this._textTracks&&(0===a&&aj.each(this._textTracks,function(h){h.mode=h.embedded?"hidden":"disabled"}),this._currentTextTrackIndex!==a-1&&(this.disableTextTrack(),this._currentTextTrackIndex=a-1,this._textTracks[this._currentTextTrackIndex]&&(this._textTracks[this._currentTextTrackIndex].mode="showing"),this.trigger("subtitlesTrackChanged",{currentTrack:this._currentTextTrackIndex+1,tracks:this._textTracks})))):void (this.setCurrentSubtitleTrack&&this.setCurrentSubtitleTrack(a-1))}function M(m){if(m.text&&m.begin&&m.end){var i=m.trackid.toString(),l=this._tracksById&&this._tracksById[i];l||(l={kind:"captions",_id:i,data:[]},this.addTextTracks([l]),this.trigger("subtitlesTracks",{tracks:this._textTracks}));var h;m.useDTS&&(l.source||(l.source=m.source||"mpegts")),h=m.begin+"_"+m.text;var o=this._metaCuesByTextTime[h];if(!o){o={begin:m.begin,end:m.end,text:m.text},this._metaCuesByTextTime[h]=o;var k=af.convertToVTTCues([o])[0];l.data.push(k)}}}function ak(o){this._tracksById||this._initTextTracks();var l=o.track?o.track:"native"+o.type,m=this._tracksById[l],k="captions"===o.type?"Unknown CC":"ID3 Metadata",h=o.cue;if(!m){var p={kind:o.type,_id:l,label:k,embedded:!0};m=q.call(this,p),this.renderNatively||"metadata"===m.kind?this.setTextTracks(this.video.textTracks):N.call(this,[m])}B.call(this,m,h)&&(this.renderNatively||"metadata"===m.kind?am(this.renderNatively,m,h):m.data.push(h))}function ai(p){var y=this._tracksById[p.name];if(y){y.source=p.source;for(var h=p.captions||[],v=[],k=!1,A=0;A<h.length;A++){var i=h[A],m=p.name+"_"+i.begin+"_"+i.end;this._metaCuesByTextTime[m]||(this._metaCuesByTextTime[m]=i,v.push(i),k=!0)}k&&v.sort(function(l,a){return l.begin-a.begin});var w=af.convertToVTTCues(v);Array.prototype.push.apply(y.data,w)}}function al(i,a,h){i&&(ag(i,a,h),this.instreamMode||(i.addEventListener?i.addEventListener(a,h):i["on"+a]=h))}function ag(i,a,h){i&&(i.removeEventListener?i.removeEventListener(a,h):i["on"+a]=null)}function K(){af.cancelXhr(this._itemTracks);var a=this._tracksById&&this._tracksById.nativemetadata;(this.renderNatively||a)&&(ao(this.renderNatively,this.video.textTracks),a&&(a.oncuechange=null)),this._itemTracks=null,this._textTracks=null,this._tracksById=null,this._cuesByTrackId=null,this._metaCuesByTextTime=null,this._unknownCount=0,this._activeCuePosition=null,this.renderNatively&&(this.removeTracksListener(this.video.textTracks,"change",this.textTrackChangeHandler),ao(this.renderNatively,this.video.textTracks))}function ah(a){this._cachedVTTCues[a]&&(this._cachedVTTCues[a]={},this._tracksById[a].data=[])}function Z(){if(this._textTracks){var a=this._textTracks[this._currentTextTrackIndex];a&&(a.mode="disabled",(a.embedded||"nativecaptions"===a._id)&&(a.mode="hidden"))}}function G(){if(this._textTracks){var a=this._textTracks[this._currentTextTrackIndex];a&&(a.mode="showing")}}function ac(){var k=this.video.textTracks,l=aj.filter(k,function(a){return(a.inuse||!a._id)&&x(a.kind)});if(!this._textTracks||H.call(this,l)){return void this.setTextTracks(k)}for(var h=-1,e=0;e<this._textTracks.length;e++){if("showing"===this._textTracks[e].mode){h=e;break}}h!==this._currentTextTrackIndex&&this.setSubtitlesTrack(h+1)}function j(){this.setTextTracks(this.video.textTracks)}function N(l){if(l){this._textTracks||this._initTextTracks();for(var i=0;i<l.length;i++){var k=l[i];if(!k.kind||x(k.kind)){var h=q.call(this,k);F.call(this,h),k.file&&(k.data=[],af.loadFile(k,this.addVTTCuesToTrack.bind(this,h),W))}}this._textTracks&&this._textTracks.length&&this.trigger("subtitlesTracks",{tracks:this._textTracks})}}function ae(l,h){if(this.renderNatively){var k=this._tracksById[l._id];if(!k){return this._cuesByTrackId||(this._cuesByTrackId={}),void (this._cuesByTrackId[l._id]={cues:h,loaded:!1})}if(!this._cuesByTrackId[l._id]||!this._cuesByTrackId[l._id].loaded){var a;for(this._cuesByTrackId[l._id]={cues:h,loaded:!0};a=h.shift();){am(this.renderNatively,k,a)}}}}function am(m,l,k){if(!X.isIE()||!m||!window.TextTrackCue){return void l.addCue(k)}var h=new window.TextTrackCue(k.startTime,k.endTime,k.text);l.addCue(h)}function ao(e,a){a&&a.length&&aj.each(a,function(k){if(!(X.isIE()&&e&&/^(native|subtitle|cc)/.test(k._id))){k.mode="disabled",k.mode="hidden";for(var h=k.cues.length;h--;){k.removeCue(k.cues[h])}k.embedded||(k.mode="disabled"),k.inuse=!1}})}function x(a){return"subtitles"===a||"captions"===a}function Y(){this._textTracks=[],this._tracksById={},this._metaCuesByTextTime={},this._cuesByTrackId={},this._cachedVTTCues={},this._unknownCount=0}function q(e){var k,a=an.createLabel(e,this._unknownCount),l=a.label;if(this._unknownCount=a.unknownCount,this.renderNatively||"metadata"===e.kind){var h=this.video.textTracks;k=aj.findWhere(h,{label:l}),k?(k.kind=e.kind,k.language=e.language||""):k=this.video.addTextTrack(e.kind,l,e.language||""),k["default"]=e["default"],k.mode="disabled",k.inuse=!0}else{k=e,k.data=k.data||[]}return k._id||(k._id=an.createId(e,this._textTracks.length)),k}function F(a){this._textTracks.push(a),this._tracksById[a._id]=a}function J(){if(this._textTracks){var a=aj.filter(this._textTracks,function(h){return h.embedded||"subs"===h.groupid});this._initTextTracks(),aj.each(a,function(h){this._tracksById[h._id]=h}),this._textTracks=a}}function U(l){var h=l.currentTarget.activeCues;if(h&&h.length){var e=h[h.length-1].startTime;if(this._activeCuePosition!==e){var m=[];if(aj.each(h,function(a){a.startTime<e||(a.data||a.value?m.push(a):a.text&&this.trigger("meta",{metadataTime:e,metadata:JSON.parse(a.text)}))},this),m.length){var k=Q.parseID3(m);this.trigger("meta",{metadataTime:e,metadata:k})}this._activeCuePosition=e}}}function B(v,y){var h=v.kind;this._cachedVTTCues[v._id]||(this._cachedVTTCues[v._id]={});var u,w=this._cachedVTTCues[v._id];switch(h){case"captions":case"subtitles":u=Math.floor(20*y.startTime);var m="_"+y.line,A=Math.floor(20*y.endTime),k=w[u+m]||w[u+1+m]||w[u-1+m];return !(k&&Math.abs(k-A)<=1)&&(w[u+m]=A,!0);case"metadata":var p=y.data?new Uint8Array(y.data).join(""):y.text;return u=y.startTime+p,!w[u]&&(w[u]=y.endTime,!0);default:return !1}}function H(i){if(i.length>this._textTracks.length){return !0}for(var a=0;a<i.length;a++){var h=i[a];if(!h._id||!this._tracksById[h._id]){return !0}}return !1}function W(a){X.log("CAPTIONS("+a+")")}var z={_itemTracks:null,_textTracks:null,_tracksById:null,_cuesByTrackId:null,_cachedVTTCues:null,_metaCuesByTextTime:null,_currentTextTrackIndex:-1,_unknownCount:0,_activeCuePosition:null,_initTextTracks:Y,addTracksListener:al,clearTracks:K,clearCueData:ah,disableTextTrack:Z,enableTextTrack:G,getSubtitlesTrack:aa,removeTracksListener:ag,addTextTracks:N,setTextTracks:ab,setupSideloadedTracks:V,setSubtitlesTrack:ad,textTrackChangeHandler:null,addTrackHandler:null,addCuesToTrack:ai,addCaptionsCue:M,addVTTCue:ak,addVTTCuesToTrack:ae,renderNatively:!1};return z}.apply(d,c),!(void 0!==b&&(g.exports=b))},9:function(c,a){function b(d){return{bitrate:d.bitrate,label:d.label,width:d.width,height:d.height}}Object.defineProperty(a,"__esModule",{value:!0}),a.qualityLevel=b},17:function(b,a){Object.defineProperty(a,"__esModule",{value:!0});a.PLAYER=1,a.SETUP=2,a.MEDIA=3,a.NETWORK=4,a.AD=5},18:function(b,a){Object.defineProperty(a,"__esModule",{value:!0});a.BAD_HTTP_STATUS=4001,a.CROSSDOMAIN_ERROR=4002,a.BLOCKED_MIXED_CONTENT=4003},19:function(b,a){Object.defineProperty(a,"__esModule",{value:!0});a.RECOVERABLE=1,a.FATAL=2},24:function(g,d,f){var c,b;c=[],b=function(){function a(h){return h&&h.length?h.end(h.length-1):0}return{endOfRange:a}}.apply(d,c),!(void 0!==b&&(g.exports=b))},30:function(j,q,b){function h(i){if(i&&i.__esModule){return i}var a={};if(null!=i){for(var d in i){Object.prototype.hasOwnProperty.call(i,d)&&(a[d]=i[d])}}return a["default"]=i,a}Object.defineProperty(q,"__esModule",{value:!0}),q.Severity=q.Code=q.Category=q.NetworkError=void 0;var m=b(32);Object.defineProperty(q,"NetworkError",{enumerable:!0,get:function(){return m.NetworkError}});var f=b(17),v=h(f),c=b(18),g=h(c),p=b(19),k=h(p);q.Category=v,q.Code=g,q.Severity=k},31:function(b,a){Object.defineProperty(a,"__esModule",{value:!0});a.JWError=function(g,d,f,c){return{category:g,code:d,severity:f,message:c}}},32:function(v,A,b){function m(d){if(d&&d.__esModule){return d}var a={};if(null!=d){for(var c in d){Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}}return a["default"]=d,a}Object.defineProperty(A,"__esModule",{value:!0}),A.badStatusMessage=A.networkErrorMessage=A.networkErrorCode=A.NetworkError=void 0;var y=b(17),j=m(y),B=b(18),g=m(B),k=b(19),z=m(k),w=b(31),q=(A.NetworkError=function(f,c){var d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=q(f,c);return(0,w.JWError)(j.NETWORK,a,z.FATAL,x(a,f,d))},A.networkErrorCode=function(d,a){var c=void 0;return c=d>0?g.BAD_HTTP_STATUS:a&&"http:"===a.substring(0,5)&&"https:"===document.location.protocol?g.BLOCKED_MIXED_CONTENT:g.CROSSDOMAIN_ERROR}),x=A.networkErrorMessage=function(f,c,d){var a="";switch(f){case g.BAD_HTTP_STATUS:a=p(c,d);break;case g.CROSSDOMAIN_ERROR:a="Crossdomain access denied";break;case g.BLOCKED_MIXED_CONTENT:a="Unable to fetch HTTP resource over HTTPS";break;default:a="Unknown Network Error"}return a},p=A.badStatusMessage=function(){var d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",c="";switch(d){case 403:c="You do not have permission to access this content";break;case 404:c="404 Not Found";break;default:c=d+" "+a}return c}},46:function(g,d,f){var c,b;c=[f(2)],b=function(a){return{container:null,volume:function(e){e=a.between(e/100,0,1),this.video.volume=e},mute:function(h){this.video.muted=!!h,this.video.muted||this.video.removeAttribute("muted")},resize:function(j,l,h){if(!(j&&l&&this.video.videoWidth&&this.video.videoHeight)){return !1}if("uniform"===h){var e=j/l,m=this.video.videoWidth/this.video.videoHeight,k=null;Math.abs(e-m)<0.09&&(k="fill"),a.style(this.video,{objectFit:k})}return !1},getContainer:function(){return this.container},setContainer:function(h){this.container=h,h.insertBefore(this.video,h.firstChild)},remove:function(){this.stop(),this.destroy(),this.container===this.video.parentNode&&this.container.removeChild(this.video)},getVideo:function(j,k){var h=k||document.getElementById(j),e=h?h.querySelector("video"):null;return e||(e=document.createElement("video"),a.isMobile()&&e.setAttribute("jw-gesture-required","")),e.className="jw-video jw-reset",this.video=e,e}}}.apply(d,c),!(void 0!==b&&(g.exports=b))},47:function(g,d,f){var c,b;c=[f(3),f(10),f(5),f(1),f(24)],b=function(m,k,l,j,h){var o=256;return{stallCheckTimeout_:-1,lastStalledTime_:NaN,trigger:function(a,e){return m.trigger.call(this,a,e)},setState:function(a){return k.setState.call(this,a)},attachMedia:function(){this.eventsOn_()},detachMedia:function(){return this.stopStallCheck(),this.eventsOff_(),this.video},stopStallCheck:function(){clearTimeout(this.stallCheckTimeout_)},startStallCheck:function(){this.stopStallCheck(),this.stallCheckTimeout_=setTimeout(this.stalledHandler.bind(this,this.video.currentTime),o)},stalledHandler:function(a){a===this.video.currentTime&&(this.video.paused||this.video.ended||this.state!==l.LOADING&&this.state!==l.ERROR&&(this.seeking||(this.atEdgeOfLiveStream()&&this.setPlaybackRate(1),this.setState(l.STALLED))))},atEdgeOfLiveStream:function(){if(!this.isLive()){return !1}var a=2;return h.endOfRange(this.video.buffered)-this.video.currentTime<=a},setAutoplayAttributes:function(){this.video.setAttribute("autoplay",""),this.video.setAttribute("muted","")},removeAutoplayAttributes:function(){this.video.removeAttribute("autoplay"),this.video.removeAttribute("muted")}}}.apply(d,c),!(void 0!==b&&(g.exports=b))},48:function(g,d,f){var c,b;c=[f(2),f(5)],b=function(h,a){return{seeking:!1,loadedmetadata:function(){var j={duration:this.getDuration(),height:this.video.videoHeight,width:this.video.videoWidth},i=this.drmUsed;i&&(j.drm=i),this.trigger("meta",j)},timeupdate:function(){this.stopStallCheck();var m=this.video.videoHeight;m!==this._helperLastVideoHeight&&this.adaptation&&this.adaptation({size:{width:this.video.videoWidth,height:m}}),this._helperLastVideoHeight=m,this.state!==a.STALLED&&this.state!==a.LOADING||this.setState(a.PLAYING),this.startStallCheck();var l=this.getCurrentTime(),k={position:l,duration:this.getDuration()};if(this.getPtsOffset){var j=this.getPtsOffset();j>=0&&(k.metadata={mpegts:j+l})}(this.state===a.PLAYING||this.seeking)&&this.trigger("time",k)},click:function(i){this.trigger("click",i)},volumechange:function(){var i=this.video;this.trigger("volume",{volume:Math.round(100*i.volume)}),this.trigger("mute",{mute:i.muted})},seeked:function(){this.seeking&&(this.seeking=!1,this.trigger("seeked"))},playing:function(){this.setState(a.PLAYING),this.video.hasAttribute("jw-gesture-required")&&this.video.removeAttribute("jw-gesture-required"),this.trigger("providerFirstFrame")},pause:function(){this.state!==a.COMPLETE&&(this.video.ended||this.video.currentTime!==this.video.duration&&this.setState(a.PAUSED))},progress:function(){var j=this.getDuration();if(!(j<=0||j===1/0)){var k=this.video.buffered;if(k&&0!==k.length){var e=h.between(k.end(k.length-1)/j,0,1);this.trigger("bufferChange",{bufferPercent:100*e,position:this.getCurrentTime(),duration:j})}}},ratechange:function(){this.trigger("ratechange",{playbackRate:this.video.playbackRate})},ended:function(){this.stopStallCheck(),this._helperLastVideoHeight=0,this.state!==a.IDLE&&this.state!==a.COMPLETE&&this.trigger("complete")},loadeddata:function(){this.renderNatively&&this.setTextTracks(this.video.textTracks),this.video.setAttribute("jw-loaded","data")},error:function(){var j=this.video.error&&this.video.error.code||-1,i={1:"Unknown operation aborted",2:"Unknown network error",3:"Unknown decode error",4:"Source not supported"}[j]||"Unknown";this.trigger("mediaError",{code:j,message:"Error playing file: "+i})}}}.apply(d,c),!(void 0!==b&&(g.exports=b))},76:function(an,aa,ac){function aj(a){return a&&a.__esModule?a:{"default":a}}function ar(b,a){if(!(b instanceof a)){throw new TypeError("Cannot call a class as a function")}}function af(b,a){if(!b){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return !a||"object"!=typeof a&&"function"!=typeof a?b:a}function ab(b,a){if("function"!=typeof a&&null!==a){throw new TypeError("Super expression must either be null or a function, not "+typeof a)}b.prototype=Object.create(a&&a.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(b,a):b.__proto__=a)}Object.defineProperty(aa,"__esModule",{value:!0});var ae=function(){function a(f,c){for(var d=0;d<c.length;d++){var b=c[d];b.enumerable=b.enumerable||!1,b.configurable=!0,"value" in b&&(b.writable=!0),Object.defineProperty(f,b.key,b)}}return function(c,d,b){return d&&a(c.prototype,d),b&&a(c,b),c}}(),ah=ac(182),Z=aj(ah),ao=ac(167),am=aj(ao),ap=ac(165),ak=aj(ap),Y=ac(168),al=ac(163),ad=aj(al),V=ac(164),ag=aj(V),j=ac(170),K=aj(j),ai=ac(9),aq=ac(166),at=ac(1),z=ac(48),U=ac(5),q=ac(4),H=ac(2),X=ac(16),N=window.VTTCue||window.TextTrackCue,F=function(b){function a(f,d){ar(this,a);var c=af(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return c.bufferFull=!1,c.bufferStallTimeout=1000,c.currentHlsjsLevel=null,c.currentJwItem=null,c.edgeOfLiveStream=!1,c.staleManifestDurationMultiplier=3000,c.staleManifestTimeout=null,c.eventHandler=null,c.gestureRequired=G(),c.hlsjs=null,c.hlsjsConfig=null,c.jwConfig=d,c.jwLevels=null,c.lastRecoveryTime=null,c.lastEndSn=null,c.lastPosition=0,c.levelDuration=0,c.live=!1,c.maxRetries=3,c.playerId=f,c.preloaded=!1,c.preloadMetaOnly=!1,c.recoveryInterval=5000,c.recoveringMediaError=!1,c.recoveringNetworkError=!1,c.renderNatively=W(d.renderCaptionsNatively),c.retryCount=0,c.stale=!1,c.stallTimeout=null,c.state=U.IDLE,c.streamType="VOD",c.supports=a.supports,c.video=c.getVideo(f),c.withCredentials=!1,c.supportsPlaybackRate=!0,c}return ab(a,b),ae(a,[{key:"initHlsjs",value:function(f){var c=!!(void 0!==this.jwConfig.withCredentials?this.jwConfig.withCredentials:f.withCredentials);if(!this.hlsjs||this.withCredentials!==c){this.video=this.getVideo(this.playerId,this.container),this.restoreVideoProperties(),this.setContainer(this.container),this.withCredentials=c,this.stopStallTimeout(),this.stale=!1;var d=!f.stereomode;this.hlsjsConfig=(0,ad["default"])(this.withCredentials,this.jwConfig.aestoken,this.renderNatively,d),this.hlsjs=new Z["default"](this.hlsjsConfig),this.eventHandler=new ak["default"](this.video,this.createVideoListeners(),this.hlsjs,this.createHlsjsListeners())}}},{key:"init",value:function(d){if(this.video&&this.video.textTracks.length&&(this.saveVideoProperties(),this.remove()),this.initHlsjs(d),"none"!==d.preload&&this.preload(d),this.video.textTracks.length){var c=this.video.textTracks[0];c&&c.textTrack1&&(this.video.textTracks[0].inuse=!0)}d.tracks&&d.tracks.length&&this.setupSideloadedTracks(d.tracks)}},{key:"load",value:function(f,c){if(this.initHlsjs(f),c||this.setState(U.LOADING),this.gestureRequired&&this.triggerBufferFull(),this.preloaded){return this.preloadMetaOnly&&(Q("startLoad"),this.hlsjs.startLoad()),void this.resetPreload()}Q("load",f),this.currentJwItem=f,this.eventsOn_(),this.hlsjs.attachMedia(this.video),this.hlsjs.nextLevel=-1;var d=f.starttime||-1;d<-1&&(d=this.lastPosition),this.hlsjs.config.startPosition=d,this.hlsjs.loadSource(f.sources[0].file)}},{key:"preload",value:function(c){this.preloaded||(Q("preload",c),this.preloadMetaOnly="auto"!==c.preload,this.load(c,!0),this.preloaded=!0)}},{key:"play",value:function(){var d=this,c=this.video.play();c&&c["catch"]&&c.then(function(){d.gestureRequired=!1})["catch"](function(e){B(e),d.gestureRequired&&e&&"NotAllowedError"===e.name&&d.pause()})}},{key:"pause",value:function(){this.video.pause(),this.setState(U.PAUSED)}},{key:"stop",value:function(){this.video.pause(),this.clearTracks(),this.hlsjs&&(this.eventsOff_(),this.hlsjs.stopLoad())}},{key:"seek",value:function(g){var d=this.video.duration;if(d===1/0){return void B("Returned early from seek","Duration",d)}this.stopStallTimeout();var f=g>=0?g:g+d;this.trigger(q.JWPLAYER_MEDIA_SEEK,{position:this.getCurrentTime(),offset:f});var c=this.getDuration();0!==c&&c!==1/0&&(this.seeking=!0,this.video.currentTime=f,this.trigger("time",{duration:c,position:this.getCurrentTime()}))}},{key:"getCurrentQuality",value:function(){var c=0;return this.hlsjs&&!this.hlsjs.autoLevelEnabled&&(c=(0,Y.toJwLevel)(this.hlsjs.manualLevel,this.jwLevels)),c}},{key:"getQualityLevels",value:function(){return at.map(this.jwLevels,function(c){return(0,ai.qualityLevel)(c)})}},{key:"getCurrentAudioTrack",value:function(){return at.isNumber(this.currentAudioTrackIndex)?this.currentAudioTrackIndex:-1}},{key:"getAudioTracks",value:function(){return this.audioTracks||[]}},{key:"getCurrentTime",value:function(){var c=this.video.currentTime;return this.live&&"DVR"===this.streamType&&(c-=this.video.duration),c}},{key:"getDuration",value:function(){var f=this.currentJwItem.minDvrWindow,c=this.levelDuration,d=this.video.duration;return this.live?H.isDvr(c,f)?(d=-c,this.streamType="DVR"):(d=1/0,this.streamType="LIVE"):this.streamType="VOD",d}},{key:"getCurrentHlsjsLevel",value:function(){var g=0;if(this.hlsjs){var d=this.hlsjs,f=d.firstLevel,c=d.currentLevel;g=c>0?c:f}return g}},{key:"getName",value:function(){return J()}},{key:"setCurrentQuality",value:function(f){if(!(f<0)){var c=this.hlsjs.levels,d=(0,Y.toHlsjsLevel)(f,this.jwLevels);this.hlsjs.nextLevel=d,this.trigger(q.JWPLAYER_MEDIA_LEVEL_CHANGED,{levels:this.jwLevels,currentQuality:f}),this.jwConfig.qualityLabel=this.jwLevels[f].label,Q("Setting level to ",d,c[Math.max(d,0)],this.jwLevels[f])}}},{key:"setCurrentAudioTrack",value:function(g){var d=this.getCurrentHlsjsLevel(),f=(0,Y.toJwLevel)(d,this.jwLevels);if(this.jwLevels[f]){var c=this.jwLevels[f].audioGroupId;at.size(this.audioTracksMap)&&(this.audioTracks=this.audioTracksMap[c],at.isNumber(g)&&at.size(this.audioTracks)&&this.audioTracks[g]&&this.currentAudioTrackIndex!==g&&(this.trigger(q.JWPLAYER_AUDIO_TRACKS,{tracks:this.audioTracks,currentTrack:g}),null!==this.currentAudioTrackIndex&&this.audioTracks[g].hlsjsIndex!==this.hlsjs.audioTrack&&this.trigger(q.JWPLAYER_AUDIO_TRACK_CHANGED,{tracks:this.audioTracks,currentTrack:g}),this.currentAudioTrackIndex=g,this.hlsjs.audioTrack=this.audioTracks[g].hlsjsIndex,Q("Setting audio track to",this.audioTracks[g])))}}},{key:"updateAudioTrack",value:function(d){if(this.hlsjs.audioTracks.length){var c=this.currentAudioTrackIndex;at.isNumber(c)?this.audioTracks[c].hlsjsIndex!==this.hlsjs.audioTrack&&(this.currentAudioTrackIndex=null):c=(0,Y.getDefaultJwTrackIndex)(this.audioTracksMap[d.attrs.AUDIO]),this.setCurrentAudioTrack(c)}}},{key:"setCurrentSubtitleTrack",value:function(c){this.hlsjs.subtitleTrack=c}},{key:"setPlaybackRate",value:function(c){this.video.playbackRate=this.video.defaultPlaybackRate=c}},{key:"getPlaybackRate",value:function(){return this.video.playbackRate}},{key:"isLive",value:function(){return this.live}},{key:"onAdaptation",value:function(k){var p=this.hlsjs,c=p.levels,h=p.autoLevelEnabled,m=c[k],f=(m?m.width:0)||this.video.videoWidth,u=(m?m.height:0)||this.video.videoHeight,d=m?m.bitrate:0,g=(0,Y.toJwLevel)(k,this.jwLevels);this.trigger("visualQuality",{reason:h?"auto":"api",mode:h?"auto":"manual",type:"visualQuality",level:{bitrate:d,index:g,height:u,label:h?"auto":this.jwLevels[g].label,width:f}}),this.triggerMediaType(f,u)}},{key:"triggerMediaType",value:function(f,c){var d="video";f&&c||(d="audio"),Q("Media Type",d),this.trigger(q.JWPLAYER_MEDIA_TYPE,{mediaType:d})}},{key:"createVideoListeners",value:function(){var d=this,c={};return at.each(z,function(f,e){"function"==typeof f&&(c[e]=f.bind(d))}),c}},{key:"createHlsjsListeners",value:function(){var d=this,c={};return c[Z["default"].Events.MEDIA_ATTACHED]=function(){Q("Media attached"),d.recoveringMediaError&&(d.hlsjs.startLoad(),d.recoveringMediaError=!1,d.resetRecovery(),d.stopStallTimeout())},c[Z["default"].Events.MEDIA_DETACHED]=function(){Q("Media detached"),d.renderNatively||(d.clearCueData("textTrack1"),d.clearCueData("textTrack2"))},c[Z["default"].Events.MANIFEST_LOADED]=function(g,f){Q("Manifest loaded",f)},c[Z["default"].Events.MANIFEST_PARSED]=function(g,k){Q("Manifest parsed",k);var f=k.levels,e=k.firstLevel,m=e,h=0;d.currentHlsjsLevel=null,d.jwLevels=(0,Y.formatLevels)(f,d.jwConfig.qualityLabels);var l=at.find(d.jwLevels,function(i){return i.label===d.jwConfig.qualityLabel});l&&l.hlsjsIndex>-1&&(m=l.hlsjsIndex,h=(0,Y.toJwLevel)(m,d.jwLevels),d.hlsjs.nextLevel=m),d.hlsjs.startLevel=m,d.preloadMetaOnly||d.hlsjs.startLoad(d.hlsjs.config.startPosition),d.trigger(q.JWPLAYER_MEDIA_LEVELS,{levels:d.jwLevels,currentQuality:h})},c[Z["default"].Events.LEVEL_SWITCH]=function(e,f){Q("Level switch requested",f,d.hlsjs.levels,"ABR:",d.hlsjs.autoLevelEnabled)},c[Z["default"].Events.LEVEL_LOADED]=function(g,k){Q("Level loaded",k);var f=k.details,e=f.endSN,l=f.live,h=f.targetduration;d.checkStaleManifest(e,l,h)},c[Z["default"].Events.LEVEL_UPDATED]=function(g,h){Q("Level updated",h);var f=h.details,e=f.live,k=f.totalduration;d.live=e,d.levelDuration=k},c[Z["default"].Events.LEVEL_PTS_UPDATED]=function(e,f){Q("Level PTS updated",f),d.levelDuration=f.details.totalduration},c[Z["default"].Events.LEVEL_REMOVED]=function(){d.jwLevels=(0,Y.formatLevels)(d.hlsjs.levels,d.jwConfig.qualityLabels),d.trigger(q.JWPLAYER_MEDIA_LEVELS,{levels:d.jwLevels,currentQuality:0})},c[Z["default"].Events.FRAG_CHANGED]=function(v,e){Q("Frag changed",e);var k=e.frag,m=k.level,g=k.tagList,w=void 0===g?[]:g,f=d.hlsjs.levels,h=f[m];m!==d.currentHlsjsLevel?(Q("Level switch complete",m,h),d.currentHlsjsLevel=m,d.onAdaptation(m),d.updateAudioTrack(f[m])):d.video.videoHeight!==d._helperLastVideoHeight&&d.onAdaptation(m);var p=(0,aq.findTagInList)(w,"PROGRAM-DATE-TIME");p&&d.trigger("meta",{programDateTime:p[1]})},c[Z["default"].Events.FRAG_PARSING_METADATA]=function(f,g){Q("Frag metadata parsed",g);var e=d.hlsjs.levels;at.each(g.samples,function(D){var y=D.unit,k=D.data,E=D.pts,i=(0,am["default"])(y||k).cues;if(!i){return void B("No cues found in ID3 byte array")}var m=H.parseID3(i);if(!m){return void B("No metadata found in the ID3 cues")}var C=e[g.frag.level],w=C&&C.details;if(!w){if(m.PRIV&&"com.apple.streaming.transportStreamTimestamp" in m.PRIV){return}return void B("No matching level found for ID3 metadata")}var x=at.find(C.details.fragments,function(h){return h.sn===g.frag.sn});if(!x){return void B("No matching fragment found for ID3 level")}if(!x.endPTS){return void B("No endPTS found for matching ID3 fragment")}var p=Math.max(E,0),A=x.endPTS;if(p<A){var r=new N(p,A,JSON.stringify(m));d.addVTTCue({type:"metadata",cue:r})}})},c[Z["default"].Events.BUFFER_APPENDING]=function(g,f){Q("Buffer appending",f)},c[Z["default"].Events.BUFFER_APPENDED]=function(f,g){var e=d.video.buffered.length;Q("Buffer appended",g,d.state,e,e&&d.video.buffered.end(e-1)),d.stopStallTimeout(),d.recoveringNetworkError&&(d.resetRecovery(),d.recoveringNetworkError=!1)},c[Z["default"].Events.FRAG_BUFFERED]=function(e,f){Q("Frag buffered",f),d.triggerBufferFull()},c[Z["default"].Events.KEY_LOADING]=function(e,f){Q("Key loading",f),d.supports("drm")||d.shutdown("AES decryption not supported with this license")},c[Z["default"].Events.SUBTITLE_TRACKS_UPDATED]=function(g,f){Q("Subtitle tracks updated",f)},this.renderNatively||(c[Z["default"].Events.NON_NATIVE_TEXT_TRACKS_FOUND]=function(e,f){Q("Externally managed text track found",f),d.addTextTracks(f.tracks)},c[Z["default"].Events.CUES_PARSED]=function(e,f){Q("Externally managed VTTCues found",f),f.cues.forEach(function(g){d.addVTTCue({type:f.type,cue:g,track:f.track})})}),c[Z["default"].Events.AUDIO_TRACKS_UPDATED]=function(g,h){Q("Audio tracks updated");var f=h.audioTracks,e=d.hlsjs.levels,k=d.getCurrentHlsjsLevel();f&&f.length&&(d.currentAudioTrackIndex=null,d.audioTracksMap=(0,Y.formatAudioTracks)(f),d.updateAudioTrack(e[k]))},c[Z["default"].Events.ERROR]=function(w,e){var k=(0,ag["default"])(e),p=e.fatal,g=e.type,x=k.stalling,f=k.recoverable,h=k.message,v=k.doCodecSwap;if(B(k),x&&(d.seeking?d.setState(U.LOADING):d.stallTimeout||d.startStallTimeout()),p){var m=Date.now();f&&d.retryCount<d.maxRetries?m>=d.lastRecoveryTime+d.recoveryInterval?(B("Attempting to recover, retry count:",d.retryCount),"networkError"===g?(d.recoveringNetworkError=!0,d.hlsjs.startLoad()):"mediaError"===g&&(d.recoveringMediaError=!0,v&&d.hlsjs.swapAudioCodec(),d.hlsjs.recoverMediaError()),d.retryCount+=1,d.lastRecoveryTime=m):B("Recovery not attempted - too little time between attempts",m-d.lastRecoveryTime):d.shutdown(h,e)}},c}},{key:"eventsOn_",value:function(){Q("eventsOn_"),this.eventHandler.on()}},{key:"eventsOff_",value:function(){Q("eventsOff_"),this.disableTextTrack(),this.lastPosition=this.video.currentTime,this.hlsjs.detachMedia(),this.eventHandler.off(),this.resetLifecycleVariables()}},{key:"shutdown",value:function(){var d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Fatal Error",c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};console.error("Hlsjs shutdown",d,c),this.destroy(),this.trigger(q.JWPLAYER_MEDIA_ERROR,{message:d})}},{key:"destroy",value:function(){this.hlsjs&&(this.eventsOff_(),this.hlsjs.destroy(),this.hlsjs=null,Q("Hlsjs destroyed"))}},{key:"startStallTimeout",value:function(){var c=this;this.stallTimeout||(this.stallTimeout=setTimeout(function(){var d=c.atEdgeOfLiveStream(),e=c.video.ended||d;e?(c.edgeOfLiveStream=!0,c.checkStreamEnded()):(c.setState(U.STALLED),d&&c.setPlaybackRate(1))},this.bufferStallTimeout))}},{key:"stopStallTimeout",value:function(){clearTimeout(this.stallTimeout),clearTimeout(this.staleManifestTimeout),this.stallTimeout=null,this.staleManifestTimeout=null,this.edgeOfLiveStream=!1}},{key:"saveVideoProperties",value:function(){this.jwConfig.volume=100*this.video.volume,this.jwConfig.mute=this.video.muted}},{key:"restoreVideoProperties",value:function(){this.volume(this.jwConfig.volume),this.mute(this.jwConfig.mute)}},{key:"resetRecovery",value:function(){this.retryCount=0}},{key:"checkStaleManifest",value:function(g,d,f){var c=this;d&&this.lastEndSn===g?this.staleManifestTimeout||(this.staleManifestTimeout=setTimeout(function(){c.stale=!0,c.checkStreamEnded()},this.staleManifestDurationMultiplier*f)):(clearTimeout(this.staleManifestTimeout),this.staleManifestTimeout=null,this.stale=!1),this.lastEndSn=g,this.live=d}},{key:"checkStreamEnded",value:function(){this.stale&&this.edgeOfLiveStream&&this.shutdown("The live stream is either down or has ended")}},{key:"resetPreload",value:function(){this.preloaded=!1,this.preloadMetaOnly=!1}},{key:"resetLifecycleVariables",value:function(){this.resetPreload(),this.resetRecovery(),this.stopStallTimeout(),this.setState(U.IDLE),this.bufferFull=!1,this.currentHlsjsLevel=null,this.currentJwItem=null,this.gestureRequired=G(),this.jwLevels=null,this.lastRecoveryTime=null,this.lastEndSn=null,this.levelDuration=0,this.live=!1,this.recoveringMediaError=!1,this.recoveringNetworkError=!1,this.stale=!1,this.staleManifestTimeout=null,this.streamType="VOD"}},{key:"triggerBufferFull",value:function(){this.bufferFull||(this.bufferFull=!0,this.trigger(q.JWPLAYER_MEDIA_BUFFER_FULL))}}],[{key:"getName",value:function(){return J()}},{key:"setEdition",value:function(c){a.supports=X(c)}}]),a}(K["default"]);aa["default"]=F;var J=function(){return{name:"hlsjs"}},Q=function(){if(window.jwplayer.debug){var a;(a=console).info.apply(a,arguments)}},B=function(){if(window.jwplayer.debug){var a;(a=console).warn.apply(a,arguments)}},W=function(a){return !(!H.isIOS()&&!H.isSafari())||H.isChrome()&&a},G=function(){return H.isAndroid()};delete z.error},163:function(h,k,b){function g(l){if(l&&l.__esModule){return l}var a={};if(null!=l){for(var i in l){Object.prototype.hasOwnProperty.call(l,i)&&(a[i]=l[i])}}return a["default"]=l,a}function j(q,o,p,n){var l={liveSyncDuration:25,autoStartLoad:!1,maxBufferSize:20000000,maxMaxBufferLength:90,capLevelToPlayerSize:n,renderNatively:p,debug:c};return(q||o)&&(l=f.extend({},l,d(q,o))),l}function d(i,a){return{xhrSetup:function(n,l){if(i&&(n.withCredentials=!0),a){var e=l.indexOf("?")>0?"&token=":"?token=";n.open("GET",l+e+a,!0)}},fetchSetup:function(n,l){return l.credentials="include",new Request(n.url,l)}}}Object.defineProperty(k,"__esModule",{value:!0}),k["default"]=j;var m=b(169),c=g(m),f=b(1)},164:function(j,q,b){function h(u){var n=u.details,o=f.indexOf(v,n)<0,l=f.indexOf(c,n)>=0,d=f.indexOf(g,n)>=0,s=p(u);switch(u.type){case"networkError":s="Cannot load M3U8: "+s;break;case"mediaError":s="Media Error: "+s;break;case"otherError":s="Error: "+s+";"}return k(s,o,l,d,u)}Object.defineProperty(q,"__esModule",{value:!0}),q["default"]=h;var m=b(30),f=b(1),v=["manifestLoadError","manifestParsingError","manifestIncompatibleCodecsError","levelLoadError"],c=["bufferStalledError","bufferSeekOverHole"],g=["fragLoopLoadingError"],p=function(d){var a="";return d&&(a=d.response?(0,m.NetworkError)(d.response.code,d.url,d.response.text).message:d.reason?""+d.reason:""+d.details),a},k=function(s,n,o,l,d){return{message:s,recoverable:n,stalling:o,doCodecSwap:l,hlsjsErrorParams:d}}},165:function(h,d,g){function c(i,a){if(!(i instanceof a)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(d,"__esModule",{value:!0});var b=function(){function a(n,l){for(var m=0;m<l.length;m++){var k=l[m];k.enumerable=k.enumerable||!1,k.configurable=!0,"value" in k&&(k.writable=!0),Object.defineProperty(n,k.key,k)}}return function(k,l,e){return l&&a(k.prototype,l),e&&a(k,e),k}}(),j=g(1),f=function(){function a(i,k,e,l){c(this,a),this.video=i,this.hlsjs=e,this.videoListeners=k,this.hlsjsListeners=l}return b(a,[{key:"on",value:function(){var i=this;this.off(),j.each(this.videoListeners,function(e,k){i.video.addEventListener(k,e,!1)}),j.each(this.hlsjsListeners,function(e,k){i.hlsjs.on(k,e)})}},{key:"off",value:function(){var i=this;j.each(this.videoListeners,function(e,k){i.video.removeEventListener(k,e)}),j.each(this.hlsjsListeners,function(e,k){i.hlsjs.off(k,e)})}}]),a}();d["default"]=f},166:function(c,a){function b(j,g){if(j){for(var h=null,f=j.length-1;f>=0;f--){var d=j[f];if(d[0]===g){h=d;break}}return h}}Object.defineProperty(a,"__esModule",{value:!0}),a.findTagInList=b},167:function(h,d,g){function c(q){for(var w=0,a=0,n=10,k=[];w+f<q.length;){var m=j.utf8ArrayToStr(q.subarray(w,w+=3));if("ID3"===m){var v=q.subarray(w,w+=2),s=q.subarray(w,w+=1)[0];if(0!==(128&s)||v[0]<3){break}var p=j.syncSafeInt(q.subarray(w,w+=4));0!==(64&s)&&(n+=j.syncSafeInt(q.subarray(w,w+=4))),k=k.concat(b(q,a+n,p)),w+=p}else{if("3DI"!==m){w-=3;break}w+=7}a=w}return{position:w,cues:k}}function b(v,z,k){for(var p=v.length,x=z,A=[];x<z+k;){if(p-x<8){return A}var m=x;x+=4;var n=j.syncSafeInt(v.subarray(x,x+=4));if(p-x<n+2){return A}var y=v.subarray(x,x+=1)[0];if(y>0){return A}var w=v[x];3!==w&&0!==w||(n-=1,x+=1);var q=v.buffer.slice(m-10,x+n+1);A.push({data:q}),x+=n+1}return A}Object.defineProperty(d,"__esModule",{value:!0}),d["default"]=c;var j=g(11),f=9},168:function(j,q,b){function h(n,d){var l=p.hasRedundantLevels(n),a=g.map(n,function(r,o){return{label:p.generateLabel(r,d,l),level_id:r.id,hlsjsIndex:o,bitrate:r.bitrate,height:r.height,width:r.width,audioGroupId:r.attrs?r.attrs.AUDIO:void 0}});return a=k(a),a.length>1&&a.unshift({label:"Auto",level_id:"auto",hlsjsIndex:-1}),a}function m(d,a){return Math.max(0,g.indexOf(a,g.find(a,function(e){return e.hlsjsIndex===d})))}function f(i,a){var d=-1;return i>-1&&a[i]&&(d=a[i].hlsjsIndex),d}function v(d){var a=g.reduce(d,function(s,n,o){var l=n.groupId;return s[l]=s[l]||[],s[l].push({autoselect:n.autoselect,defaulttrack:n["default"],groupid:l,language:n.lang,name:n.name,hlsjsIndex:o}),s},{});return a}function c(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Math.max(g.indexOf(a,g.find(a,function(d){return d.defaulttrack})),0)}Object.defineProperty(q,"__esModule",{value:!0}),q.formatLevels=h,q.toJwLevel=m,q.toHlsjsLevel=f,q.formatAudioTracks=v,q.getDefaultJwTrackIndex=c;var g=b(1),p=b(67),k=function(a){return a.sort(function(l,d){var i=void 0;return i=l.height&&d.height?l.height===d.height?d.bitrate-l.bitrate:d.height-l.height:d.bitrate-l.bitrate})}},169:function(c,a){Object.defineProperty(a,"__esModule",{value:!0});var b=function(g,d,f){window.jwplayer.debug&&g.call(console,"[Hls.js "+d+"] -> "+f)};a.debug=function(d){b(console.debug,"debug",d)},a.log=function(d){b(console.log,"log",d)},a.info=function(d){b(console.info,"info",d)},a.warn=function(d){b(console.warn,"warn",d)},a.error=function(d){b(console.error,"error",d)}},170:function(j,q,b){function h(d,a){if(!(d instanceof a)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(q,"__esModule",{value:!0});var m=b(1),f=b(46),v=b(47),c=b(8),g=b(3),p=function k(){h(this,k)};q["default"]=p,p.prototype=m.extend({},g,f,v,c)},182:function(b,a){!function(d){if("object"==typeof a&&"undefined"!=typeof b){b.exports=d()}else{if("function"==typeof define&&define.amd){define([],d)}else{var c;c="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,c.Hls=d()}}}(function(){var d;return function c(k,j,g){function f(m,p){if(!j[m]){if(!k[m]){var e="function"==typeof require&&require;if(!p&&e){return e(m,!0)}if(l){return l(m,!0)}var i=new Error("Cannot find module '"+m+"'");throw i.code="MODULE_NOT_FOUND",i}var n=j[m]={exports:{}};k[m][0].call(n.exports,function(o){var q=k[m][1][o];return f(q?q:o)},n,n.exports,c,k,j,g)}return j[m].exports}for(var l="function"==typeof require&&require,h=0;h<g.length;h++){f(g[h])}return f}({1:[function(l,h,k){function g(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function f(i){return"function"==typeof i}function p(i){return"number"==typeof i}function j(i){return"object"==typeof i&&null!==i}function m(i){return void 0===i}h.exports=g,g.EventEmitter=g,g.prototype._events=void 0,g.prototype._maxListeners=void 0,g.defaultMaxListeners=10,g.prototype.setMaxListeners=function(i){if(!p(i)||i<0||isNaN(i)){throw TypeError("n must be a positive number")}return this._maxListeners=i,this},g.prototype.emit=function(x){var v,w,s,z,o,q;if(this._events||(this._events={}),"error"===x&&(!this._events.error||j(this._events.error)&&!this._events.error.length)){if(v=arguments[1],v instanceof Error){throw v}var y=new Error('Uncaught, unspecified "error" event. ('+v+")");throw y.context=v,y}if(w=this._events[x],m(w)){return !1}if(f(w)){switch(arguments.length){case 1:w.call(this);break;case 2:w.call(this,arguments[1]);break;case 3:w.call(this,arguments[1],arguments[2]);break;default:z=Array.prototype.slice.call(arguments,1),w.apply(this,z)}}else{if(j(w)){for(z=Array.prototype.slice.call(arguments,1),q=w.slice(),s=q.length,o=0;o<s;o++){q[o].apply(this,z)}}}return !0},g.prototype.addListener=function(o,i){var n;if(!f(i)){throw TypeError("listener must be a function")}return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",o,f(i.listener)?i.listener:i),this._events[o]?j(this._events[o])?this._events[o].push(i):this._events[o]=[this._events[o],i]:this._events[o]=i,j(this._events[o])&&!this._events[o].warned&&(n=m(this._maxListeners)?g.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[o].length>n&&(this._events[o].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[o].length),"function"==typeof console.trace&&console.trace())),this},g.prototype.on=g.prototype.addListener,g.prototype.once=function(s,o){function q(){this.removeListener(s,q),n||(n=!0,o.apply(this,arguments))}if(!f(o)){throw TypeError("listener must be a function")}var n=!1;return q.listener=o,this.on(s,q),this},g.prototype.removeListener=function(v,s){var u,q,x,w;if(!f(s)){throw TypeError("listener must be a function")}if(!this._events||!this._events[v]){return this}if(u=this._events[v],x=u.length,q=-1,u===s||f(u.listener)&&u.listener===s){delete this._events[v],this._events.removeListener&&this.emit("removeListener",v,s)}else{if(j(u)){for(w=x;w-->0;){if(u[w]===s||u[w].listener&&u[w].listener===s){q=w;break}}if(q<0){return this}1===u.length?(u.length=0,delete this._events[v]):u.splice(q,1),this._events.removeListener&&this.emit("removeListener",v,s)}}return this},g.prototype.removeAllListeners=function(o){var i,n;if(!this._events){return this}if(!this._events.removeListener){return 0===arguments.length?this._events={}:this._events[o]&&delete this._events[o],this}if(0===arguments.length){for(i in this._events){"removeListener"!==i&&this.removeAllListeners(i)}return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[o],f(n)){this.removeListener(o,n)}else{if(n){for(;n.length;){this.removeListener(o,n[n.length-1])}}}return delete this._events[o],this},g.prototype.listeners=function(n){var i;return i=this._events&&this._events[n]?f(this._events[n])?[this._events[n]]:this._events[n].slice():[]},g.prototype.listenerCount=function(n){if(this._events){var i=this._events[n];if(f(i)){return 1}if(i){return i.length}}return 0},g.listenerCount=function(n,i){return n.listenerCount(i)}},{}],2:[function(f,g,e){!function(j){var i=/^((?:[^\/;?#]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,p=/^([^\/;?#]*)(.*)$/,k=/(?:\/|^)\.(?=\/)/g,m=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,h={buildAbsoluteURL:function(w,A,l){if(l=l||{},w=w.trim(),A=A.trim(),!A){if(!l.alwaysNormalize){return w}var q=this.parseURL(w);if(!B){throw new Error("Error trying to parse base URL.")}return q.path=h.normalizePath(q.path),h.buildURLFromParts(q)}var y=this.parseURL(A);if(!y){throw new Error("Error trying to parse relative URL.")}if(y.scheme){return l.alwaysNormalize?(y.path=h.normalizePath(y.path),h.buildURLFromParts(y)):A}var B=this.parseURL(w);if(!B){throw new Error("Error trying to parse base URL.")}if(!B.netLoc&&B.path&&"/"!==B.path[0]){var n=p.exec(B.path);B.netLoc=n[1],B.path=n[2]}B.netLoc&&!B.path&&(B.path="/");var z={scheme:B.scheme,netLoc:y.netLoc,path:null,params:y.params,query:y.query,fragment:y.fragment};if(!y.netLoc&&(z.netLoc=B.netLoc,"/"!==y.path[0])){if(y.path){var x=B.path,v=x.substring(0,x.lastIndexOf("/")+1)+y.path;z.path=h.normalizePath(v)}else{z.path=B.path,y.params||(z.params=B.params,y.query||(z.query=B.query))}}return null===z.path&&(z.path=l.alwaysNormalize?h.normalizePath(y.path):y.path),h.buildURLFromParts(z)},parseURL:function(n){var l=i.exec(n);return l?{scheme:l[1]||"",netLoc:l[2]||"",path:l[3]||"",params:l[4]||"",query:l[5]||"",fragment:l[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(k,"");l.length!==(l=l.replace(m,"")).length;){}return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};"object"==typeof e&&"object"==typeof g?g.exports=h:"function"==typeof d&&d.amd?d([],function(){return h}):"object"==typeof e?e.URLToolkit=h:j.URLToolkit=h}(this)},{}],3:[function(l,h,k){var g=arguments[3],f=arguments[4],m=arguments[5],j=JSON.stringify;h.exports=function(J,x){function z(r){A[r]=!0;for(var p in f[r][1]){var o=f[r][1][p];A[o]||z(o)}}for(var B,D=Object.keys(m),s=0,K=D.length;s<K;s++){var I=D[s],L=m[I].exports;if(L===J||L&&L["default"]===J){B=I;break}}if(!B){B=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var G={},s=0,K=D.length;s<K;s++){var I=D[s];G[I]=I}f[B]=[Function(["require","module","exports"],"("+J+")(self)"),G]}var q=Math.floor(Math.pow(16,8)*Math.random()).toString(16),H={};H[B]=B,f[q]=[Function(["require"],"var f = require("+j(B)+");(f.default ? f.default : f)(self);"),H];var A={};z(q);var n="("+g+")({"+Object.keys(A).map(function(o){return j(o)+":["+f[o][0]+","+j(f[o][1])+"]"}).join(",")+"},{},["+j(q)+"])",C=window.URL||window.webkitURL||window.mozURL||window.msURL,i=new Blob([n],{type:"text/javascript"});if(x&&x.bare){return i}var w=C.createObjectURL(i),F=new Worker(w);return F.objectURL=w,F}},{}],4:[function(S,C,F){function N(f){return f&&f.__esModule?f:{"default":f}}Object.defineProperty(F,"__esModule",{value:!0}),F.hlsDefaultConfig=void 0;var X=S(5),J=N(X),D=S(8),I=N(D),L=S(9),z=N(L),U=S(10),Q=N(U),V=S(56),O=N(V),x=S(7),P=N(x),H=S(6),w=N(H),K=S(47),j=N(K),B=S(15),M=N(B),W=S(14),Y=N(W),q=S(13),G=N(q);F.hlsDefaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:60000000,maxBufferHole:0.5,maxSeekHole:2,lowBufferWatchdogPeriod:0.5,highBufferWatchdogPeriod:3,nudgeOffset:0.1,nudgeMaxRetry:3,maxFragLookUpTolerance:0.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:10000,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1000,manifestLoadingMaxRetryTimeout:64000,startLevel:void 0,levelLoadingTimeOut:10000,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1000,levelLoadingMaxRetryTimeout:64000,fragLoadingTimeOut:20000,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1000,fragLoadingMaxRetryTimeout:64000,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5000,fpsDroppedMonitoringThreshold:0.2,appendErrorMaxRetry:3,loader:O["default"],fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:J["default"],bufferController:I["default"],capLevelController:z["default"],fpsController:Q["default"],audioStreamController:w["default"],audioTrackController:P["default"],subtitleStreamController:G["default"],subtitleTrackController:Y["default"],timelineController:M["default"],cueHandler:j["default"],enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",stretchShortVideoTrack:!1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:500000,abrBandWidthFactor:0.95,abrBandWidthUpFactor:0.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0}},{10:10,13:13,14:14,15:15,47:47,5:5,56:56,6:6,7:7,8:8,9:9}],5:[function(J,w,z){function F(f){return f&&f.__esModule?f:{"default":f}}function M(g,f){if(!(g instanceof f)){throw new TypeError("Cannot call a class as a function")}}function C(g,f){if(!g){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return !f||"object"!=typeof f&&"function"!=typeof f?g:f}function x(g,f){if("function"!=typeof f&&null!==f){throw new TypeError("Super expression must either be null or a function, not "+typeof f)}g.prototype=Object.create(f&&f.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(g,f):g.__proto__=f)}Object.defineProperty(z,"__esModule",{value:!0});var B=function(){function f(m,h){for(var l=0;l<h.length;l++){var g=h[l];g.enumerable=g.enumerable||!1,g.configurable=!0,"value" in g&&(g.writable=!0),Object.defineProperty(m,g.key,g)}}return function(g,h,e){return h&&f(g.prototype,h),e&&f(g,e),g}}(),E=J(32),q=F(E),K=J(31),I=F(K),L=J(34),G=F(L),k=J(30),H=J(51),A=J(49),j=F(A),D=function(g){function f(i){M(this,f);var h=C(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,i,q["default"].FRAG_LOADING,q["default"].FRAG_LOADED,q["default"].FRAG_BUFFERED,q["default"].ERROR));return h.lastLoadedFragLevel=0,h._nextAutoLevel=-1,h.hls=i,h.onCheck=h._abandonRulesCheck.bind(h),h}return x(f,g),B(f,[{key:"destroy",value:function(){this.clearTimer(),I["default"].prototype.destroy.call(this)}},{key:"onFragLoading",value:function(v){var m=v.frag;if("main"===m.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this._bwEstimator){var u=this.hls,l=v.frag.level,h=u.levels[l].details.live,N=u.config,p=void 0,y=void 0;h?(p=N.abrEwmaFastLive,y=N.abrEwmaSlowLive):(p=N.abrEwmaFastVoD,y=N.abrEwmaSlowVoD),this._bwEstimator=new j["default"](u,y,p,N.abrEwmaDefaultEstimate)}this.fragCurrent=m}}},{key:"_abandonRulesCheck",value:function(){var ab=this.hls,P=ab.media,R=this.fragCurrent,Z=R.loader,ae=ab.minAutoLevel;if(!Z||Z.stats&&Z.stats.aborted){return H.logger.warn("frag loader destroy or aborted, disarm abandonRules"),void this.clearTimer()}var V=Z.stats;if(P&&(!P.paused&&0!==P.playbackRate||!P.readyState)&&R.autoLevel&&R.level){var Q=performance.now()-V.trequest,U=Math.abs(P.playbackRate);if(Q>500*R.duration/U){var X=ab.levels,ac=Math.max(1,V.bw?V.bw/8:1000*V.loaded/Q),aa=X[R.level],ad=aa.realBitrate?Math.max(aa.realBitrate,aa.bitrate):aa.bitrate,N=V.total?V.total:Math.max(V.loaded,Math.round(R.duration*ad/8)),S=P.currentTime,u=(N-V.loaded)/ac,W=(G["default"].bufferInfo(P,S,ab.config.maxBufferHole).end-S)/U;if(W<2*R.duration/U&&u>W){var h=void 0,O=void 0;for(O=R.level-1;O>ae;O--){var Y=X[O].realBitrate?Math.max(X[O].realBitrate,X[O].bitrate):X[O].bitrate;if(h=R.duration*Y/(6.4*ac),h<W){break}}h<u&&(H.logger.warn("loading too slow, abort fragment loading and switch to level "+O+":fragLoadedDelay["+O+"]<fragLoadedDelay["+(R.level-1)+"];bufferStarvationDelay:"+h.toFixed(1)+"<"+u.toFixed(1)+":"+W.toFixed(1)),ab.nextLoadLevel=O,this._bwEstimator.sample(Q,V.loaded),Z.abort(),this.clearTimer(),ab.trigger(q["default"].FRAG_LOAD_EMERGENCY_ABORTED,{frag:R,stats:V}))}}}}},{key:"onFragLoaded",value:function(p){var m=p.frag;if("main"===m.type&&!isNaN(m.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=m.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var o=this.hls.levels[m.level],l=(o.loaded?o.loaded.bytes:0)+p.stats.loaded,h=(o.loaded?o.loaded.duration:0)+p.frag.duration;o.loaded={bytes:l,duration:h},o.realBitrate=Math.round(8*l/h)}if(p.frag.bitrateTest){var s=p.stats;s.tparsed=s.tbuffered=s.tload,this.onFragBuffered(p)}}}},{key:"onFragBuffered",value:function(n){var l=n.stats,m=n.frag;if(!(l.aborted===!0||1!==m.loadCounter||"main"!==m.type||isNaN(m.sn)||m.bitrateTest&&l.tload!==l.tbuffered)){var h=l.tparsed-l.trequest;H.logger.log("latency/loading/parsing/append/kbps:"+Math.round(l.tfirst-l.trequest)+"/"+Math.round(l.tload-l.tfirst)+"/"+Math.round(l.tparsed-l.tload)+"/"+Math.round(l.tbuffered-l.tparsed)+"/"+Math.round(8*l.loaded/(l.tbuffered-l.trequest))),this._bwEstimator.sample(h,l.loaded),m.bitrateTest?this.bitrateTestDelay=h/1000:this.bitrateTestDelay=0}}},{key:"onError",value:function(h){switch(h.details){case k.ErrorDetails.FRAG_LOAD_ERROR:case k.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"_findBestLevel",value:function(U,ab,m,R,Y,P,ac,O,Q){for(var aa=Y;aa>=R;aa--){var V=Q[aa],T=V.details,W=T?T.totalduration/T.fragments.length:ab,S=!!T&&T.live,Z=void 0;Z=aa<=U?ac*m:O*m;var N=Q[aa].realBitrate?Math.max(Q[aa].realBitrate,Q[aa].bitrate):Q[aa].bitrate,X=N*W/Z;if(H.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+aa+"/"+Math.round(Z)+"/"+N+"/"+W+"/"+P+"/"+X),Z>N&&(!X||S||X<P)){return aa}}return -1}},{key:"nextAutoLevel",get:function(){var l=this._nextAutoLevel,h=this._bwEstimator;if(!(l===-1||h&&h.canEstimate())){return l}var i=this._nextABRAutoLevel;return l!==-1&&(i=Math.min(l,i)),i},set:function(h){this._nextAutoLevel=h}},{key:"_nextABRAutoLevel",get:function(){var ab=this.hls,Q=ab.maxAutoLevel,S=ab.levels,Z=ab.config,ae=ab.minAutoLevel,W=ab.media,R=this.lastLoadedFragLevel,V=this.fragCurrent?this.fragCurrent.duration:0,Y=W?W.currentTime:0,P=W&&0!==W.playbackRate?Math.abs(W.playbackRate):1,ac=this._bwEstimator?this._bwEstimator.getEstimate():Z.abrEwmaDefaultEstimate,aa=(G["default"].bufferInfo(W,Y,Z.maxBufferHole).end-Y)/P,ad=this._findBestLevel(R,V,ac,ae,Q,aa,Z.abrBandWidthFactor,Z.abrBandWidthUpFactor,S);if(ad>=0){return ad}H.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var O=V?Math.min(V,Z.maxStarvationDelay):Z.maxStarvationDelay,U=Z.abrBandWidthFactor,N=Z.abrBandWidthUpFactor;if(0===aa){var X=this.bitrateTestDelay;if(X){var h=V?Math.min(V,Z.maxLoadingDelay):Z.maxLoadingDelay;O=h-X,H.logger.trace("bitrate test took "+Math.round(1000*X)+"ms, set first fragment max fetchDuration to "+Math.round(1000*O)+" ms"),U=N=1}}return ad=this._findBestLevel(R,V,ac,ae,Q,aa+O,U,N,S),Math.max(ad,0)}}]),f}(I["default"]);z["default"]=D},{30:30,31:31,32:32,34:34,49:49,51:51}],6:[function(V,D,G){function O(f){return f&&f.__esModule?f:{"default":f}}function Z(g,f){if(!(g instanceof f)){throw new TypeError("Cannot call a class as a function")}}function K(g,f){if(!g){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return !f||"object"!=typeof f&&"function"!=typeof f?g:f}function F(g,f){if("function"!=typeof f&&null!==f){throw new TypeError("Super expression must either be null or a function, not "+typeof f)}g.prototype=Object.create(f&&f.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(g,f):g.__proto__=f)}Object.defineProperty(G,"__esModule",{value:!0});var J=function(){function f(l,h){for(var k=0;k<h.length;k++){var g=h[k];g.enumerable=g.enumerable||!1,g.configurable=!0,"value" in g&&(g.writable=!0),Object.defineProperty(l,g.key,g)}}return function(g,h,e){return h&&f(g.prototype,h),e&&f(g,e),g}}(),M=V(45),B=O(M),W=V(34),U=O(W),X=V(24),P=O(X),z=V(32),Q=O(z),I=V(31),x=O(I),L=V(35),j=O(L),C=V(52),N=O(C),Y=V(30),aa=V(51),w=V(48),H={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},q=function(g){function f(i){Z(this,f);var h=K(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,i,Q["default"].MEDIA_ATTACHED,Q["default"].MEDIA_DETACHING,Q["default"].AUDIO_TRACKS_UPDATED,Q["default"].AUDIO_TRACK_SWITCHING,Q["default"].AUDIO_TRACK_LOADED,Q["default"].KEY_LOADED,Q["default"].FRAG_LOADED,Q["default"].FRAG_PARSING_INIT_SEGMENT,Q["default"].FRAG_PARSING_DATA,Q["default"].FRAG_PARSED,Q["default"].ERROR,Q["default"].BUFFER_CREATED,Q["default"].BUFFER_APPENDED,Q["default"].BUFFER_FLUSHED,Q["default"].INIT_PTS_FOUND));return h.config=i.config,h.audioCodecSwap=!1,h.ticks=0,h._state=H.STOPPED,h.ontick=h.tick.bind(h),h.initPTS=[],h.waitingFragment=null,h.videoTrackCC=null,h}return F(f,g),J(f,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),x["default"].prototype.destroy.call(this),this.state=H.STOPPED}},{key:"onInitPtsFound",value:function(m){var k=m.id,l=m.frag.cc,h=m.initPTS;"main"===k&&(this.initPTS[l]=h,this.videoTrackCC=l,aa.logger.log("InitPTS for cc:"+l+" found from video track:"+h),this.state===H.WAITING_INIT_PTS&&(aa.logger.log("sending pending audio frag to demuxer"),this.state=H.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null))}},{key:"startLoad",value:function(i){if(this.tracks){var h=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,h>0&&i===-1?(aa.logger.log("audio:override startPosition with lastCurrentTime @"+h.toFixed(3)),this.state=H.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:i,this.state=H.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else{this.startPosition=i,this.state=H.STOPPED}}},{key:"stopLoad",value:function(){var h=this.fragCurrent;h&&(h.loader&&h.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=H.STOPPED}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){var az,al,ap,ax=this.hls,aC=ax.config;switch(this.state){case H.ERROR:case H.PAUSED:case H.BUFFER_FLUSHING:break;case H.STARTING:this.state=H.WAITING_TRACK,this.loadedmetadata=!1;break;case H.IDLE:var at=this.tracks;if(!at){break}if(!this.media&&(this.startFragRequested||!aC.startFragPrefetch)){break}az=this.loadedmetadata?this.media.currentTime:this.nextLoadPosition?this.nextLoadPosition:0;var an=this.mediaBuffer?this.mediaBuffer:this.media,ar=U["default"].bufferInfo(an,az,aC.maxBufferHole),av=ar.len,aA=ar.end,aB=this.fragPrevious,ay=aC.maxMaxBufferLength,aj=this.audioSwitch,aq=this.trackId;if((av<ay||aj)&&aq<at.length){if(ap=at[aq].details,"undefined"==typeof ap){this.state=H.WAITING_TRACK;break}if(!aj&&!ap.live&&aB&&aB.sn===ap.endSN&&(!this.media.seeking||this.media.duration-aA<aB.duration/2)){this.hls.trigger(Q["default"].BUFFER_EOS,{type:"audio"}),this.state=H.ENDED;break}var af=ap.fragments,au=af.length,u=af[0].start,ak=af[au-1].start+af[au-1].duration,aw=void 0;if(aj){if(ap.live&&!ap.PTSKnown){aa.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),aA=0}else{if(aA=az,ap.PTSKnown&&az<u){if(!(ar.end>u||ar.nextStart)){return}aa.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=u+0.05}}}if(ap.initSegment&&!ap.initSegment.data){aw=ap.initSegment}else{if(aA<=u){if(aw=af[0],null!==this.videoTrackCC&&aw.cc!==this.videoTrackCC&&(aw=(0,w.findFragWithCC)(af,this.videoTrackCC)),ap.live&&aw.loadIdx&&aw.loadIdx===this.fragLoadIdx){var A=ar.nextStart?ar.nextStart:u;return aa.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(A+0.05)),void (this.media.currentTime=A+0.05)}}else{var ae=void 0,ai=aC.maxFragLookUpTolerance,am=aB?af[aB.sn-af[0].sn+1]:void 0,ab=function(i){var h=Math.min(ai,i.duration);return i.start+i.duration-h<=aA?1:i.start-h>aA&&i.start?-1:0};aA<ak?(aA>ak-ai&&(ai=0),ae=am&&!ab(am)?am:B["default"].search(af,ab)):ae=af[au-1],ae&&(aw=ae,u=ae.start,aB&&aw.level===aB.level&&aw.sn===aB.sn&&(aw.sn<ap.endSN?(aw=af[aw.sn+1-ap.startSN],aa.logger.log("SN just loaded, load next one: "+aw.sn)):aw=null))}}if(aw){if(aw.decryptdata&&null!=aw.decryptdata.uri&&null==aw.decryptdata.key){aa.logger.log("Loading key for "+aw.sn+" of ["+ap.startSN+" ,"+ap.endSN+"],track "+aq),this.state=H.KEY_LOADING,ax.trigger(Q["default"].KEY_LOADING,{frag:aw})}else{if(aa.logger.log("Loading "+aw.sn+", cc: "+aw.cc+" of ["+ap.startSN+" ,"+ap.endSN+"],track "+aq+", currentTime:"+az+",bufferEnd:"+aA.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,aw.loadCounter){aw.loadCounter++;var ah=aC.fragLoadingLoopThreshold;if(aw.loadCounter>ah&&Math.abs(this.fragLoadIdx-aw.loadIdx)<ah){return void ax.trigger(Q["default"].ERROR,{type:Y.ErrorTypes.MEDIA_ERROR,details:Y.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:aw})}}else{aw.loadCounter=1}aw.loadIdx=this.fragLoadIdx,this.fragCurrent=aw,this.startFragRequested=!0,isNaN(aw.sn)||(this.nextLoadPosition=aw.start+aw.duration),ax.trigger(Q["default"].FRAG_LOADING,{frag:aw}),this.state=H.FRAG_LOADING}}}break;case H.WAITING_TRACK:al=this.tracks[this.trackId],al&&al.details&&(this.state=H.IDLE);break;case H.FRAG_LOADING_WAITING_RETRY:var ao=performance.now(),R=this.retryDate;an=this.media;var ag=an&&an.seeking;(!R||ao>=R||ag)&&(aa.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=H.IDLE);break;case H.WAITING_INIT_PTS:if(void 0===this.initPTS[this.videoTrackCC]){break}var ad=this.waitingFragment;if(ad){var ac=ad.frag.cc;this.videoTrackCC!==ac?(aa.logger.warn("Waiting fragment CC ("+ac+") does not match video track CC ("+this.videoTrackCC+")"),this.waitingFragment=null,this.state=H.IDLE):(this.onFragLoaded(this.waitingFragment),this.state=H.FRAG_LOADING,this.waitingFragment=null)}else{this.state=H.IDLE}break;case H.STOPPED:case H.FRAG_LOADING:case H.PARSING:case H.PARSED:case H.ENDED:}}},{key:"onMediaAttached",value:function(k){var h=this.media=this.mediaBuffer=k.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),h.addEventListener("seeking",this.onvseeking),h.addEventListener("ended",this.onvended);var i=this.config;this.tracks&&i.autoStartLoad&&this.startLoad(i.startPosition)}},{key:"onMediaDetaching",value:function(){var i=this.media;i&&i.ended&&(aa.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var h=this.tracks;h&&h.forEach(function(k){k.details&&k.details.fragments.forEach(function(l){l.loadCounter=void 0})}),i&&(i.removeEventListener("seeking",this.onvseeking),i.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){this.state===H.ENDED&&(this.state=H.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaEnded",value:function(){this.startPosition=this.lastCurrentTime=0}},{key:"onAudioTracksUpdated",value:function(h){aa.logger.log("audio tracks updated"),this.tracks=h.audioTracks}},{key:"onAudioTrackSwitching",value:function(i){var h=!!i.url;this.trackId=i.id,this.state=H.IDLE,this.fragCurrent=null,this.state=H.PAUSED,this.waitingFragment=null,h?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),h&&(this.audioSwitch=!0,this.state=H.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()}},{key:"onAudioTrackLoaded",value:function(u){var l=u.details,p=u.id,k=this.tracks[p],h=l.totalduration,y=0;if(aa.logger.log("track "+p+" loaded ["+l.startSN+","+l.endSN+"],duration:"+h),l.live){var m=k.details;m&&l.fragments.length>0?(j["default"].mergeDetails(m,l),y=l.fragments[0].start,l.PTSKnown?aa.logger.log("live audio playlist sliding:"+y.toFixed(3)):aa.logger.log("live audio playlist - outdated PTS, unknown sliding")):(l.PTSKnown=!1,aa.logger.log("live audio playlist - first load, unknown sliding"))}else{l.PTSKnown=!1}if(k.details=l,!this.startFragRequested){if(this.startPosition===-1){var v=l.startTimeOffset;isNaN(v)?this.startPosition=0:(aa.logger.log("start time offset found in playlist, adjust startPosition to "+v),this.startPosition=v)}this.nextLoadPosition=this.startPosition}this.state===H.WAITING_TRACK&&(this.state=H.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===H.KEY_LOADING&&(this.state=H.IDLE,this.tick())}},{key:"onFragLoaded",value:function(E){var ad=this.fragCurrent,h=E.frag;if(this.state===H.FRAG_LOADING&&ad&&"audio"===h.type&&h.level===ad.level&&h.sn===ad.sn){var y=this.tracks[this.trackId],T=y.details,m=T.totalduration,ae=ad.level,k=ad.sn,p=ad.cc,ac=this.config.defaultAudioCodec||y.audioCodec||"mp4a.40.2",R=this.stats=E.stats;if("initSegment"===k){this.state=H.IDLE,R.tparsed=R.tbuffered=performance.now(),T.initSegment.data=E.payload,this.hls.trigger(Q["default"].FRAG_BUFFERED,{stats:R,frag:ad,id:"audio"}),this.tick()}else{this.state=H.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new P["default"](this.hls,"audio"));var A=this.initPTS[p],S=T.initSegment?T.initSegment.data:[];if(T.initSegment||void 0!==A){this.pendingBuffering=!0,aa.logger.log("Demuxing "+k+" of ["+T.startSN+" ,"+T.endSN+"],track "+ae);var ab=!1;this.demuxer.push(E.payload,S,ac,null,ad,m,ab,A)}else{aa.logger.log("unknown video PTS for continuity counter "+p+", waiting for video PTS before demuxing audio frag "+k+" of ["+T.startSN+" ,"+T.endSN+"],track "+ae),this.waitingFragment=E,this.state=H.WAITING_INIT_PTS}}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(p){var l=this.fragCurrent,o=p.frag;if(l&&"audio"===p.id&&o.sn===l.sn&&o.level===l.level&&this.state===H.PARSING){var k=p.tracks,h=void 0;if(k.video&&delete k.video,h=k.audio){h.levelCodec="mp4a.40.2",h.id=p.id,this.hls.trigger(Q["default"].BUFFER_CODECS,k),aa.logger.log("audio track:audio,container:"+h.container+",codecs[level/parsed]=["+h.levelCodec+"/"+h.codec+"]");var u=h.initSegment;if(u){var m={type:"audio",data:u,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[m]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(Q["default"].BUFFER_APPENDING,m))}this.tick()}}}},{key:"onFragParsingData",value:function(A){var T=this,h=this.fragCurrent,v=A.frag;if(h&&"audio"===A.id&&"audio"===A.type&&v.sn===h.sn&&v.level===h.level&&this.state===H.PARSING){var R=this.trackId,m=this.tracks[R],ab=this.hls;isNaN(A.endPTS)&&(A.endPTS=A.startPTS+h.duration,A.endDTS=A.startDTS+h.duration),aa.logger.log("parsed "+A.type+",PTS:["+A.startPTS.toFixed(3)+","+A.endPTS.toFixed(3)+"],DTS:["+A.startDTS.toFixed(3)+"/"+A.endDTS.toFixed(3)+"],nb:"+A.nb),j["default"].updateFragPTSDTS(m.details,h.sn,A.startPTS,A.endPTS);var k=this.audioSwitch,p=this.media,S=!1;if(k&&p){if(p.readyState){var E=p.currentTime;aa.logger.log("switching audio track : currentTime:"+E),E>=A.startPTS&&(aa.logger.log("switching audio track : flushing all audio"),this.state=H.BUFFER_FLUSHING,ab.trigger(Q["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),S=!0,this.audioSwitch=!1,ab.trigger(Q["default"].AUDIO_TRACK_SWITCHED,{id:R}))}else{this.audioSwitch=!1,ab.trigger(Q["default"].AUDIO_TRACK_SWITCHED,{id:R})}}var y=this.pendingData;this.audioSwitch||([A.data1,A.data2].forEach(function(e){e&&e.length&&y.push({type:A.type,data:e,parent:"audio",content:"data"})}),!S&&y.length&&(y.forEach(function(i){T.state===H.PARSING&&(T.pendingBuffering=!0,T.hls.trigger(Q["default"].BUFFER_APPENDING,i))}),this.pendingData=[],this.appended=!0)),this.tick()}}},{key:"onFragParsed",value:function(k){var h=this.fragCurrent,i=k.frag;h&&"audio"===k.id&&i.sn===h.sn&&i.level===h.level&&this.state===H.PARSING&&(this.stats.tparsed=performance.now(),this.state=H.PARSED,this._checkAppendedParsed())}},{key:"onBufferCreated",value:function(i){var h=i.tracks.audio;h&&(this.mediaBuffer=h.buffer,this.loadedmetadata=!0)}},{key:"onBufferAppended",value:function(i){if("audio"===i.parent){var h=this.state;h!==H.PARSING&&h!==H.PARSED||(this.pendingBuffering=i.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(!(this.state!==H.PARSED||this.appended&&this.pendingBuffering)){var m=this.fragCurrent,k=this.stats,l=this.hls;if(m){this.fragPrevious=m,k.tbuffered=performance.now(),l.trigger(Q["default"].FRAG_BUFFERED,{stats:k,frag:m,id:"audio"});var h=this.mediaBuffer?this.mediaBuffer:this.media;aa.logger.log("audio buffered : "+N["default"].toString(h.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,l.trigger(Q["default"].AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=H.IDLE}this.tick()}}},{key:"onError",value:function(v){var A=v.frag;if(!A||"audio"===A.type){switch(v.details){case Y.ErrorDetails.FRAG_LOAD_ERROR:case Y.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!v.fatal){var h=this.fragLoadError;h?h++:h=1;var u=this.config;if(h<=u.fragLoadingMaxRetry){this.fragLoadError=h,A.loadCounter=0;var y=Math.min(Math.pow(2,h-1)*u.fragLoadingRetryDelay,u.fragLoadingMaxRetryTimeout);aa.logger.warn("audioStreamController: frag loading failed, retry in "+y+" ms"),this.retryDate=performance.now()+y,this.state=H.FRAG_LOADING_WAITING_RETRY}else{aa.logger.error("audioStreamController: "+v.details+" reaches max retry, redispatch as fatal ..."),v.fatal=!0,this.state=H.ERROR}}break;case Y.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case Y.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case Y.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case Y.ErrorDetails.KEY_LOAD_ERROR:case Y.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==H.ERROR&&(this.state=v.fatal?H.ERROR:H.IDLE,aa.logger.warn("audioStreamController: "+v.details+" while loading frag,switch to "+this.state+" state ..."));break;case Y.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===v.parent&&(this.state===H.PARSING||this.state===H.PARSED)){var m=this.mediaBuffer,E=this.media.currentTime,k=m&&U["default"].isBuffered(m,E)&&U["default"].isBuffered(m,E+0.5);if(k){var p=this.config;p.maxMaxBufferLength>=p.maxBufferLength&&(p.maxMaxBufferLength/=2,aa.logger.warn("audio:reduce max buffer length to "+p.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*p.fragLoadingLoopThreshold),this.state=H.IDLE}else{aa.logger.warn("buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=H.BUFFER_FLUSHING,this.hls.trigger(Q["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}}}}},{key:"onBufferFlushed",value:function(){var i=this,h=this.pendingData;h&&h.length?(aa.logger.log("appending pending audio data on Buffer Flushed"),h.forEach(function(e){i.hls.trigger(Q["default"].BUFFER_APPENDING,e)}),this.appended=!0,this.pendingData=[],this.state=H.PARSED):(this.state=H.IDLE,this.fragPrevious=null,this.tick())}},{key:"state",set:function(i){if(this.state!==i){var h=this.state;this._state=i,aa.logger.log("audio stream:"+h+"->"+i)}},get:function(){return this._state}}]),f}(x["default"]);G["default"]=q},{24:24,30:30,31:31,32:32,34:34,35:35,45:45,48:48,51:51,52:52}],7:[function(w,B,g){function p(f){return f&&f.__esModule?f:{"default":f}}function z(h,f){if(!(h instanceof f)){throw new TypeError("Cannot call a class as a function")}}function k(h,f){if(!h){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return !f||"object"!=typeof f&&"function"!=typeof f?h:f}function C(h,f){if("function"!=typeof f&&null!==f){throw new TypeError("Super expression must either be null or a function, not "+typeof f)}h.prototype=Object.create(f&&f.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(h,f):h.__proto__=f)}Object.defineProperty(g,"__esModule",{value:!0});var j=function(){function f(o,l){for(var n=0;n<l.length;n++){var h=l[n];h.enumerable=h.enumerable||!1,h.configurable=!0,"value" in h&&(h.writable=!0),Object.defineProperty(o,h.key,h)}}return function(h,l,e){return l&&f(h.prototype,l),e&&f(h,e),h}}(),m=w(32),A=p(m),x=w(31),v=p(x),y=w(51),q=function(h){function f(l){z(this,f);var i=k(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,l,A["default"].MANIFEST_LOADING,A["default"].MANIFEST_LOADED,A["default"].AUDIO_TRACK_LOADED));return i.ticks=0,i.ontick=i.tick.bind(i),i}return C(f,h),j(f,[{key:"destroy",value:function(){v["default"].prototype.destroy.call(this)}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){this.updateTrack(this.trackId)}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(u){var o=this,s=u.audioTracks||[],n=!1;this.tracks=s,this.hls.trigger(A["default"].AUDIO_TRACKS_UPDATED,{audioTracks:s});var l=0;s.forEach(function(i){return i["default"]?(o.audioTrack=l,void (n=!0)):void l++}),n===!1&&s.length&&(y.logger.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)}},{key:"onAudioTrackLoaded",value:function(i){i.id<this.tracks.length&&(y.logger.log("audioTrack "+i.id+" loaded"),this.tracks[i.id].details=i.details,i.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1000*i.details.targetduration)),!i.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setAudioTrackInternal",value:function(F){if(F>=0&&F<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=F,y.logger.log("switching to audioTrack "+F);var u=this.tracks[F],E=this.hls,o=u.type,l=u.url,G={id:F,type:o,url:l};E.trigger(A["default"].AUDIO_TRACK_SWITCH,G),E.trigger(A["default"].AUDIO_TRACK_SWITCHING,G);var D=u.details;!l||void 0!==D&&D.live!==!0||(y.logger.log("(re)loading playlist for audioTrack "+F),E.trigger(A["default"].AUDIO_TRACK_LOADING,{url:l,id:F}))}}},{key:"updateTrack",value:function(s){if(s>=0&&s<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=s,y.logger.log("updating audioTrack "+s);var n=this.tracks[s],o=n.url,l=n.details;!o||void 0!==l&&l.live!==!0||(y.logger.log("(re)loading playlist for audioTrack "+s),this.hls.trigger(A["default"].AUDIO_TRACK_LOADING,{url:o,id:s}))}}},{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(i){this.trackId===i&&void 0!==this.tracks[i].details||this.setAudioTrackInternal(i)}}]),f}(v["default"]);g["default"]=q},{31:31,32:32,51:51}],8:[function(x,D,g){function p(f){return f&&f.__esModule?f:{"default":f}}function A(h,f){if(!(h instanceof f)){throw new TypeError("Cannot call a class as a function")}}function k(h,f){if(!h){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return !f||"object"!=typeof f&&"function"!=typeof f?h:f}function E(h,f){if("function"!=typeof f&&null!==f){throw new TypeError("Super expression must either be null or a function, not "+typeof f)}h.prototype=Object.create(f&&f.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(h,f):h.__proto__=f)}Object.defineProperty(g,"__esModule",{value:!0});var j=function(){function f(o,l){for(var n=0;n<l.length;n++){var h=l[n];h.enumerable=h.enumerable||!1,h.configurable=!0,"value" in h&&(h.writable=!0),Object.defineProperty(o,h.key,h)}}return function(h,l,e){return l&&f(h.prototype,l),e&&f(h,e),h}}(),m=x(32),C=p(m),y=x(31),w=p(y),z=x(51),q=x(30),B=function(h){function f(l){A(this,f);var i=k(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,l,C["default"].MEDIA_ATTACHING,C["default"].MEDIA_DETACHING,C["default"].MANIFEST_PARSED,C["default"].BUFFER_RESET,C["default"].BUFFER_APPENDING,C["default"].BUFFER_CODECS,C["default"].BUFFER_EOS,C["default"].BUFFER_FLUSHING,C["default"].LEVEL_PTS_UPDATED,C["default"].LEVEL_UPDATED));return i._msDuration=null,i._levelDuration=null,i.onsbue=i.onSBUpdateEnd.bind(i),i.onsbe=i.onSBUpdateError.bind(i),i.pendingTracks={},i.tracks={},i}return E(f,h),j(f,[{key:"destroy",value:function(){w["default"].prototype.destroy.call(this)}},{key:"onLevelPtsUpdated",value:function(G){var u=G.type,F=this.tracks.audio;if("audio"===u&&F&&"audio/mpeg"===F.container){var o=this.sourceBuffer.audio,l=Math.abs(o.timestampOffset-G.start);if(l>0.1){var H=o.updating;try{o.abort()}catch(v){H=!0,z.logger.warn("can not abort audio buffer: "+v)}H?this.audioTimestampOffset=G.start:(z.logger.warn("change mpeg audio timestamp offset from "+o.timestampOffset+" to "+G.start),o.timestampOffset=G.start)}}}},{key:"onManifestParsed",value:function(s){var n=s.audio,o=s.video,l=0;s.altAudio&&(n||o)&&(l=(n?1:0)+(o?1:0),z.logger.log(l+" sourceBuffer(s) expected")),this.sourceBufferNb=l}},{key:"onMediaAttaching",value:function(n){var i=this.media=n.media;if(i){var l=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),l.addEventListener("sourceopen",this.onmso),l.addEventListener("sourceended",this.onmse),l.addEventListener("sourceclose",this.onmsc),i.src=URL.createObjectURL(l)}}},{key:"onMediaDetaching",value:function(){z.logger.log("media source detaching");var l=this.mediaSource;if(l){if("open"===l.readyState){try{l.endOfStream()}catch(i){z.logger.warn("onMediaDetaching:"+i.message+" while calling endOfStream")}}l.removeEventListener("sourceopen",this.onmso),l.removeEventListener("sourceended",this.onmse),l.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this.media.src),this.media.removeAttribute("src"),this.media.load()),this.mediaSource=null,this.media=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(C["default"].MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){z.logger.log("media source opened"),this.hls.trigger(C["default"].MEDIA_ATTACHED,{media:this.media});var i=this.mediaSource;i&&i.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()}},{key:"checkPendingTracks",value:function(){var l=this.pendingTracks,i=Object.keys(l).length;i&&(this.sourceBufferNb<=i||0===this.sourceBufferNb)&&(this.createSourceBuffers(l),this.pendingTracks={},this.doAppending())}},{key:"onMediaSourceClose",value:function(){z.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){z.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){if(this.audioTimestampOffset){var n=this.sourceBuffer.audio;z.logger.warn("change mpeg audio timestamp offset from "+n.timestampOffset+" to "+this.audioTimestampOffset),n.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var i=this.parent,l=this.segments.reduce(function(s,o){return o.parent===i?s+1:s},0);this.hls.trigger(C["default"].BUFFER_APPENDED,{parent:i,pending:l}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()}},{key:"onSBUpdateError",value:function(i){z.logger.error("sourceBuffer error:",i),this.hls.trigger(C["default"].ERROR,{type:q.ErrorTypes.MEDIA_ERROR,details:q.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var s=this.sourceBuffer;for(var n in s){var o=s[n];try{this.mediaSource.removeSourceBuffer(o),o.removeEventListener("updateend",this.onsbue),o.removeEventListener("error",this.onsbe)}catch(l){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}},{key:"onBufferCodecs",value:function(n){if(0===Object.keys(this.sourceBuffer).length){for(var i in n){this.pendingTracks[i]=n[i]}var l=this.mediaSource;l&&"open"===l.readyState&&this.checkPendingTracks()}}},{key:"createSourceBuffers",value:function(I){var K=this.sourceBuffer,u=this.mediaSource;for(var H in I){if(!K[H]){var J=I[H],F=J.levelCodec||J.codec,L=J.container+";codecs="+F;z.logger.log("creating sourceBuffer("+L+")");try{var v=K[H]=u.addSourceBuffer(L);v.addEventListener("updateend",this.onsbue),v.addEventListener("error",this.onsbe),this.tracks[H]={codec:F,container:J.container},J.buffer=v}catch(G){z.logger.error("error while trying to add sourceBuffer:"+G.message),this.hls.trigger(C["default"].ERROR,{type:q.ErrorTypes.MEDIA_ERROR,details:q.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:G,mimeType:L})}}}this.hls.trigger(C["default"].BUFFER_CREATED,{tracks:I})}},{key:"onBufferAppending",value:function(i){this._needsFlush||(this.segments?this.segments.push(i):this.segments=[i],this.doAppending())}},{key:"onBufferAppendFail",value:function(i){z.logger.error("sourceBuffer error:",i.event),this.hls.trigger(C["default"].ERROR,{type:q.ErrorTypes.MEDIA_ERROR,details:q.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferEos",value:function(s){var n=this.sourceBuffer,o=s.type;for(var l in n){o&&l!==o||n[l].ended||(n[l].ended=!0,z.logger.log(l+" sourceBuffer now EOS"))}this.checkEos()}},{key:"checkEos",value:function(){var u=this.sourceBuffer,o=this.mediaSource;if(!o||"open"!==o.readyState){return void (this._needsEos=!1)}for(var s in u){var n=u[s];if(!n.ended){return}if(n.updating){return void (this._needsEos=!0)}}z.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{o.endOfStream()}catch(l){z.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}},{key:"onBufferFlushing",value:function(i){this.flushRange.push({start:i.startOffset,end:i.endOffset,type:i.type}),this.flushBufferCounter=0,this.doFlush()}},{key:"onLevelUpdated",value:function(l){var i=l.details;0!==i.fragments.length&&(this._levelDuration=i.totalduration+i.fragments[0].start,this.updateMediaElementDuration())}},{key:"updateMediaElementDuration",value:function(){var v=this.media,s=this.mediaSource,u=this.sourceBuffer,o=this._levelDuration;if(null!==o&&v&&s&&u&&0!==v.readyState&&"open"===s.readyState){for(var l in u){if(u[l].updating){return}}null===this._msDuration&&(this._msDuration=s.duration);var F=v.duration;(o>this._msDuration&&o>F||F===1/0||isNaN(F))&&(z.logger.log("Updating mediasource duration to "+o.toFixed(3)),this._msDuration=s.duration=o)}}},{key:"doFlush",value:function(){for(;this.flushRange.length;){var u=this.flushRange[0];if(!this.flushBuffer(u.start,u.end,u.type)){return void (this._needsFlush=!0)}this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var o=0,s=this.sourceBuffer;try{for(var n in s){o+=s[n].buffered.length}}catch(l){z.logger.error("error while accessing sourceBuffer.buffered")}this.appended=o,this.hls.trigger(C["default"].BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var H=this.hls,v=this.sourceBuffer,G=this.segments;if(Object.keys(v).length){if(this.media.error){return this.segments=[],void z.logger.error("trying to append although a media error occured, flush segment and abort")}if(this.appending){return}if(G&&G.length){var u=G.shift();try{var l=u.type,J=v[l];J?J.updating?G.unshift(u):(J.ended=!1,this.parent=u.parent,J.appendBuffer(u.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(F){z.logger.error("error while trying to append buffer:"+F.message),G.unshift(u);var I={type:q.ErrorTypes.MEDIA_ERROR,parent:u.parent};if(22===F.code){return this.segments=[],I.details=q.ErrorDetails.BUFFER_FULL_ERROR,I.fatal=!1,void H.trigger(C["default"].ERROR,I)}if(this.appendError?this.appendError++:this.appendError=1,I.details=q.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>H.config.appendErrorMaxRetry){return z.logger.log("fail "+H.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),G=[],I.fatal=!0,void H.trigger(C["default"].ERROR,I)}I.fatal=!1,H.trigger(C["default"].ERROR,I)}}}}},{key:"flushBuffer",value:function(K,O,v){var I,M,G,P,F,H,N=this.sourceBuffer;if(Object.keys(N).length){if(z.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+K+"/"+O),this.flushBufferCounter<this.appended){for(var L in N){if(!v||L===v){if(I=N[L],I.ended=!1,I.updating){return z.logger.warn("cannot flush, sb updating in progress"),!1}try{for(M=0;M<I.buffered.length;M++){if(G=I.buffered.start(M),P=I.buffered.end(M),navigator.userAgent.toLowerCase().indexOf("firefox")!==-1&&O===Number.POSITIVE_INFINITY?(F=K,H=O):(F=Math.max(G,K),H=Math.min(P,O)),Math.min(H,P)-F>0.5){return this.flushBufferCounter++,z.logger.log("flush "+L+" ["+F+","+H+"], of ["+G+","+P+"], pos:"+this.media.currentTime),I.remove(F,H),!1}}}catch(J){z.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}}else{z.logger.warn("abort flushing too many retries")}z.logger.log("buffer flushed")}return !0}}]),f}(w["default"]);g["default"]=B},{30:30,31:31,32:32,51:51}],9:[function(q,z,g){function m(f){return f&&f.__esModule?f:{"default":f}}function x(i,f){if(!(i instanceof f)){throw new TypeError("Cannot call a class as a function")}}function j(i,f){if(!i){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return !f||"object"!=typeof f&&"function"!=typeof f?i:f}function A(i,f){if("function"!=typeof f&&null!==f){throw new TypeError("Super expression must either be null or a function, not "+typeof f)}i.prototype=Object.create(f&&f.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(i,f):i.__proto__=f)}Object.defineProperty(g,"__esModule",{value:!0});var h=function(){function f(s,n){for(var o=0;o<n.length;o++){var l=n[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value" in l&&(l.writable=!0),Object.defineProperty(s,l.key,l)}}return function(l,n,e){return n&&f(l.prototype,n),e&&f(l,e),l}}(),k=q(32),y=m(k),v=q(31),p=m(v),w=function(i){function f(l){return x(this,f),j(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,l,y["default"].FPS_DROP_LEVEL_CAPPING,y["default"].MEDIA_ATTACHING,y["default"].MANIFEST_PARSED))}return A(f,i),h(f,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))}},{key:"onFpsDropLevelCapping",value:function(l){f.isLevelAllowed(l.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(l.droppedLevel)}},{key:"onMediaAttaching",value:function(l){this.media=l.media instanceof HTMLVideoElement?l.media:null}},{key:"onManifestParsed",value:function(n){var l=this.hls;l.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=n.levels,l.firstLevel=this.getMaxLevel(n.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1000),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function(){if(this.media){var n=this.levels?this.levels.length:0;if(n){var l=this.hls;l.autoLevelCapping=this.getMaxLevel(n-1),l.autoLevelCapping>this.autoLevelCapping&&l.streamController.nextLevelSwitch(),this.autoLevelCapping=l.autoLevelCapping}}}},{key:"getMaxLevel",value:function(o){var n=this;if(!this.levels){return -1}var l=this.levels.filter(function(r,e){return f.isLevelAllowed(e,n.restrictedLevels)&&e<=o});return f.getMaxLevelByMediaSize(l,this.mediaWidth,this.mediaHeight)}},{key:"mediaWidth",get:function(){var n=void 0,l=this.media;return l&&(n=l.width||l.clientWidth||l.offsetWidth,n*=f.contentScaleFactor),n}},{key:"mediaHeight",get:function(){var n=void 0,l=this.media;return l&&(n=l.height||l.clientHeight||l.offsetHeight,n*=f.contentScaleFactor),n}}],[{key:"isLevelAllowed",value:function(n){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return l.indexOf(n)===-1}},{key:"getMaxLevelByMediaSize",value:function(D,u,C){if(!D||D&&!D.length){return -1}for(var o=function(r,n){return !n||(r.width!==n.width||r.height!==n.height)},l=D.length-1,E=0;E<D.length;E+=1){var B=D[E];if((B.width>=u||B.height>=C)&&o(B,D[E+1])){l=E;break}}return l}},{key:"contentScaleFactor",get:function(){var n=1;try{n=window.devicePixelRatio}catch(l){}return n}}]),f}(p["default"]);g["default"]=w},{31:31,32:32}],10:[function(w,B,g){function p(f){return f&&f.__esModule?f:{"default":f}}function z(h,f){if(!(h instanceof f)){throw new TypeError("Cannot call a class as a function")}}function k(h,f){if(!h){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return !f||"object"!=typeof f&&"function"!=typeof f?h:f}function C(h,f){if("function"!=typeof f&&null!==f){throw new TypeError("Super expression must either be null or a function, not "+typeof f)}h.prototype=Object.create(f&&f.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(h,f):h.__proto__=f)}Object.defineProperty(g,"__esModule",{value:!0});var j=function(){function f(o,l){for(var n=0;n<l.length;n++){var h=l[n];h.enumerable=h.enumerable||!1,h.configurable=!0,"value" in h&&(h.writable=!0),Object.defineProperty(o,h.key,h)}}return function(h,l,e){return l&&f(h.prototype,l),e&&f(h,e),h}}(),m=w(32),A=p(m),x=w(31),v=p(x),y=w(51),q=function(h){function f(i){return z(this,f),k(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,i,A["default"].MEDIA_ATTACHING))}return C(f,h),j(f,[{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1}},{key:"onMediaAttaching",value:function(n){var i=this.hls.config;if(i.capLevelOnFPSDrop){var l=this.video=n.media instanceof HTMLVideoElement?n.media:null;"function"==typeof l.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}},{key:"checkFPS",value:function(H,K,u){var G=performance.now();if(K){if(this.lastTime){var J=G-this.lastTime,E=u-this.lastDroppedFrames,L=K-this.lastDecodedFrames,D=1000*E/J,F=this.hls;if(F.trigger(A["default"].FPS_DROP,{currentDropped:E,currentDecoded:L,totalDroppedFrames:u}),D>0&&E>F.config.fpsDroppedMonitoringThreshold*L){var I=F.currentLevel;y.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+I),I>0&&(F.autoLevelCapping===-1||F.autoLevelCapping>=I)&&(I-=1,F.trigger(A["default"].FPS_DROP_LEVEL_CAPPING,{level:I,droppedLevel:F.currentLevel}),F.autoLevelCapping=I,F.streamController.nextLevelSwitch())}}this.lastTime=G,this.lastDroppedFrames=u,this.lastDecodedFrames=K}}},{key:"checkFPSInterval",value:function(){var l=this.video;if(l){if(this.isVideoPlaybackQualityAvailable){var i=l.getVideoPlaybackQuality();this.checkFPS(l,i.totalVideoFrames,i.droppedVideoFrames)}else{this.checkFPS(l,l.webkitDecodedFrameCount,l.webkitDroppedFrameCount)}}}}]),f}(v["default"]);g["default"]=q},{31:31,32:32,51:51}],11:[function(B,H,j){function x(f){return f&&f.__esModule?f:{"default":f}}function E(g,f){if(!(g instanceof f)){throw new TypeError("Cannot call a class as a function")}}function q(g,f){if(!g){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return !f||"object"!=typeof f&&"function"!=typeof f?g:f}function I(g,f){if("function"!=typeof f&&null!==f){throw new TypeError("Super expression must either be null or a function, not "+typeof f)}g.prototype=Object.create(f&&f.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(g,f):g.__proto__=f)}Object.defineProperty(j,"__esModule",{value:!0});var m=function(){function f(n,h){for(var l=0;l<h.length;l++){var g=h[l];g.enumerable=g.enumerable||!1,g.configurable=!0,"value" in g&&(g.writable=!0),Object.defineProperty(n,g.key,g)}}return function(g,h,e){return h&&f(g.prototype,h),e&&f(g,e),g}}(),w=B(32),G=x(w),C=B(31),A=x(C),D=B(51),y=B(30),F=B(34),z=x(F),k=function(g){function f(i){E(this,f);var h=q(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,i,G["default"].MANIFEST_LOADED,G["default"].LEVEL_LOADED,G["default"].FRAG_LOADED,G["default"].ERROR));return h.ontick=h.tick.bind(h),h._manualLevel=-1,h}return I(f,g),m(f,[{key:"destroy",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this._manualLevel=-1}},{key:"startLoad",value:function(){this.canload=!0;var h=this._levels;h&&h.forEach(function(l){l.loadError=0;var i=l.details;i&&i.live&&(l.details=void 0)}),this.timer&&this.tick()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function(L){var O,h=[],J=[],N={},u=!1,P=!1,p=this.hls,v=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),M=function(l,i){return MediaSource.isTypeSupported(l+"/mp4;codecs="+i)};if(L.levels.forEach(function(l){l.videoCodec&&(u=!0),v&&l.audioCodec&&l.audioCodec.indexOf("mp4a.40.34")!==-1&&(l.audioCodec=void 0),(l.audioCodec||l.attrs&&l.attrs.AUDIO)&&(P=!0);var i=N[l.bitrate];void 0===i?(N[l.bitrate]=h.length,l.url=[l.url],l.urlId=0,h.push(l)):h[i].url.push(l.url)}),u&&P?h.forEach(function(i){i.videoCodec&&J.push(i)}):J=h,J=J.filter(function(n){var i=n.audioCodec,l=n.videoCodec;return(!i||M("audio",i))&&(!l||M("video",l))}),J.length){O=J[0].bitrate,J.sort(function(l,i){return l.bitrate-i.bitrate}),this._levels=J;for(var K=0;K<J.length;K++){if(J[K].bitrate===O){this._firstLevel=K,D.logger.log("manifest loaded,"+J.length+" level(s) found, first bitrate:"+O);break}}p.trigger(G["default"].MANIFEST_PARSED,{levels:J,firstLevel:this._firstLevel,stats:L.stats,audio:P,video:u,altAudio:L.audioTracks.length>0})}else{p.trigger(G["default"].ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:p.url,reason:"no level with compatible codecs found in manifest"})}}},{key:"setLevelInternal",value:function(v){var o=this._levels,u=this.hls;if(v>=0&&v<o.length){if(this.timer&&(clearTimeout(this.timer),this.timer=null),this._level!==v){D.logger.log("switching to level "+v),this._level=v;var l=o[v];l.level=v,u.trigger(G["default"].LEVEL_SWITCH,l),u.trigger(G["default"].LEVEL_SWITCHING,l)}var h=o[v],J=h.details;if(!J||J.live===!0){var p=h.urlId;u.trigger(G["default"].LEVEL_LOADING,{url:h.url[p],level:v,id:p})}}else{u.trigger(G["default"].ERROR,{type:y.ErrorTypes.OTHER_ERROR,details:y.ErrorDetails.LEVEL_SWITCH_ERROR,level:v,fatal:!1,reason:"invalid level idx"})}}},{key:"onError",value:function(M){if(!M.fatal){var Q=M.details,h=this.hls,K=void 0,O=void 0,u=!1,R=!1;switch(Q){case y.ErrorDetails.FRAG_LOAD_ERROR:case y.ErrorDetails.FRAG_LOAD_TIMEOUT:case y.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case y.ErrorDetails.KEY_LOAD_ERROR:case y.ErrorDetails.KEY_LOAD_TIMEOUT:K=M.frag.level;break;case y.ErrorDetails.LEVEL_LOAD_ERROR:case y.ErrorDetails.LEVEL_LOAD_TIMEOUT:K=M.context.level,u=!0;break;case y.ErrorDetails.REMUX_ALLOC_ERROR:K=M.level;break;case y.ErrorDetails.MANIFEST_EMPTY_ERROR:K=M.context.level,u=!0,R=!0}if(void 0!==K){O=this._levels[K],O.loadError?O.loadError++:O.loadError=1;var p=O.url.length;if(p>1&&O.loadError<p){O.urlId=(O.urlId+1)%p,O.details=void 0,D.logger.warn("level controller,"+Q+" for level "+K+": switching to redundant stream id "+O.urlId)}else{R&&(D.logger.warn("Bad level encountered, removing & forcing to auto mode"),this._levels=this.levels.filter(function(l,i){return i!==K}),h.currentLevel=-1,h.trigger(G["default"].LEVEL_REMOVED,{level:K}));var J=this._manualLevel===-1&&K;if(J){D.logger.warn("level controller,"+Q+": switch-down for next fragment"),h.nextAutoLevel=Math.max(0,K-1)}else{if(O&&O.details&&O.details.live){D.logger.warn("level controller,"+Q+" on live stream, discard"),u&&(this._level=void 0)}else{if(Q===y.ErrorDetails.LEVEL_LOAD_ERROR||Q===y.ErrorDetails.LEVEL_LOAD_TIMEOUT){var N=h.media,L=N&&z["default"].isBuffered(N,N.currentTime)&&z["default"].isBuffered(N,N.currentTime+0.5);if(L){var P=h.config.levelLoadingRetryDelay;D.logger.warn("level controller,"+Q+", but media buffered, retry in "+P+"ms"),this.timer=setTimeout(this.ontick,P)}else{D.logger.error("cannot recover "+Q+" error"),this._level=void 0,this.timer&&(clearTimeout(this.timer),this.timer=null),M.fatal=!0}}}}}}}}},{key:"onFragLoaded",value:function(l){var h=l.frag;if(h&&"main"===h.type){var i=this._levels[h.level];i&&(i.loadError=0)}}},{key:"onLevelLoaded",value:function(v){var o=v.level;if(o===this._level){var u=this._levels[o];u.loadError=0;var l=v.details;if(l.live){var h=1000*(l.averagetargetduration?l.averagetargetduration:l.targetduration),J=this._levels[v.level],p=J.details;p&&l.endSN===p.endSN&&(h/=2,D.logger.log("same live playlist, reload twice faster")),h-=performance.now()-v.stats.trequest,h=Math.max(1000,Math.round(h)),D.logger.log("live playlist, reload in "+h+" ms"),this.timer=setTimeout(this.ontick,h)}else{this.timer=null}}}},{key:"tick",value:function(){var l=this._level;if(void 0!==l&&this.canload){var h=this._levels[l];if(h&&h.url){var i=h.urlId;this.hls.trigger(G["default"].LEVEL_LOADING,{url:h.url[i],level:l,id:i})}}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(i){var h=this._levels;h&&h.length>i&&(this._level===i&&void 0!==h[i].details||this.setLevelInternal(i))}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(h){this._manualLevel=h,void 0===this._startLevel&&(this._startLevel=h),h!==-1&&(this.level=h)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(h){this._firstLevel=h}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var h=this.hls.config.startLevel;return void 0!==h?h:this._firstLevel}return this._startLevel},set:function(h){this._startLevel=h}},{key:"nextLoadLevel",get:function(){return this._manualLevel!==-1?this._manualLevel:this.hls.nextAutoLevel},set:function(h){this.level=h,this._manualLevel===-1&&(this.hls.nextAutoLevel=h)}}]),f}(A["default"]);j["default"]=k},{30:30,31:31,32:32,34:34,51:51}],12:[function(V,D,G){function O(f){return f&&f.__esModule?f:{"default":f}}function Z(g,f){if(!(g instanceof f)){throw new TypeError("Cannot call a class as a function")}}function K(g,f){if(!g){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return !f||"object"!=typeof f&&"function"!=typeof f?g:f}function F(g,f){if("function"!=typeof f&&null!==f){throw new TypeError("Super expression must either be null or a function, not "+typeof f)}g.prototype=Object.create(f&&f.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(g,f):g.__proto__=f)}Object.defineProperty(G,"__esModule",{value:!0});var J=function(){function f(l,h){for(var k=0;k<h.length;k++){var g=h[k];g.enumerable=g.enumerable||!1,g.configurable=!0,"value" in g&&(g.writable=!0),Object.defineProperty(l,g.key,g)}}return function(g,h,e){return h&&f(g.prototype,h),e&&f(g,e),g}}(),M=V(45),B=O(M),W=V(34),U=O(W),X=V(24),P=O(X),z=V(32),Q=O(z),I=V(31),x=O(I),L=V(35),j=O(L),C=V(52),N=O(C),Y=V(30),aa=V(51),w=V(48),H={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},q=function(g){function f(i){Z(this,f);var h=K(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,i,Q["default"].MEDIA_ATTACHED,Q["default"].MEDIA_DETACHING,Q["default"].MANIFEST_LOADING,Q["default"].MANIFEST_PARSED,Q["default"].LEVEL_LOADED,Q["default"].KEY_LOADED,Q["default"].FRAG_LOADED,Q["default"].FRAG_LOAD_EMERGENCY_ABORTED,Q["default"].FRAG_PARSING_INIT_SEGMENT,Q["default"].FRAG_PARSING_DATA,Q["default"].FRAG_PARSED,Q["default"].ERROR,Q["default"].AUDIO_TRACK_SWITCHING,Q["default"].AUDIO_TRACK_SWITCHED,Q["default"].BUFFER_CREATED,Q["default"].BUFFER_APPENDED,Q["default"].BUFFER_FLUSHED,Q["default"].LEVEL_REMOVED));return h.config=i.config,h.audioCodecSwap=!1,h.ticks=0,h._state=H.STOPPED,h.ontick=h.tick.bind(h),h}return F(f,g),J(f,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),x["default"].prototype.destroy.call(this),this.state=H.STOPPED}},{key:"startLoad",value:function(m){if(this.levels){var k=this.lastCurrentTime,l=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var h=l.startLevel;h===-1&&(h=0,this.bitrateTest=!0),this.level=l.nextLoadLevel=h,this.loadedmetadata=!1}k>0&&m===-1&&(aa.logger.log("override startPosition with lastCurrentTime @"+k.toFixed(3)),m=k),this.state=H.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=m,this.tick()}else{this.forceStartLoad=!0,this.state=H.STOPPED}}},{key:"stopLoad",value:function(){var h=this.fragCurrent;h&&(h.loader&&h.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=H.STOPPED,this.forceStartLoad=!1}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){switch(this.state){case H.ERROR:break;case H.BUFFER_FLUSHING:this.fragLoadError=0;break;case H.IDLE:if(!this._doTickIdle()){return}break;case H.WAITING_LEVEL:var k=this.levels[this.level];k&&k.details&&(this.state=H.IDLE);break;case H.FRAG_LOADING_WAITING_RETRY:var h=performance.now(),i=this.retryDate;(!i||h>=i||this.media&&this.media.seeking)&&(aa.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=H.IDLE);break;case H.ERROR:case H.STOPPED:case H.FRAG_LOADING:case H.PARSING:case H.PARSED:case H.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"_doTickIdle",value:function(){var R=this.hls,ae=R.config,k=this.media;if(void 0!==this.levelLastLoaded&&!k&&(this.startFragRequested||!ae.startFragPrefetch)){return !0}var A=0;this.loadedmetadata?A=k.currentTime:this.nextLoadPosition&&(A=this.nextLoadPosition);var ab=R.nextLoadLevel,p=this.levels[ab],af=p.bitrate,m=void 0;m=af?Math.max(8*ae.maxBufferSize/af,ae.maxBufferLength):ae.maxBufferLength,m=Math.min(m,ae.maxMaxBufferLength);var y=U["default"].bufferInfo(this.mediaBuffer?this.mediaBuffer:k,A,ae.maxBufferHole),ad=y.len;if(ad>=m){return !0}aa.logger.trace("buffer length of "+ad.toFixed(3)+" is below max of "+m.toFixed(3)+". checking for more payload ..."),this.level=R.nextLoadLevel=ab;var S=p.details;if("undefined"==typeof S||S.live&&this.levelLastLoaded!==ab){return this.state=H.WAITING_LEVEL,!0}var T=this.fragPrevious;if(!S.live&&T&&T.sn===S.endSN){var E=Math.min(k.duration,T.start+T.duration);if(E-Math.max(y.end,T.start)<=Math.max(0.2,T.duration/2)){var ac={};return this.altAudio&&(ac.type="video"),this.hls.trigger(Q["default"].BUFFER_EOS,ac),this.state=H.ENDED,!0}}return this._fetchPayloadOrEos(A,y,S)}},{key:"_fetchPayloadOrEos",value:function(A,T,h){var v=this.fragPrevious,R=this.level,m=h.fragments,ab=m.length;if(0===ab){return !1}var k=m[0].start,p=m[ab-1].start+m[ab-1].duration,S=T.end,E=void 0;if(h.initSegment&&!h.initSegment.data){E=h.initSegment}else{if(h.live){var y=this.config.initialLiveManifestSize;if(ab<y){return aa.logger.warn("Can not start playback of a level, reason: not enough fragments "+ab+" < "+y),!1}if(E=this._ensureFragmentAtLivePoint(h,S,k,p,v,m,ab),null===E){return !1}}else{S<k&&(E=m[0])}}return E||(E=this._findFragment(k,v,ab,m,S,p,h)),!E||this._loadFragmentOrKey(E,R,h,A,S)}},{key:"_ensureFragmentAtLivePoint",value:function(R,ad,k,y,ab,p,ae){var m=this.hls.config,v=this.media,ac=void 0,S=void 0!==m.liveMaxLatencyDuration?m.liveMaxLatencyDuration:m.liveMaxLatencyDurationCount*R.targetduration;if(ad<Math.max(k-m.maxFragLookUpTolerance,y-S)){var E=this.liveSyncPosition=this.computeLivePosition(k,R);aa.logger.log("buffer end: "+ad.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+E.toFixed(3)),ad=E,v&&v.readyState&&v.duration>E&&(v.currentTime=E),this.nextLoadPosition=E}if(R.PTSKnown&&ad>y&&v&&v.readyState){return null}if(this.startFragRequested&&!R.PTSKnown){if(ab){var T=ab.sn+1,A=ab.cc+1;T>=R.startSN&&T<=R.endSN?(ac=p[T-R.startSN],aa.logger.log("live playlist, switching playlist, load frag with next SN: "+ac.sn)):A>=R.startCC&&A<=R.endCC&&(ac=(0,w.findFirstFragWithCC)(p,A),aa.logger.log("Live playlist switch, cannot find frag with target SN. Loading frag with next CC: "+ac.cc))}ac||(ac=p[Math.min(ae-1,Math.round(ae/2))],aa.logger.log("live playlist, switching playlist, unknown, load middle frag : "+ac.sn))}return ac}},{key:"_findFragment",value:function(ai,A,R,ae,al,ab,E){var T=this.hls.config,ad=void 0,aj=void 0,ah=T.maxFragLookUpTolerance,ak=A?ae[A.sn-ae[0].sn+1]:void 0,af=function(i){var h=Math.min(ah,i.duration);return i.start+i.duration-h<=al?1:i.start-h>al&&i.start?-1:0};if(al<ab?(al>ab-ah&&(ah=0),aj=ak&&!af(ak)?ak:B["default"].search(ae,af)):aj=ae[R-1],aj){ad=aj;var u=ad.sn-E.startSN,ag=A&&ad.level===A.level,S=ae[u-1],k=ae[u+1];if(A&&ad.sn===A.sn){if(ag&&!ad.backtracked){if(ad.sn<E.endSN){var ac=A.deltaPTS;ac&&ac>T.maxBufferHole&&A.dropped&&u&&!ad.backtracked?(ad=S,aa.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),A.loadCounter--):(ad=k,aa.logger.log("SN just loaded, load next one: "+ad.sn))}else{ad=null}}else{ad.backtracked&&(k&&k.backtracked?(aa.logger.warn("Already backtracked from fragment "+k.sn+", will not backtrack to fragment "+ad.sn+". Loading fragment "+k.sn),ad=k):(aa.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),ad.dropped=0,S?(S.loadCounter&&S.loadCounter--,ad=S,ad.backtracked=!0):u&&(ad=null)))}}}return ad}},{key:"_loadFragmentOrKey",value:function(u,l,p,k,h){var y=this.hls,m=y.config;if(!u.decryptdata||null==u.decryptdata.uri||null!=u.decryptdata.key){if(aa.logger.log("Loading "+u.sn+" of ["+p.startSN+" ,"+p.endSN+"],level "+l+", currentTime:"+k.toFixed(3)+",bufferEnd:"+h),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,u.loadCounter){u.loadCounter++;var v=m.fragLoadingLoopThreshold;if(u.loadCounter>v&&Math.abs(this.fragLoadIdx-u.loadIdx)<v){return y.trigger(Q["default"].ERROR,{type:Y.ErrorTypes.MEDIA_ERROR,details:Y.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:u}),!1}}else{u.loadCounter=1}return u.loadIdx=this.fragLoadIdx,u.autoLevel=y.autoLevelEnabled,u.bitrateTest=this.bitrateTest,this.fragCurrent=u,this.startFragRequested=!0,isNaN(u.sn)||u.bitrateTest||(this.nextLoadPosition=u.start+u.duration),y.trigger(Q["default"].FRAG_LOADING,{frag:u}),this.demuxer||(this.demuxer=new P["default"](y,"main")),this.state=H.FRAG_LOADING,!0}aa.logger.log("Loading key for "+u.sn+" of ["+p.startSN+" ,"+p.endSN+"],level "+l),this.state=H.KEY_LOADING,y.trigger(Q["default"].KEY_LOADING,{frag:u})}},{key:"getBufferedFrag",value:function(h){return B["default"].search(this._bufferedFrags,function(e){return h<e.startPTS?-1:h>e.endPTS?1:0})}},{key:"followingBufferedFrag",value:function(h){return h?this.getBufferedFrag(h.endPTS+0.5):null}},{key:"_checkFragmentChanged",value:function(){var n,l,m=this.media;if(m&&m.readyState&&m.seeking===!1&&(l=m.currentTime,l>m.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=l),U["default"].isBuffered(m,l)?n=this.getBufferedFrag(l):U["default"].isBuffered(m,l+0.1)&&(n=this.getBufferedFrag(l+0.1)),n)){var k=n;if(k!==this.fragPlaying){this.hls.trigger(Q["default"].FRAG_CHANGED,{frag:k});var h=k.level;this.fragPlaying&&this.fragPlaying.level===h||this.hls.trigger(Q["default"].LEVEL_SWITCHED,{level:h}),this.fragPlaying=k}}}},{key:"immediateLevelSwitch",value:function(){if(aa.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var k=this.media,h=void 0;k?(h=k.paused,k.pause()):h=!0,this.previouslyPaused=h}var i=this.fragCurrent;i&&i.loader&&i.loader.abort(),this.fragCurrent=null,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"immediateLevelSwitchEnd",value:function(){var h=this.media;h&&h.buffered.length&&(this.immediateSwitch=!1,U["default"].isBuffered(h,h.currentTime)&&(h.currentTime-=0.0001),this.previouslyPaused||h.play())}},{key:"nextLevelSwitch",value:function(){var u=this.media;if(u&&u.readyState){var l=void 0,p=void 0,k=void 0;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,p=this.getBufferedFrag(u.currentTime),p&&p.startPTS>1&&this.flushMainBuffer(0,p.startPTS-1),u.paused){l=0}else{var h=this.hls.nextLoadLevel,y=this.levels[h],m=this.fragLastKbps;l=m&&this.fragCurrent?this.fragCurrent.duration*y.bitrate/(1000*m)+1:0}if(k=this.getBufferedFrag(u.currentTime+l),k&&(k=this.followingBufferedFrag(k))){var v=this.fragCurrent;v&&v.loader&&v.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(k.startPTS,Number.POSITIVE_INFINITY)}}}},{key:"flushMainBuffer",value:function(k,h){this.state=H.BUFFER_FLUSHING;var i={startOffset:k,endOffset:h};this.altAudio&&(i.type="video"),this.hls.trigger(Q["default"].BUFFER_FLUSHING,i)}},{key:"onMediaAttached",value:function(k){var h=this.media=this.mediaBuffer=k.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),h.addEventListener("seeking",this.onvseeking),h.addEventListener("seeked",this.onvseeked),h.addEventListener("ended",this.onvended);var i=this.config;this.levels&&i.autoStartLoad&&this.hls.startLoad(i.startPosition)}},{key:"onMediaDetaching",value:function(){var i=this.media;i&&i.ended&&(aa.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var h=this.levels;h&&h.forEach(function(k){k.details&&k.details.fragments.forEach(function(l){l.loadCounter=void 0,l.backtracked=void 0})}),i&&(i.removeEventListener("seeking",this.onvseeking),i.removeEventListener("seeked",this.onvseeked),i.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){var v=this.media,A=v?v.currentTime:void 0,h=this.config;if(aa.logger.log("media seeking to "+A.toFixed(3)),this.state===H.FRAG_LOADING){var u=this.mediaBuffer?this.mediaBuffer:v,y=U["default"].bufferInfo(u,A,this.config.maxBufferHole),m=this.fragCurrent;if(0===y.len&&m){var E=h.maxFragLookUpTolerance,k=m.start-E,p=m.start+m.duration+E;A<k||A>p?(m.loader&&(aa.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),m.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=H.IDLE):aa.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else{this.state===H.ENDED&&(this.state=H.IDLE)}v&&(this.lastCurrentTime=A),this.state!==H.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*h.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=A),this.tick()}},{key:"onMediaSeeked",value:function(){aa.logger.log("media seeked to "+this.media.currentTime.toFixed(3)),this.tick()}},{key:"onMediaEnded",value:function(){aa.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function(){aa.logger.log("trigger BUFFER_RESET"),this.hls.trigger(Q["default"].BUFFER_RESET),this._bufferedFrags=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function(n){var l,m=!1,k=!1;n.levels.forEach(function(i){l=i.audioCodec,l&&(l.indexOf("mp4a.40.2")!==-1&&(m=!0),l.indexOf("mp4a.40.5")!==-1&&(k=!0))}),this.audioCodecSwitch=m&&k,this.audioCodecSwitch&&aa.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=n.levels,this.startLevelLoaded=!1,this.startFragRequested=!1;var h=this.config;(h.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(h.startPosition)}},{key:"onLevelLoaded",value:function(v){var A=v.details,h=v.level,u=this.levels[this.levelLastLoaded],y=this.levels[h],m=A.totalduration,E=0;if(aa.logger.log("level "+h+" loaded ["+A.startSN+","+A.endSN+"], cc ["+A.startCC+", "+A.endCC+"] duration:"+m),A.live){var k=y.details;k&&A.fragments.length>0?(j["default"].mergeDetails(k,A),E=A.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(E,k),A.PTSKnown?aa.logger.log("live playlist sliding:"+E.toFixed(3)):(aa.logger.log("live playlist - outdated PTS, unknown sliding"),(0,w.alignDiscontinuities)(this.fragPrevious,u,A))):(aa.logger.log("live playlist - first load, unknown sliding"),A.PTSKnown=!1,(0,w.alignDiscontinuities)(this.fragPrevious,u,A))}else{A.PTSKnown=!1}if(this.levelLastLoaded=h,y.details=A,this.hls.trigger(Q["default"].LEVEL_UPDATED,{details:A,level:h}),this.startFragRequested===!1){if(this.startPosition===-1||this.lastCurrentTime===-1){var p=A.startTimeOffset;isNaN(p)?A.live?(this.startPosition=this.computeLivePosition(E,A),aa.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(p<0&&(aa.logger.log("negative start time offset "+p+", count from end of last fragment"),p=E+m+p),aa.logger.log("start time offset found in playlist, adjust startPosition to "+p),this.startPosition=p),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===H.WAITING_LEVEL&&(this.state=H.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===H.KEY_LOADING&&(this.state=H.IDLE,this.tick())}},{key:"onFragLoaded",value:function(S){var af=this.fragCurrent,h=S.frag;if(this.state===H.FRAG_LOADING&&af&&"main"===h.type&&h.level===af.level&&h.sn===af.sn){var E=S.stats,ac=this.levels[af.level],y=ac.details;if(aa.logger.log("Loaded  "+af.sn+" of ["+y.startSN+" ,"+y.endSN+"],level "+af.level),this.bitrateTest=!1,this.stats=E,h.bitrateTest===!0&&this.hls.nextLoadLevel){this.state=H.IDLE,this.startFragRequested=!1,E.tparsed=E.tbuffered=performance.now(),this.hls.trigger(Q["default"].FRAG_BUFFERED,{stats:E,frag:af,id:"main"}),this.tick()}else{if("initSegment"===h.sn){this.state=H.IDLE,E.tparsed=E.tbuffered=performance.now(),y.initSegment.data=S.payload,this.hls.trigger(Q["default"].FRAG_BUFFERED,{stats:E,frag:af,id:"main"}),this.tick()}else{this.state=H.PARSING;var ag=y.totalduration,m=af.level,A=af.sn,ae=this.config.defaultAudioCodec||ac.audioCodec;this.audioCodecSwap&&(aa.logger.log("swapping playlist audio codec"),void 0===ae&&(ae=this.lastAudioCodec),ae&&(ae=ae.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,aa.logger.log("Parsing "+A+" of ["+y.startSN+" ,"+y.endSN+"],level "+m+", cc "+af.cc);var T=this.demuxer;T||(T=this.demuxer=new P["default"](this.hls,"main"));var R=this.media,ab=R&&R.seeking,ad=!ab&&(y.PTSKnown||!y.live),k=y.initSegment?y.initSegment.data:[];T.push(S.payload,k,ae,ac.videoCodec,af,ag,ad,void 0)}}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(v){var A=this.fragCurrent,h=v.frag;if(A&&"main"===v.id&&h.sn===A.sn&&h.level===A.level&&this.state===H.PARSING){var u,y,m=v.tracks;if(m.audio&&this.altAudio&&delete m.audio,y=m.audio){var E=this.levels[this.level].audioCodec,k=navigator.userAgent.toLowerCase();E&&this.audioCodecSwap&&(aa.logger.log("swapping playlist audio codec"),E=E.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==y.metadata.channelCount&&k.indexOf("firefox")===-1&&(E="mp4a.40.5"),k.indexOf("android")!==-1&&"audio/mpeg"!==y.container&&(E="mp4a.40.2",aa.logger.log("Android: force audio codec to "+E)),y.levelCodec=E,y.id=v.id}y=m.video,y&&(y.levelCodec=this.levels[this.level].videoCodec,y.id=v.id),this.hls.trigger(Q["default"].BUFFER_CODECS,m);for(u in m){y=m[u],aa.logger.log("main track:"+u+",container:"+y.container+",codecs[level/parsed]=["+y.levelCodec+"/"+y.codec+"]");var p=y.initSegment;p&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(Q["default"].BUFFER_APPENDING,{type:u,data:p,parent:"main",content:"initSegment"}))}this.tick()}}},{key:"onFragParsingData",value:function(u){var l=this,p=this.fragCurrent,k=u.frag;if(p&&"main"===u.id&&k.sn===p.sn&&k.level===p.level&&("audio"!==u.type||!this.altAudio)&&this.state===H.PARSING){var h=this.levels[this.level],y=p;if(isNaN(u.endPTS)&&(u.endPTS=u.startPTS+p.duration,u.endDTS=u.startDTS+p.duration),aa.logger.log("Parsed "+u.type+",PTS:["+u.startPTS.toFixed(3)+","+u.endPTS.toFixed(3)+"],DTS:["+u.startDTS.toFixed(3)+"/"+u.endDTS.toFixed(3)+"],nb:"+u.nb+",dropped:"+(u.dropped||0)),"video"===u.type){if(y.dropped=u.dropped,y.dropped){if(!y.backtracked){return aa.logger.warn("missing video frame(s), backtracking fragment"),y.backtracked=!0,this.nextLoadPosition=u.startPTS,this.state=H.IDLE,this.fragPrevious=y,void this.tick()}aa.logger.warn("Already backtracked on this fragment, appending with the gap")}else{y.backtracked=!1}}var m=j["default"].updateFragPTSDTS(h.details,y.sn,u.startPTS,u.endPTS,u.startDTS,u.endDTS),v=this.hls;v.trigger(Q["default"].LEVEL_PTS_UPDATED,{details:h.details,level:this.level,drift:m,type:u.type,start:u.startPTS,end:u.endPTS}),[u.data1,u.data2].forEach(function(e){e&&e.length&&l.state===H.PARSING&&(l.appended=!0,l.pendingBuffering=!0,v.trigger(Q["default"].BUFFER_APPENDING,{type:u.type,data:e,parent:"main",content:"data"}))}),this.tick()}}},{key:"onFragParsed",value:function(k){var h=this.fragCurrent,i=k.frag;h&&"main"===k.id&&i.sn===h.sn&&i.level===h.level&&this.state===H.PARSING&&(this.stats.tparsed=performance.now(),this.state=H.PARSED,this._checkAppendedParsed())}},{key:"onAudioTrackSwitching",value:function(n){var l=!!n.url,m=n.id;if(!l){if(this.mediaBuffer!==this.media){aa.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var k=this.fragCurrent;k.loader&&(aa.logger.log("switching to main audio track, cancel main fragment load"),k.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=H.IDLE}var h=this.hls;h.trigger(Q["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),h.trigger(Q["default"].AUDIO_TRACK_SWITCHED,{id:m}),this.altAudio=!1}}},{key:"onAudioTrackSwitched",value:function(m){var k=m.id,l=!!this.hls.audioTracks[k].url;if(l){var h=this.videoBuffer;h&&this.mediaBuffer!==h&&(aa.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=h)}this.altAudio=l,this.tick()}},{key:"onBufferCreated",value:function(p){var l=p.tracks,o=void 0,k=void 0,h=!1;for(var u in l){var m=l[u];"main"===m.id?(k=u,o=m,"video"===u&&(this.videoBuffer=l[u].buffer)):h=!0}h&&o?(aa.logger.log("alternate track found, use "+k+".buffered to schedule main fragment loading"),this.mediaBuffer=o.buffer):this.mediaBuffer=this.media}},{key:"onBufferAppended",value:function(i){if("main"===i.parent){var h=this.state;h!==H.PARSING&&h!==H.PARSED||(this.pendingBuffering=i.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(!(this.state!==H.PARSED||this.appended&&this.pendingBuffering)){var m=this.fragCurrent;if(m){var k=this.mediaBuffer?this.mediaBuffer:this.media;aa.logger.log("main buffered : "+N["default"].toString(k.buffered));var l=this._bufferedFrags.filter(function(i){return U["default"].isBuffered(k,(i.startPTS+i.endPTS)/2)});l.push(m),this._bufferedFrags=l.sort(function(n,i){return n.startPTS-i.startPTS}),this.fragPrevious=m;var h=this.stats;h.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*h.total/(h.tbuffered-h.tfirst)),this.hls.trigger(Q["default"].FRAG_BUFFERED,{stats:h,frag:m,id:"main"}),this.state=H.IDLE}this.tick()}}},{key:"onError",value:function(p){var l=p.frag||this.fragCurrent;if(!l||"main"===l.type){var o=this.media,k=o&&U["default"].isBuffered(o,o.currentTime)&&U["default"].isBuffered(o,o.currentTime+0.5);switch(p.details){case Y.ErrorDetails.FRAG_LOAD_ERROR:case Y.ErrorDetails.FRAG_LOAD_TIMEOUT:case Y.ErrorDetails.KEY_LOAD_ERROR:case Y.ErrorDetails.KEY_LOAD_TIMEOUT:if(!p.fatal){var h=this.fragLoadError;h?h++:h=1;var u=this.config;if(h<=u.fragLoadingMaxRetry||k||l.autoLevel&&l.level){this.fragLoadError=h,l.loadCounter=0;var m=Math.min(Math.pow(2,h-1)*u.fragLoadingRetryDelay,u.fragLoadingMaxRetryTimeout);aa.logger.warn("mediaController: frag loading failed, retry in "+m+" ms"),this.retryDate=performance.now()+m,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.state=H.FRAG_LOADING_WAITING_RETRY}else{aa.logger.error("mediaController: "+p.details+" reaches max retry, redispatch as fatal ..."),p.fatal=!0,this.state=H.ERROR}}break;case Y.ErrorDetails.FRAG_LOOP_LOADING_ERROR:p.fatal||(k?(this._reduceMaxBufferLength(l.duration),this.state=H.IDLE):l.autoLevel&&0!==l.level||(p.fatal=!0,this.state=H.ERROR));break;case Y.ErrorDetails.LEVEL_LOAD_ERROR:case Y.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==H.ERROR&&(p.fatal?(this.state=H.ERROR,aa.logger.warn("streamController: "+p.details+",switch to "+this.state+" state ...")):this.state===H.WAITING_LEVEL&&(this.state=H.IDLE));break;case Y.ErrorDetails.BUFFER_FULL_ERROR:"main"!==p.parent||this.state!==H.PARSING&&this.state!==H.PARSED||(k?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=H.IDLE):(aa.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}}},{key:"_reduceMaxBufferLength",value:function(i){var h=this.config;h.maxMaxBufferLength>=i&&(h.maxMaxBufferLength/=2,aa.logger.warn("main:reduce max buffer length to "+h.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*h.fragLoadingLoopThreshold)}},{key:"_checkBuffer",value:function(){var aq=this.media;if(aq&&aq.readyState){var af=aq.currentTime,ah=this.mediaBuffer?this.mediaBuffer:aq,ao=ah.buffered;if(!this.loadedmetadata&&ao.length){this.loadedmetadata=!0;var au=aq.seeking?af:this.startPosition,ak=U["default"].isBuffered(ah,au);af===au&&ak||(aa.logger.log("target start position:"+au),ak||(au=ao.start(0),aa.logger.log("target start position not buffered, seek to buffered.start(0) "+au)),aa.logger.log("adjust currentTime from "+af+" to "+au),aq.currentTime=au)}else{if(this.immediateSwitch){this.immediateLevelSwitchEnd()}else{var ag=U["default"].bufferInfo(aq,af,0),aj=!(aq.paused||aq.ended||0===aq.buffered.length),am=0.5,ad=af!==this.lastCurrentTime,ar=this.config;if(ad){this.stallReported&&(aa.logger.warn("playback not stuck anymore @"+af+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0}else{if(aj){var at=performance.now(),ap=this.hls;if(this.stalled){var ac=at-this.stalled,ai=ag.len,ab=this.nudgeRetry||0;if(ai<=am&&ac>1000*ar.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,aa.logger.warn("playback stalling in low buffer @"+af),ap.trigger(Q["default"].ERROR,{type:Y.ErrorTypes.MEDIA_ERROR,details:Y.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:ai}));var al=ag.nextStart,A=al-af;if(al&&A<ar.maxSeekHole&&A>0){this.nudgeRetry=++ab;var ae=ab*ar.nudgeOffset;aa.logger.log("adjust currentTime from "+aq.currentTime+" to next buffered @ "+al+" + nudge "+ae),aq.currentTime=al+ae,this.stalled=void 0,ap.trigger(Q["default"].ERROR,{type:Y.ErrorTypes.MEDIA_ERROR,details:Y.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:al+ae-af})}}else{if(ai>am&&ac>1000*ar.highBufferWatchdogPeriod){if(this.stallReported||(this.stallReported=!0,aa.logger.warn("playback stalling in high buffer @"+af),ap.trigger(Q["default"].ERROR,{type:Y.ErrorTypes.MEDIA_ERROR,details:Y.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:ai})),this.stalled=void 0,this.nudgeRetry=++ab,ab<ar.nudgeMaxRetry){var an=aq.currentTime,S=an+ab*ar.nudgeOffset;aa.logger.log("adjust currentTime from "+an+" to "+S),aq.currentTime=S,ap.trigger(Q["default"].ERROR,{type:Y.ErrorTypes.MEDIA_ERROR,details:Y.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else{aa.logger.error("still stuck in high buffer @"+af+" after "+ar.nudgeMaxRetry+", raise fatal error"),ap.trigger(Q["default"].ERROR,{type:Y.ErrorTypes.MEDIA_ERROR,details:Y.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}}}}else{this.stalled=at,this.stallReported=!1}}}}}}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=H.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()}},{key:"onBufferFlushed",value:function(){var h=this.mediaBuffer?this.mediaBuffer:this.media;this._bufferedFrags=this._bufferedFrags.filter(function(e){return U["default"].isBuffered(h,(e.startPTS+e.endPTS)/2)}),this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=H.IDLE,this.fragPrevious=null}},{key:"onLevelRemoved",value:function(h){this.levels=this.levels.filter(function(e,i){return i!==h.level})}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"computeLivePosition",value:function(k,h){var i=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*h.targetduration;return k+Math.max(0,h.totalduration-i)}},{key:"state",set:function(i){if(this.state!==i){var h=this.state;this._state=i,aa.logger.log("main stream:"+h+"->"+i),this.hls.trigger(Q["default"].STREAM_STATE_TRANSITION,{previousState:h,nextState:i})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var i=this.media;if(i){var h=this.getBufferedFrag(i.currentTime);if(h){return h.level}}return -1}},{key:"nextBufferedFrag",get:function(){var h=this.media;return h?this.followingBufferedFrag(this.getBufferedFrag(h.currentTime)):null}},{key:"nextLevel",get:function(){var h=this.nextBufferedFrag;return h?h.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(h){this._liveSyncPosition=h}}]),f}(x["default"]);G["default"]=q},{24:24,30:30,31:31,32:32,34:34,35:35,45:45,48:48,51:51,52:52}],13:[function(w,B,g){function p(f){return f&&f.__esModule?f:{"default":f}}function z(h,f){if(!(h instanceof f)){throw new TypeError("Cannot call a class as a function")}}function k(h,f){if(!h){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return !f||"object"!=typeof f&&"function"!=typeof f?h:f}function C(h,f){if("function"!=typeof f&&null!==f){throw new TypeError("Super expression must either be null or a function, not "+typeof f)}h.prototype=Object.create(f&&f.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(h,f):h.__proto__=f)}Object.defineProperty(g,"__esModule",{value:!0});var j=function(){function f(o,l){for(var n=0;n<l.length;n++){var h=l[n];h.enumerable=h.enumerable||!1,h.configurable=!0,"value" in h&&(h.writable=!0),Object.defineProperty(o,h.key,h)}}return function(h,l,e){return l&&f(h.prototype,l),e&&f(h,e),h}}(),m=w(32),A=p(m),x=w(31),v=p(x),y=w(51),q=function(h){function f(l){z(this,f);var i=k(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,l,A["default"].ERROR,A["default"].SUBTITLE_TRACKS_UPDATED,A["default"].SUBTITLE_TRACK_SWITCH,A["default"].SUBTITLE_TRACK_LOADED,A["default"].SUBTITLE_FRAG_PROCESSED));return i.config=l.config,i.vttFragSNsProcessed={},i.vttFragQueues=void 0,i.currentlyProcessing=null,i.currentTrackId=-1,i}return C(f,h),j(f,[{key:"destroy",value:function(){v["default"].prototype.destroy.call(this)}},{key:"clearVttFragQueues",value:function(){var i=this;this.vttFragQueues={},this.tracks.forEach(function(e){i.vttFragQueues[e.id]=[]})}},{key:"nextFrag",value:function(){if(null===this.currentlyProcessing&&this.currentTrackId>-1&&this.vttFragQueues[this.currentTrackId].length){var i=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.hls.trigger(A["default"].FRAG_LOADING,{frag:i})}}},{key:"onSubtitleFragProcessed",value:function(i){i.success&&this.vttFragSNsProcessed[i.frag.trackId].push(i.frag.sn),this.currentlyProcessing=null,this.nextFrag()}},{key:"onError",value:function(l){var i=l.frag;i&&"subtitle"!==i.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())}},{key:"onSubtitleTracksUpdated",value:function(l){var i=this;y.logger.log("subtitle tracks updated"),this.tracks=l.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(n){i.vttFragSNsProcessed[n.id]=[]})}},{key:"onSubtitleTrackSwitch",value:function(i){this.currentTrackId=i.id,this.clearVttFragQueues()}},{key:"onSubtitleTrackLoaded",value:function(D){var s=this.vttFragSNsProcessed[D.id],u=this.vttFragQueues[D.id],o=this.currentlyProcessing?this.currentlyProcessing.sn:-1,l=function(i){return s.indexOf(i.sn)>-1},E=function(i){return u.some(function(e){return e.sn===i.sn})};D.details.fragments.forEach(function(e){l(e)||e.sn===o||E(e)||(e.trackId=D.id,u.push(e))}),this.nextFrag()}}]),f}(v["default"]);g["default"]=q},{31:31,32:32,51:51}],14:[function(w,B,g){function p(f){return f&&f.__esModule?f:{"default":f}}function z(h,f){if(!(h instanceof f)){throw new TypeError("Cannot call a class as a function")}}function k(h,f){if(!h){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return !f||"object"!=typeof f&&"function"!=typeof f?h:f}function C(h,f){if("function"!=typeof f&&null!==f){throw new TypeError("Super expression must either be null or a function, not "+typeof f)}h.prototype=Object.create(f&&f.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(h,f):h.__proto__=f)}Object.defineProperty(g,"__esModule",{value:!0});var j=function(){function f(o,l){for(var n=0;n<l.length;n++){var h=l[n];h.enumerable=h.enumerable||!1,h.configurable=!0,"value" in h&&(h.writable=!0),Object.defineProperty(o,h.key,h)}}return function(h,l,e){return l&&f(h.prototype,l),e&&f(h,e),h}}(),m=w(32),A=p(m),x=w(31),v=p(x),y=w(51),q=function(h){function f(l){z(this,f);var i=k(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,l,A["default"].MEDIA_ATTACHED,A["default"].MEDIA_DETACHING,A["default"].MANIFEST_LOADING,A["default"].MANIFEST_LOADED,A["default"].SUBTITLE_TRACK_LOADED));return i.tracks=[],i.trackId=-1,i.media=void 0,i}return C(f,h),j(f,[{key:"destroy",value:function(){v["default"].prototype.destroy.call(this)}},{key:"onMediaAttached",value:function(l){var i=this;this.media=l.media,this.media&&this.media.textTracks.addEventListener("change",function(){if(i.media){for(var s=-1,o=i.media.textTracks,n=0;n<o.length;n++){"showing"===o[n].mode&&(s=n)}i.subtitleTrack=s}})}},{key:"onMediaDetaching",value:function(){this.media=void 0}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(s){var n=this,o=s.subtitles||[],l=!1;this.tracks=o,this.trackId=-1,this.hls.trigger(A["default"].SUBTITLE_TRACKS_UPDATED,{subtitleTracks:o}),o.forEach(function(i){i["default"]&&(n.subtitleTrack=i.id,l=!0)})}},{key:"onTick",value:function(){var n=this.trackId,i=this.tracks[n];if(i){var l=i.details;void 0!==l&&l.live!==!0||(y.logger.log("(re)loading playlist for subtitle track "+n),this.hls.trigger(A["default"].SUBTITLE_TRACK_LOADING,{url:i.url,id:n}))}}},{key:"onSubtitleTrackLoaded",value:function(l){var i=this;l.id<this.tracks.length&&(y.logger.log("subtitle track "+l.id+" loaded"),this.tracks[l.id].details=l.details,l.details.live&&!this.timer&&(this.timer=setInterval(function(){i.onTick()},1000*l.details.targetduration,this)),!l.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setSubtitleTrackInternal",value:function(n){if(n>=0&&n<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=n,y.logger.log("switching to subtitle track "+n);var i=this.tracks[n];this.hls.trigger(A["default"].SUBTITLE_TRACK_SWITCH,{id:n});var l=i.details;void 0!==l&&l.live!==!0||(y.logger.log("(re)loading playlist for subtitle track "+n),this.hls.trigger(A["default"].SUBTITLE_TRACK_LOADING,{url:i.url,id:n}))}}},{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(i){this.trackId!==i&&this.setSubtitleTrackInternal(i)}}]),f}(v["default"]);g["default"]=q},{31:31,32:32,51:51}],15:[function(M,z,B){function I(f){return f&&f.__esModule?f:{"default":f}}function P(g,f){if(!(g instanceof f)){throw new TypeError("Cannot call a class as a function")}}function F(g,f){if(!g){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return !f||"object"!=typeof f&&"function"!=typeof f?g:f}function A(g,f){if("function"!=typeof f&&null!==f){throw new TypeError("Super expression must either be null or a function, not "+typeof f)}g.prototype=Object.create(f&&f.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(g,f):g.__proto__=f)}function D(g){if(g){var f=g.mode;for("disabled"===f&&(g.mode="hidden");g.cues.length>0;){g.removeCue(g.cues[0])}g.mode=f}}function H(g,f){return g&&(!g._id||/^subtitle/.test(g._id))&&g.label===f.name&&!(g.textTrack1||g.textTrack2)}function w(l,g,h,f){return Math.min(g,f)-Math.max(l,h)}Object.defineProperty(B,"__esModule",{value:!0});var N=function(){function f(m,h){for(var l=0;l<h.length;l++){var g=h[l];g.enumerable=g.enumerable||!1,g.configurable=!0,"value" in g&&(g.writable=!0),Object.defineProperty(m,g.key,g)}}return function(g,h,e){return h&&f(g.prototype,h),e&&f(g,e),g}}(),L=M(32),O=I(L),J=M(31),q=I(J),K=M(46),C=I(K),k=M(55),G=I(k),j=M(51),x=function(g){function f(t){P(this,f);var p=F(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,t,O["default"].MEDIA_ATTACHING,O["default"].MEDIA_DETACHING,O["default"].FRAG_PARSING_USERDATA,O["default"].MANIFEST_LOADING,O["default"].MANIFEST_LOADED,O["default"].FRAG_LOADED,O["default"].LEVEL_SWITCHING,O["default"].INIT_PTS_FOUND,O["default"].FRAG_PARSING_INIT_SEGMENT));if(p.hls=t,p.config=t.config,p.enabled=!0,p.Cues=t.config.cueHandler,p.textTracks=[],p.tracks=[],p.unparsedVttFrags=[],p.initPTS=void 0,p.cueRanges=[],p.manifestCaptionsLabels={},p.config.enableCEA708Captions){var n=p,o=p.manifestCaptionsLabels,h={newCue:function(u,l,s){if(!n.textTrack1){if(n.config.renderNatively){var i=n.getExistingTrack("1");if(i){n.textTrack1=i,D(n.textTrack1);var v=new window.Event("addtrack");v.track=n.textTrack1,n.media.dispatchEvent(v)}else{n.textTrack1=n.createTextTrack("captions",o.captionsTextTrack1Label,o.captionsTextTrack1LanguageCode),n.textTrack1.textTrack1=!0}}else{n.textTrack1={_id:"textTrack1",label:o.captionsTextTrack1Label,kind:"captions","default":!1},n.hls.trigger(O["default"].NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n.textTrack1]})}}n.addCues("textTrack1",u,l,s)}},m={newCue:function(u,l,s){if(!n.textTrack2){if(n.config.renderNatively){var i=n.getExistingTrack("2");if(i){n.textTrack2=i,D(n.textTrack2);var v=new window.Event("addtrack");v.track=n.textTrack2,n.media.dispatchEvent(v)}else{n.textTrack2=n.createTextTrack("captions",o.captionsTextTrack2Label,o.captionsTextTrack2LanguageCode),n.textTrack2.textTrack2=!0}}else{n.textTrack2={_id:"textTrack2",label:o.captionsTextTrack2Label,kind:"captions","default":!1},n.hls.trigger(O["default"].NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n.textTrack2]})}}n.addCues("textTrack2",u,l,s)}};p.cea608Parser=new C["default"](0,h,m)}return p}return A(f,g),N(f,[{key:"addCues",value:function(E,S,h,v){for(var R=this,p=this.cueRanges,T=!1,m=p.length;m--;){var u=p[m],Q=w(u[0],u[1],S,h);if(Q>=0&&(u[0]=Math.min(u[0],S),u[1]=Math.max(u[1],h),T=!0,Q/(h-S)>0.5)){return}}T||p.push([S,h]);var y=this.Cues.createCues(S,h,v);this.config.renderNatively?y.forEach(function(e){R[E].addCue(e)}):this.hls.trigger(O["default"].CUES_PARSED,{type:"captions",cues:y,track:E})}},{key:"onInitPtsFound",value:function(i){var h=this;"undefined"==typeof this.initPTS&&(this.initPTS=i.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(l){h.onFragLoaded(l)}),this.unparsedVttFrags=[])}},{key:"getExistingTrack",value:function(o){var m=this.media;if(m){for(var n=0;n<m.textTracks.length;n++){var l=m.textTracks[n],h="textTrack"+o;if(l[h]===!0){return l}}}return null}},{key:"createTextTrack",value:function(n,l,m){var h=this.media;if(h){return h.addTextTrack(n,l,m)}}},{key:"destroy",value:function(){q["default"].prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(h){this.media=h.media}},{key:"onMediaDetaching",value:function(){D(this.textTrack1),D(this.textTrack2)}},{key:"onManifestLoading",value:function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0};var l=this.media;if(l&&l.textTracks){for(var h=l.textTracks,i=0;i<h.length;i++){(h[i].textTrack1||h[i].textTrack2)&&D(h[i])}}}},{key:"onManifestLoaded",value:function(v){var m=this;this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[];var u=this.manifestCaptionsLabels;if(u.captionsTextTrack1Label="Unknown CC",u.captionsTextTrack1LanguageCode="en",u.captionsTextTrack2Label="Unknown CC",u.captionsTextTrack2LanguageCode="es",this.config.enableWebVTT){var l=this.tracks&&v.subtitles&&this.tracks.length===v.subtitles.length;if(this.tracks=v.subtitles||[],this.config.renderNatively){var h=this.media?this.media.textTracks:[];this.tracks.forEach(function(t,s){var o=void 0;if(s<h.length){var Q=h[s];H(Q,t)&&(o=Q)}o||(o=m.createTextTrack("subtitles",t.name,t.lang)),o.mode=t["default"]?"showing":"hidden",m.textTracks.push(o)})}else{if(!l&&this.tracks&&this.tracks.length){var E=this.tracks.map(function(i){return{label:i.name,kind:i.type.toLowerCase(),"default":i["default"]}});this.hls.trigger(O["default"].NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:E})}}}if(this.config.enableCEA708Captions&&v.captions){var p=void 0,y=void 0;v.captions.forEach(function(i){y=/(?:CC|SERVICE)([1-2])/.exec(i.instreamId),y&&(p=y[1],u["captionsTextTrack"+p+"Label"]=i.name,i.lang&&(u["captionsTextTrack"+p+"LanguageCode"]=i.lang))})}}},{key:"onLevelSwitching",value:function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions}},{key:"onFragLoaded",value:function(v){var m=v.frag,u=v.payload,l=this;if("main"===m.type){var h=m.sn;h!==this.lastSn+1&&this.cea608Parser.reset(),this.lastSn=h}else{if("subtitle"===m.type){if(u.byteLength){if("undefined"==typeof this.initPTS){return void this.unparsedVttFrags.push(v)}var E=this.vttCCs;E[m.cc]||(E[m.cc]={start:m.start,prevCC:this.prevCC,"new":!0},this.prevCC=m.cc);var p=this.hls,y=l.config.renderNatively?this.textTracks:this.tracks;G["default"].parse(u,this.initPTS,E,m.cc,function(o){if(l.config.renderNatively){o.forEach(function(r){y[m.trackId].addCue(r)})}else{var n=y[m.trackId],i=n["default"]?"default":"subtitles"+m.trackId;p.trigger(O["default"].CUES_PARSED,{type:"subtitles",cues:o,track:i})}p.trigger(O["default"].SUBTITLE_FRAG_PROCESSED,{success:!0,frag:m})},function(i){j.logger.log("Failed to parse VTT cue: "+i),p.trigger(O["default"].SUBTITLE_FRAG_PROCESSED,{success:!1,frag:m})})}else{this.hls.trigger(O["default"].SUBTITLE_FRAG_PROCESSED,{success:!1,frag:m})}}}}},{key:"onFragParsingUserdata",value:function(l){if(this.enabled&&this.config.enableCEA708Captions){for(var h=0;h<l.samples.length;h++){var i=this.extractCea608Data(l.samples[h].bytes);this.cea608Parser.addData(l.samples[h].pts,i)}}}},{key:"onFragParsingInitSegment",value:function(){"undefined"==typeof this.initPTS&&this.onInitPtsFound({initPTS:90000})}},{key:"extractCea608Data",value:function(E){for(var S,h,y,Q,p,T=31&E[0],m=2,v=[],R=0;R<T;R++){S=E[m++],h=127&E[m++],y=127&E[m++],Q=0!==(4&S),p=3&S,0===h&&0===y||Q&&0===p&&(v.push(h),v.push(y))}return v}}]),f}(q["default"]);B["default"]=x},{31:31,32:32,46:46,51:51,55:55}],16:[function(k,h,j){function g(m,i){if(!(m instanceof i)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(j,"__esModule",{value:!0});var f=function(){function i(p,n){for(var o=0;o<n.length;o++){var m=n[o];m.enumerable=m.enumerable||!1,m.configurable=!0,"value" in m&&(m.writable=!0),Object.defineProperty(p,m.key,m)}}return function(m,n,e){return n&&i(m.prototype,n),e&&i(m,e),m}}(),l=function(){function i(e,m){g(this,i),this.subtle=e,this.aesIV=m}return f(i,[{key:"decrypt",value:function(n,m){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},m,n)}}]),i}();j["default"]=l},{}],17:[function(k,h,j){function g(m,i){if(!(m instanceof i)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(j,"__esModule",{value:!0});var f=function(){function i(p,n){for(var o=0;o<n.length;o++){var m=n[o];m.enumerable=m.enumerable||!1,m.configurable=!0,"value" in m&&(m.writable=!0),Object.defineProperty(p,m.key,m)}}return function(m,n,e){return n&&i(m.prototype,n),e&&i(m,e),m}}(),l=function(){function i(){g(this,i),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return f(i,[{key:"uint8ArrayToUint32Array_",value:function(p){for(var n=new DataView(p),o=new Uint32Array(4),m=0;m<4;m++){o[m]=n.getUint32(4*m)}return o}},{key:"initTable",value:function(){var O=this.sBox,B=this.invSBox,D=this.subMix,K=D[0],R=D[1],H=D[2],C=D[3],G=this.invSubMix,J=G[0],z=G[1],P=G[2],N=G[3],Q=new Uint32Array(256),L=0,x=0,M=0;for(M=0;M<256;M++){M<128?Q[M]=M<<1:Q[M]=M<<1^283}for(M=0;M<256;M++){var F=x^x<<1^x<<2^x<<3^x<<4;F=F>>>8^255&F^99,O[L]=F,B[F]=L;var w=Q[L],I=Q[w],q=Q[I],A=257*Q[F]^16843008*F;K[L]=A<<24|A>>>8,R[L]=A<<16|A>>>16,H[L]=A<<8|A>>>24,C[L]=A,A=16843009*q^65537*I^257*w^16843008*L,J[F]=A<<24|A>>>8,z[F]=A<<16|A>>>16,P[F]=A<<8|A>>>24,N[F]=A,L?(L=w^Q[Q[Q[q^w]]],x^=Q[Q[x]]):L=x=1}}},{key:"expandKey",value:function(L){for(var z=this.uint8ArrayToUint32Array_(L),B=!0,H=0;H<z.length&&B;){B=z[H]===this.key[H],H++}if(!B){this.key=z;var O=this.keySize=z.length;if(4!==O&&6!==O&&8!==O){throw new Error("Invalid aes key size="+O)}var E=this.ksRows=4*(O+6+1),A=void 0,D=void 0,G=this.keySchedule=new Uint32Array(E),x=this.invKeySchedule=new Uint32Array(E),M=this.sBox,K=this.rcon,N=this.invSubMix,I=N[0],w=N[1],J=N[2],C=N[3],q=void 0,F=void 0;for(A=0;A<E;A++){A<O?q=G[A]=z[A]:(F=q,A%O===0?(F=F<<8|F>>>24,F=M[F>>>24]<<24|M[F>>>16&255]<<16|M[F>>>8&255]<<8|M[255&F],F^=K[A/O|0]<<24):O>6&&A%O===4&&(F=M[F>>>24]<<24|M[F>>>16&255]<<16|M[F>>>8&255]<<8|M[255&F]),G[A]=q=(G[A-O]^F)>>>0)}for(D=0;D<E;D++){A=E-D,F=3&D?G[A]:G[A-4],D<4||A<=4?x[D]=F:x[D]=I[M[F>>>24]]^w[M[F>>>16&255]]^J[M[F>>>8&255]]^C[M[255&F]],x[D]=x[D]>>>0}}}},{key:"networkToHostOrderSwap",value:function(m){return m<<24|(65280&m)<<8|(16711680&m)>>8|m>>>24}},{key:"decrypt",value:function(ai,P,W){for(var ae,am,aa=this.keySize+6,U=this.invKeySchedule,Z=this.invSBox,ac=this.invSubMix,M=ac[0],aj=ac[1],ah=ac[2],ak=ac[3],af=this.uint8ArrayToUint32Array_(W),K=af[0],ag=af[1],Y=af[2],G=af[3],ab=new Int32Array(ai),q=new Int32Array(ab.length),N=void 0,ad=void 0,al=void 0,an=void 0,z=void 0,X=void 0,x=void 0,F=void 0,J=void 0,Q=void 0,B=void 0,H=void 0,V=this.networkToHostOrderSwap;P<ab.length;){for(J=V(ab[P]),Q=V(ab[P+1]),B=V(ab[P+2]),H=V(ab[P+3]),z=J^U[0],X=H^U[1],x=B^U[2],F=Q^U[3],ae=4,am=1;am<aa;am++){N=M[z>>>24]^aj[X>>16&255]^ah[x>>8&255]^ak[255&F]^U[ae],ad=M[X>>>24]^aj[x>>16&255]^ah[F>>8&255]^ak[255&z]^U[ae+1],al=M[x>>>24]^aj[F>>16&255]^ah[z>>8&255]^ak[255&X]^U[ae+2],an=M[F>>>24]^aj[z>>16&255]^ah[X>>8&255]^ak[255&x]^U[ae+3],z=N,X=ad,x=al,F=an,ae+=4}N=Z[z>>>24]<<24^Z[X>>16&255]<<16^Z[x>>8&255]<<8^Z[255&F]^U[ae],ad=Z[X>>>24]<<24^Z[x>>16&255]<<16^Z[F>>8&255]<<8^Z[255&z]^U[ae+1],al=Z[x>>>24]<<24^Z[F>>16&255]<<16^Z[z>>8&255]<<8^Z[255&X]^U[ae+2],an=Z[F>>>24]<<24^Z[z>>16&255]<<16^Z[X>>8&255]<<8^Z[255&x]^U[ae+3],ae+=3,q[P]=V(N^K),q[P+1]=V(an^ag),q[P+2]=V(al^Y),q[P+3]=V(ad^G),K=J,ag=Q,Y=B,G=H,P+=4}return q.buffer}},{key:"destroy",value:function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}]),i}();j["default"]=l},{}],18:[function(x,D,g){function p(f){return f&&f.__esModule?f:{"default":f}}function A(h,f){if(!(h instanceof f)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(g,"__esModule",{value:!0});var k=function(){function f(o,l){for(var n=0;n<l.length;n++){var h=l[n];h.enumerable=h.enumerable||!1,h.configurable=!0,"value" in h&&(h.writable=!0),Object.defineProperty(o,h.key,h)}}return function(h,l,e){return l&&f(h.prototype,l),e&&f(h,e),h}}(),E=x(16),j=p(E),m=x(19),C=p(m),y=x(17),w=p(y),z=x(30),q=x(51),B=function(){function f(h,l){A(this,f),this.observer=h,this.config=l,this.logEnabled=!0;try{var e=crypto?crypto:self.crypto;this.subtle=e.subtle||e.webkitSubtle}catch(o){}this.disableWebCrypto=!this.subtle}return k(f,[{key:"isSync",value:function(){return this.disableWebCrypto&&this.config.enableSoftwareAES}},{key:"decrypt",value:function(F,o,v,l){var h=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(q.logger.log("JS AES decrypt"),this.logEnabled=!1);var G=this.decryptor;G||(this.decryptor=G=new w["default"]),G.expandKey(o),l(G.decrypt(F,0,v))}else{this.logEnabled&&(q.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var u=this.subtle;this.key!==o&&(this.key=o,this.fastAesKey=new C["default"](u,o)),this.fastAesKey.expandKey().then(function(i){var e=new j["default"](u,v);e.decrypt(F,i)["catch"](function(r){h.onWebCryptoError(r,F,o,v,l)}).then(function(n){l(n)})})["catch"](function(e){h.onWebCryptoError(e,F,o,v,l)})}}},{key:"onWebCryptoError",value:function(s,n,o,l,h){this.config.enableSoftwareAES?(q.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(n,o,l,h)):(q.logger.error("decrypting error : "+s.message),this.observer.trigger(Event.ERROR,{type:z.ErrorTypes.MEDIA_ERROR,details:z.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:s.message}))}},{key:"destroy",value:function(){var h=this.decryptor;h&&(h.destroy(),this.decryptor=void 0)}}]),f}();g["default"]=B},{16:16,17:17,19:19,30:30,51:51}],19:[function(k,h,j){function g(m,i){if(!(m instanceof i)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(j,"__esModule",{value:!0});var f=function(){function i(p,n){for(var o=0;o<n.length;o++){var m=n[o];m.enumerable=m.enumerable||!1,m.configurable=!0,"value" in m&&(m.writable=!0),Object.defineProperty(p,m.key,m)}}return function(m,n,e){return n&&i(m.prototype,n),e&&i(m,e),m}}(),l=function(){function i(e,m){g(this,i),this.subtle=e,this.key=m}return f(i,[{key:"expandKey",value:function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}]),i}();j["default"]=l},{}],20:[function(q,y,g){function m(f){return f&&f.__esModule?f:{"default":f}}function w(i,f){if(!(i instanceof f)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(g,"__esModule",{value:!0});var j=function(){function f(s,n){for(var o=0;o<n.length;o++){var l=n[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value" in l&&(l.writable=!0),Object.defineProperty(s,l.key,l)}}return function(l,n,e){return n&&f(l.prototype,n),e&&f(l,e),l}}(),z=q(21),h=m(z),k=q(51),x=q(26),v=m(x),p=function(){function f(l,n,e){w(this,f),this.observer=l,this.config=e,this.remuxer=n}return j(f,[{key:"resetInitSegment",value:function(s,n,o,l){this._aacTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:n,duration:l,inputTimeScale:90000}}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(H,N,l,D){var K,A,O,M,G,I,E,L,F,o,J,B=new v["default"](H);for(A=B.timeStamp?90*B.timeStamp:90000*N,K=this._aacTrack,E=B.length||0,o=H.length;E<o-1&&(255!==H[E]||240!==(246&H[E+1]));E++){}for(K.samplerate||(O=h["default"].getAudioConfig(this.observer,H,E,K.manifestCodec),K.config=O.config,K.samplerate=O.samplerate,K.channelCount=O.channelCount,K.codec=O.codec,k.logger.log("parsed codec:"+K.codec+",rate:"+O.samplerate+",nb channel:"+O.channelCount)),I=0,G=92160000/K.samplerate;E+5<o&&(L=1&H[E+1]?7:9,M=(3&H[E+3])<<11|H[E+4]<<3|(224&H[E+5])>>>5,M-=L,M>0&&E+L+M<=o);){for(F=A+I*G,J={unit:H.subarray(E+L,E+L+M),pts:F,dts:F},K.samples.push(J),K.len+=M,E+=M+L,I++;E<o-1&&(255!==H[E]||240!==(240&H[E+1]));E++){}}var C=B.payload?{samples:[{pts:A,dts:A,unit:B.payload}],inputTimeScale:90000}:{samples:[]};this.remuxer.remux(K,{samples:[]},C,{samples:[]},N,l,D)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(s){var n,o,l=new v["default"](s);for(n=l.length||0,o=s.length;n<o-1;n++){if(255===s[n]&&240===(246&s[n+1])){return !0}}return !1}}]),f}();g["default"]=p},{21:21,26:26,51:51}],21:[function(k,h,j){var g=k(51),f=k(30),l={getAudioConfig:function(x,B,i,p){var C,m,q,A,y,w=navigator.userAgent.toLowerCase(),z=p,v=[96000,88200,64000,48000,44100,32000,24000,22050,16000,12000,11025,8000,7350];return C=((192&B[i+2])>>>6)+1,m=(60&B[i+2])>>>2,m>v.length-1?void x.trigger(Event.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+m}):(A=(1&B[i+2])<<2,A|=(192&B[i+3])>>>6,g.logger.log("manifest codec:"+p+",ADTS data:type:"+C+",sampleingIndex:"+m+"["+v[m]+"Hz],channelConfig:"+A),/firefox/i.test(w)?m>=6?(C=5,y=new Array(4),q=m-3):(C=2,y=new Array(2),q=m):w.indexOf("android")!==-1?(C=2,y=new Array(2),q=m):(C=5,y=new Array(4),p&&(p.indexOf("mp4a.40.29")!==-1||p.indexOf("mp4a.40.5")!==-1)||!p&&m>=6?q=m-3:((p&&p.indexOf("mp4a.40.2")!==-1&&m>=6&&1===A||!p&&1===A)&&(C=2,y=new Array(2)),q=m)),y[0]=C<<3,y[0]|=(14&m)>>1,y[1]|=(1&m)<<7,y[1]|=A<<3,5===C&&(y[1]|=(14&q)>>1,y[2]=(1&q)<<7,y[2]|=8,y[3]=0),{config:y,samplerate:v[m],channelCount:A,codec:"mp4a.40."+C,manifestCodec:z})}};h.exports=l},{30:30,51:51}],22:[function(O,A,C){function K(f){return f&&f.__esModule?f:{"default":f}}function R(g,f){if(!(g instanceof f)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(C,"__esModule",{value:!0});var G=function(){function f(l,h){for(var k=0;k<h.length;k++){var g=h[k];g.enumerable=g.enumerable||!1,g.configurable=!0,"value" in g&&(g.writable=!0),Object.defineProperty(l,g.key,g)}}return function(g,h,e){return h&&f(g.prototype,h),e&&f(g,e),g}}(),B=O(32),F=K(B),I=O(30),x=O(18),P=K(x),N=O(20),Q=K(N),L=O(27),w=K(L),M=O(29),D=K(M),q=O(42),H=K(q),j=O(43),z=K(j),J=function(){function f(g,h,e,k){R(this,f),this.observer=g,this.typeSupported=h,this.config=e,this.vendor=k}return G(f,[{key:"destroy",value:function(){var g=this.demuxer;g&&g.destroy()}},{key:"push",value:function(W,ac,k,S,Z,o,ad,E,ab,V,X,T){if(W.byteLength>0&&null!=ac&&null!=ac.key&&"AES-128"===ac.method){var aa=this.decrypter;null==aa&&(aa=this.decrypter=new P["default"](this.observer,this.config));var U,m=this;try{U=performance.now()}catch(Y){U=Date.now()}aa.decrypt(W,ac.key.buffer,ac.iv.buffer,function(h){var i;try{i=performance.now()}catch(g){i=Date.now()}m.observer.trigger(F["default"].FRAG_DECRYPTED,{stats:{tstart:U,tdecrypt:i}}),m.pushDecrypted(new Uint8Array(h),ac,new Uint8Array(k),S,Z,o,ad,E,ab,V,X,T)})}else{this.pushDecrypted(new Uint8Array(W),ac,new Uint8Array(k),S,Z,o,ad,E,ab,V,X,T)}}},{key:"pushDecrypted",value:function(af,V,X,ab,ai,Z,W,U,ag,ae,ac,ad){var v=this.demuxer;if(!v||W&&!this.probe(af)){var l=this.observer,aa=this.typeSupported,ah=this.config,aj=[{demux:D["default"],remux:H["default"]},{demux:Q["default"],remux:H["default"]},{demux:w["default"],remux:z["default"]}];for(var o in aj){var Y=aj[o],m=Y.demux.probe;if(m(af)){var p=this.remuxer=new Y.remux(l,ah,aa,this.vendor);v=new Y.demux(l,p,ah,aa),this.probe=m;break}}if(!v){return void l.trigger(F["default"].ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"})}this.demuxer=v}var E=this.remuxer;(W||U)&&(v.resetInitSegment(X,ab,ai,ae),E.resetInitSegment()),W&&(v.resetTimeStamp(),E.resetTimeStamp(ad)),"function"==typeof v.setDecryptData&&v.setDecryptData(V),v.append(af,Z,ag,ac)}}]),f}();C["default"]=J},{18:18,20:20,27:27,29:29,30:30,32:32,42:42,43:43}],23:[function(q,y,g){function m(f){return f&&f.__esModule?f:{"default":f}}Object.defineProperty(g,"__esModule",{value:!0});var w=q(22),j=m(w),z=q(32),h=m(z),k=q(51),x=q(1),v=m(x),p=function(l){var f=new v["default"];f.trigger=function(t){for(var s=arguments.length,o=Array(s>1?s-1:0),n=1;n<s;n++){o[n-1]=arguments[n]}f.emit.apply(f,[t,t].concat(o))},f.off=function(t){for(var s=arguments.length,o=Array(s>1?s-1:0),n=1;n<s;n++){o[n-1]=arguments[n]}f.removeListener.apply(f,[t].concat(o))};var i=function(e,n){l.postMessage({event:e,data:n})};l.addEventListener("message",function(n){var e=n.data;switch(e.cmd){case"init":var r=JSON.parse(e.config);l.demuxer=new j["default"](f,e.typeSupported,r,e.vendor);try{(0,k.enableLogs)(r.debug===!0)}catch(t){console.warn("demuxerWorker: unable to enable logs")}i("init",null);break;case"demux":l.demuxer.push(e.data,e.decryptdata,e.initSegment,e.audioCodec,e.videoCodec,e.timeOffset,e.discontinuity,e.trackSwitch,e.contiguous,e.duration,e.accurateTimeOffset,e.defaultInitPTS)}}),f.on(h["default"].FRAG_DECRYPTED,i),f.on(h["default"].FRAG_PARSING_INIT_SEGMENT,i),f.on(h["default"].FRAG_PARSED,i),f.on(h["default"].ERROR,i),f.on(h["default"].FRAG_PARSING_METADATA,i),f.on(h["default"].FRAG_PARSING_USERDATA,i),f.on(h["default"].INIT_PTS_FOUND,i),f.on(h["default"].FRAG_PARSING_DATA,function(o,s){var n=[],e={event:o,data:s};s.data1&&(e.data1=s.data1.buffer,n.push(s.data1.buffer),delete s.data1),s.data2&&(e.data2=s.data2.buffer,n.push(s.data2.buffer),delete s.data2),l.postMessage(e,n)})};g["default"]=p},{1:1,22:22,32:32,51:51}],24:[function(B,H,j){function x(f){return f&&f.__esModule?f:{"default":f}}function E(g,f){if(!(g instanceof f)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(j,"__esModule",{value:!0});var q=function(){function f(n,h){for(var l=0;l<h.length;l++){var g=h[l];g.enumerable=g.enumerable||!1,g.configurable=!0,"value" in g&&(g.writable=!0),Object.defineProperty(n,g.key,g)}}return function(g,h,e){return h&&f(g.prototype,h),e&&f(g,e),g}}(),I=B(32),m=x(I),w=B(22),G=x(w),C=B(23),A=x(C),D=B(51),y=B(30),F=B(1),z=x(F),k=function(){function e(f,u){E(this,e),this.hls=f,this.id=u;var h=this.observer=new z["default"],M=f.config;h.trigger=function(s){for(var n=arguments.length,p=Array(n>1?n-1:0),l=1;l<n;l++){p[l-1]=arguments[l]}h.emit.apply(h,[s,s].concat(p))},h.off=function(s){for(var n=arguments.length,p=Array(n>1?n-1:0),l=1;l<n;l++){p[l-1]=arguments[l]}h.removeListener.apply(h,[s].concat(p))};var t=function(l,i){i=i||{},i.frag=this.frag,i.id=this.id,f.trigger(l,i)}.bind(this);h.on(m["default"].FRAG_DECRYPTED,t),h.on(m["default"].FRAG_PARSING_INIT_SEGMENT,t),h.on(m["default"].FRAG_PARSING_DATA,t),h.on(m["default"].FRAG_PARSED,t),h.on(m["default"].ERROR,t),h.on(m["default"].FRAG_PARSING_METADATA,t),h.on(m["default"].FRAG_PARSING_USERDATA,t),h.on(m["default"].INIT_PTS_FOUND,t);var J={mp4:MediaSource.isTypeSupported("video/mp4"),mpeg:MediaSource.isTypeSupported("audio/mpeg"),mp3:MediaSource.isTypeSupported('audio/mp4; codecs="mp3"')},L=navigator.vendor;if(M.enableWorker&&"undefined"!=typeof Worker){D.logger.log("demuxing in webworker");var g=void 0;try{var K=B(3);g=this.w=K(A["default"]),this.onwmsg=this.onWorkerMessage.bind(this),g.addEventListener("message",this.onwmsg),g.onerror=function(i){f.trigger(m["default"].ERROR,{type:y.ErrorTypes.OTHER_ERROR,details:y.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:i.message+" ("+i.filename+":"+i.lineno+")"}})},g.postMessage({cmd:"init",typeSupported:J,vendor:L,id:u,config:JSON.stringify(M)})}catch(o){D.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),g&&URL.revokeObjectURL(g.objectURL),this.demuxer=new G["default"](h,J,M,L),this.w=void 0}}else{this.demuxer=new G["default"](h,J,M,L)}}return q(e,[{key:"destroy",value:function(){var h=this.w;if(h){h.removeEventListener("message",this.onwmsg),h.terminate(),this.w=null}else{var f=this.demuxer;f&&(f.destroy(),this.demuxer=null)}var g=this.observer;g&&(g.removeAllListeners(),this.observer=null)}},{key:"push",value:function(S,Y,J,O,V,M,Z,L){var N=this.w,X=isNaN(V.startDTS)?V.start:V.startDTS,T=V.decryptdata,R=this.frag,P=!(R&&V.cc===R.cc),W=!(R&&V.level===R.level),Q=R&&V.sn===R.sn+1,K=!W&&Q;if(P&&D.logger.log(this.id+":discontinuity detected"),W&&D.logger.log(this.id+":switch detected"),this.frag=V,N){N.postMessage({cmd:"demux",data:S,decryptdata:T,initSegment:Y,audioCodec:J,videoCodec:O,timeOffset:X,discontinuity:P,trackSwitch:W,contiguous:K,duration:M,accurateTimeOffset:Z,defaultInitPTS:L},[S])}else{var U=this.demuxer;U&&U.push(S,T,Y,J,O,X,P,W,K,M,Z,L)}}},{key:"onWorkerMessage",value:function(h){var f=h.data,g=this.hls;switch(f.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case m["default"].FRAG_PARSING_DATA:f.data.data1=new Uint8Array(f.data1),f.data2&&(f.data.data2=new Uint8Array(f.data2));default:f.data=f.data||{},f.data.frag=this.frag,f.data.id=this.id,g.trigger(f.event,f.data)}}}]),e}();j["default"]=k},{1:1,22:22,23:23,3:3,30:30,32:32,51:51}],25:[function(l,h,k){function g(n,i){if(!(n instanceof i)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(k,"__esModule",{value:!0});var f=function(){function i(q,o){for(var p=0;p<o.length;p++){var n=o[p];n.enumerable=n.enumerable||!1,n.configurable=!0,"value" in n&&(n.writable=!0),Object.defineProperty(q,n.key,n)}}return function(n,o,e){return o&&i(n.prototype,o),e&&i(n,e),n}}(),m=l(51),j=function(){function i(e){g(this,i),this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}return f(i,[{key:"loadWord",value:function(){var s=this.data,p=this.bytesAvailable,q=s.byteLength-p,o=new Uint8Array(4),n=Math.min(4,p);if(0===n){throw new Error("no bytes available")}o.set(s.subarray(q,q+n)),this.word=new DataView(o.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n}},{key:"skipBits",value:function(o){var n;this.bitsAvailable>o?(this.word<<=o,this.bitsAvailable-=o):(o-=this.bitsAvailable,n=o>>3,o-=n>>3,this.bytesAvailable-=n,this.loadWord(),this.word<<=o,this.bitsAvailable-=o)}},{key:"readBits",value:function(p){var n=Math.min(this.bitsAvailable,p),o=this.word>>>32-n;return p>32&&m.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=n,this.bitsAvailable>0?this.word<<=n:this.bytesAvailable>0&&this.loadWord(),n=p-n,n>0&&this.bitsAvailable?o<<n|this.readBits(n):o}},{key:"skipLZ",value:function(){var n;for(n=0;n<this.bitsAvailable;++n){if(0!==(this.word&2147483648>>>n)){return this.word<<=n,this.bitsAvailable-=n,n}}return this.loadWord(),n+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var n=this.skipLZ();return this.readBits(n+1)-1}},{key:"readEG",value:function(){var n=this.readUEG();return 1&n?1+n>>>1:-1*(n>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(s){var p,q,o=8,n=8;for(p=0;p<s;p++){0!==n&&(q=this.readEG(),n=(o+q+256)%256),o=0===n?o:n}}},{key:"readSPS",value:function(){var Q,C,F,M,W,I,D,H,K,A=0,S=0,P=0,U=0,N=this.readUByte.bind(this),z=this.readBits.bind(this),O=this.readUEG.bind(this),G=this.readBoolean.bind(this),x=this.skipBits.bind(this),J=this.skipEG.bind(this),q=this.skipUEG.bind(this),B=this.skipScalingList.bind(this);if(N(),Q=N(),C=z(5),x(3),F=N(),q(),100===Q||110===Q||122===Q||244===Q||44===Q||83===Q||86===Q||118===Q||128===Q){var L=O();if(3===L&&x(1),q(),q(),x(1),G()){for(H=3!==L?8:12,K=0;K<H;K++){G()&&B(K<6?16:64)}}}q();var V=O();if(0===V){O()}else{if(1===V){for(x(1),J(),J(),M=O(),K=0;K<M;K++){J()}}}q(),x(1),W=O(),I=O(),D=z(1),0===D&&x(1),x(1),G()&&(A=O(),S=O(),P=O(),U=O());var X=[1,1];if(G()&&G()){var w=N();switch(w){case 1:X=[1,1];break;case 2:X=[12,11];break;case 3:X=[10,11];break;case 4:X=[16,11];break;case 5:X=[40,33];break;case 6:X=[24,11];break;case 7:X=[20,11];break;case 8:X=[32,11];break;case 9:X=[80,33];break;case 10:X=[18,11];break;case 11:X=[15,11];break;case 12:X=[64,33];break;case 13:X=[160,99];break;case 14:X=[4,3];break;case 15:X=[3,2];break;case 16:X=[2,1];break;case 255:X=[N()<<8|N(),N()<<8|N()]}}return{width:Math.ceil(16*(W+1)-2*A-2*S),height:(2-D)*(I+1)*16-(D?2:4)*(P+U),pixelRatio:X}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),i}();k["default"]=j},{51:51}],26:[function(l,h,k){function g(n,i){if(!(n instanceof i)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(k,"__esModule",{value:!0});var f=function(){function i(q,o){for(var p=0;p<o.length;p++){var n=o[p];n.enumerable=n.enumerable||!1,n.configurable=!0,"value" in n&&(n.writable=!0),Object.defineProperty(q,n.key,n)}}return function(n,o,e){return o&&i(n.prototype,o),e&&i(n,e),n}}(),m=l(51),j=function(){function i(z){g(this,i),this._hasTimeStamp=!1;for(var e,x,A,n,p,y,v,q,w=0;;){if(v=this.readUTF(z,w,3),w+=3,"ID3"===v){w+=3,e=127&z[w++],x=127&z[w++],A=127&z[w++],n=127&z[w++],p=(e<<21)+(x<<14)+(A<<7)+n,y=w+p,this._parseID3Frames(z,w,y),w=y}else{if("3DI"!==v){return w-=3,q=w,void (q&&(this.hasTimeStamp||m.logger.warn("ID3 tag found, but no timestamp"),this._length=q,this._payload=z.subarray(0,q)))}w+=7,m.logger.log("3DI footer found, end: "+w)}}}return f(i,[{key:"readUTF",value:function(u,q,s){var p="",o=q,v=q+s;do{p+=String.fromCharCode(u[o++])}while(o<v);return p}},{key:"_parseID3Frames",value:function(w,z,n){for(var v,x,A,p,q;z+8<=n;){switch(v=this.readUTF(w,z,4),z+=4,x=w[z++]<<24+w[z++]<<16+w[z++]<<8+w[z++],p=w[z++]<<8+w[z++],A=z,v){case"PRIV":if("com.apple.streaming.transportStreamTimestamp"===this.readUTF(w,z,44)){z+=44,z+=4;var y=1&w[z++];this._hasTimeStamp=!0,q=((w[z++]<<23)+(w[z++]<<15)+(w[z++]<<7)+w[z++])/45,y&&(q+=47721858.84),q=Math.round(q),m.logger.trace("ID3 timestamp found: "+q),this._timeStamp=q}}}}},{key:"hasTimeStamp",get:function(){return this._hasTimeStamp}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"length",get:function(){return this._length}},{key:"payload",get:function(){return this._payload}}]),i}();k["default"]=j},{51:51}],27:[function(m,q,f){function k(i){return i&&i.__esModule?i:{"default":i}}function p(l,i){if(!(l instanceof i)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(f,"__esModule",{value:!0});var h=function(){function i(s,n){for(var o=0;o<n.length;o++){var l=n[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value" in l&&(l.writable=!0),Object.defineProperty(s,l.key,l)}}return function(l,n,e){return n&&i(l.prototype,n),e&&i(l,e),l}}(),u=m(32),g=k(u),j=function(){function i(e,l){p(this,i),this.observer=e,this.remuxer=l}return h(i,[{key:"resetTimeStamp",value:function(){}},{key:"resetInitSegment",value:function(o,w,l,e){var x=this.initData=i.parseInitSegment(o),v={};x.audio&&(v.audio={container:"audio/mp4",codec:w,initSegment:o}),x.video&&(v.video={container:"video/mp4",codec:l,initSegment:o}),this.observer.trigger(g["default"].FRAG_PARSING_INIT_SEGMENT,{tracks:v})}},{key:"append",value:function(o,w,l,e){var x=this.initData,v=i.startDTS(x,o);this.remuxer.remux(x.audio,x.video,null,null,v,l,e,o)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(e){if(e.length>=8){var l=i.bin2str(e.subarray(4,8));return["moof","ftyp","styp"].indexOf(l)>=0}return !1}},{key:"bin2str",value:function(l){return String.fromCharCode.apply(null,l)}},{key:"findBox",value:function(x,z){var w,v,B,y,A,e=[];if(!z.length){return null}for(w=0;w<x.byteLength;){v=x[w]<<24,v|=x[w+1]<<16,v|=x[w+2]<<8,v|=x[w+3],B=i.bin2str(x.subarray(w+4,w+8)),y=v>1?w+v:x.byteLength,B===z[0]&&(1===z.length?e.push(x.subarray(w+8,y)):(A=i.findBox(x.subarray(w+8,y),z.slice(1)),A.length&&(e=e.concat(A)))),w=y}return e}},{key:"parseInitSegment",value:function(l){var n=[],e=i.findBox(l,["moov","trak"]);return e.forEach(function(C){var x=i.findBox(C,["tkhd"])[0];if(x){var A=x[0],v=0===A?12:20,D=x[v]<<24|x[v+1]<<16|x[v+2]<<8|x[v+3];D=D<0?4294967296+D:D;var r=i.findBox(C,["mdia","mdhd"])[0];if(r){A=r[0],v=0===A?12:20;var w=r[v]<<24|r[v+1]<<16|r[v+2]<<8|r[v+3],B=i.findBox(C,["mdia","hdlr"])[0];if(B){var z=i.bin2str(B.subarray(8,12)),y={soun:"audio",vide:"video"}[z];y&&(n[D]={timescale:w,type:y},n[y]={timescale:w,id:D})}}}}),n}},{key:"startDTS",value:function(o,s){var l,e,v;return l=i.findBox(s,["moof","traf"]),e=[].concat.apply([],l.map(function(n){return i.findBox(n,["tfhd"]).map(function(t){var r,x,w;return r=t[4]<<24|t[5]<<16|t[6]<<8|t[7],x=o[r].timescale||90000,w=i.findBox(n,["tfdt"]).map(function(A){var y,z;return y=A[0],z=A[4]<<24|A[5]<<16|A[6]<<8|A[7],1===y&&(z*=Math.pow(2,32),z+=A[8]<<24|A[9]<<16|A[10]<<8|A[11]),z})[0],w=w||1/0,w/x})})),v=Math.min.apply(null,e),isFinite(v)?v:0}}]),i}();f["default"]=j},{32:32}],28:[function(m,q,f){function k(i){return i&&i.__esModule?i:{"default":i}}function p(l,i){if(!(l instanceof i)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(f,"__esModule",{value:!0});var h=function(){function i(s,n){for(var o=0;o<n.length;o++){var l=n[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value" in l&&(l.writable=!0),Object.defineProperty(s,l.key,l)}}return function(l,n,e){return n&&i(l.prototype,n),e&&i(l,e),l}}(),u=m(18),g=k(u),j=function(){function i(l,o,e,s){p(this,i),this.decryptdata=e,this.discardEPB=s,this.decrypter=new g["default"](l,o)}return h(i,[{key:"decryptBuffer",value:function(n,l){this.decrypter.decrypt(n,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,l)}},{key:"decryptAacSample",value:function(z,w,y,v){var l=z[w].unit,B=l.subarray(16,l.length-l.length%16),x=B.buffer.slice(B.byteOffset,B.byteOffset+B.length),A=this;this.decryptBuffer(x,function(e){e=new Uint8Array(e),l.set(e,16),v||A.decryptAacSamples(z,w+1,y)})}},{key:"decryptAacSamples",value:function(s,n,o){for(;;n++){if(n>=s.length){return void o()}if(!(s[n].unit.length<32)){var l=this.decrypter.isSync();if(this.decryptAacSample(s,n,o,l),!l){return}}}}},{key:"getAvcEncryptedData",value:function(v){for(var o=16*Math.floor((v.length-48)/160)+16,s=new Int8Array(o),n=0,l=32;l<=v.length-16;l+=160,n+=16){s.set(v.subarray(l,l+16),n)}return s}},{key:"getAvcDecryptedUnit",value:function(s,n){n=new Uint8Array(n);for(var o=0,l=32;l<=s.length-16;l+=160,o+=16){s.set(n.subarray(o,o+16),l)}return s}},{key:"decryptAvcSample",value:function(A,C,v,z,B,x){var D=this.discardEPB(B.data),w=this.getAvcEncryptedData(D),y=this;this.decryptBuffer(w.buffer,function(e){B.data=y.getAvcDecryptedUnit(D,e),x||y.decryptAvcSamples(A,C,v+1,z)})}},{key:"decryptAvcSamples",value:function(y,v,x,o){for(;;v++,x=0){if(v>=y.length){return void o()}for(var l=y[v].units;!(x>=l.length);x++){var z=l[x];if(!(z.length<=48||1!==z.type&&5!==z.type)){var w=this.decrypter.isSync();if(this.decryptAvcSample(y,v,x,o,z,w),!w){return}}}}}}]),i}();f["default"]=j},{18:18}],29:[function(B,H,j){function x(f){return f&&f.__esModule?f:{"default":f}}function E(g,f){if(!(g instanceof f)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(j,"__esModule",{value:!0});var q=function(){function f(n,h){for(var l=0;l<h.length;l++){var g=h[l];g.enumerable=g.enumerable||!1,g.configurable=!0,"value" in g&&(g.writable=!0),Object.defineProperty(n,g.key,g)}}return function(g,h,e){return h&&f(g.prototype,h),e&&f(g,e),g}}(),I=B(21),m=x(I),w=B(32),G=x(w),C=B(25),A=x(C),D=B(28),y=x(D),F=B(51),z=B(30),k=function(){function f(g,h,e,l){E(this,f),this.observer=g,this.config=e,this.typeSupported=l,this.remuxer=h,this.sampleAes=null}return q(f,[{key:"setDecryptData",value:function(g){null!=g&&null!=g.key&&"SAMPLE-AES"===g.method?this.sampleAes=new y["default"](this.observer,this.config,g,this.discardEPB):this.sampleAes=null}},{key:"resetInitSegment",value:function(n,h,l,g){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack={container:"video/mp2t",type:"video",id:-1,inputTimeScale:90000,sequenceNumber:0,samples:[],len:0,dropped:0},this._audioTrack={container:"video/mp2t",type:"audio",id:-1,inputTimeScale:90000,sequenceNumber:0,samples:[],len:0,isAAC:!0},this._id3Track={type:"id3",id:-1,inputTimeScale:90000,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,inputTimeScale:90000,sequenceNumber:0,samples:[],len:0},this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=h,this.videoCodec=l,this._duration=g}},{key:"resetTimeStamp",value:function(){}},{key:"append",value:function(al,W,aa,ai){var ap,ae,Y,ad,ag,am,ak=al.length,an=!1;this.contiguous=aa;var aj=this.pmtParsed,ac=this._avcTrack,N=this._audioTrack,af=this._id3Track,g=ac.id,V=N.id,ah=af.id,ao=this._pmtId,aq=ac.pesData,v=N.pesData,ab=af.pesData,u=this._parsePAT,M=this._parsePMT,U=this._parsePES,X=this._parseAVCPES.bind(this),K=this._parseAACPES.bind(this),Q=this._parseMPEGPES.bind(this),Z=this._parseID3PES.bind(this);for(ak-=ak%188,ap=0;ap<ak;ap+=188){if(71===al[ap]){if(ae=!!(64&al[ap+1]),Y=((31&al[ap+1])<<8)+al[ap+2],ad=(48&al[ap+3])>>4,ad>1){if(ag=ap+5+al[ap+4],ag===ap+188){continue}}else{ag=ap+4}switch(Y){case g:ae&&(aq&&(am=U(aq))&&X(am,!1),aq={data:[],size:0}),aq&&(aq.data.push(al.subarray(ag,ap+188)),aq.size+=ap+188-ag);break;case V:ae&&(v&&(am=U(v))&&(N.isAAC?K(am):Q(am)),v={data:[],size:0}),v&&(v.data.push(al.subarray(ag,ap+188)),v.size+=ap+188-ag);break;case ah:ae&&(ab&&(am=U(ab))&&Z(am),ab={data:[],size:0}),ab&&(ab.data.push(al.subarray(ag,ap+188)),ab.size+=ap+188-ag);break;case 0:ae&&(ag+=al[ag]+1),ao=this._pmtId=u(al,ag);break;case ao:ae&&(ag+=al[ag]+1);var J=M(al,ag,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,null!=this.sampleAes);g=J.avc,g>0&&(ac.id=g),V=J.audio,V>0&&(N.id=V,N.isAAC=J.isAAC),ah=J.id3,ah>0&&(af.id=ah),an&&!aj&&(F.logger.log("reparse from beginning"),an=!1,ap=-188),aj=this.pmtParsed=!0;break;case 17:case 8191:break;default:an=!0}}else{this.observer.trigger(G["default"].ERROR,{type:z.ErrorTypes.MEDIA_ERROR,details:z.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"})}}aq&&(am=U(aq))?(X(am,!0),ac.pesData=null):ac.pesData=aq,v&&(am=U(v))?(N.isAAC?K(am):Q(am),N.pesData=null):(v&&v.size&&F.logger.log("last AAC PES packet truncated,might overlap between fragments"),N.pesData=v),ab&&(am=U(ab))?(Z(am),af.pesData=null):af.pesData=ab,null==this.sampleAes?this.remuxer.remux(N,ac,af,this._txtTrack,W,aa,ai):this.decryptAndRemux(N,ac,af,this._txtTrack,W,aa,ai)}},{key:"decryptAndRemux",value:function(v,l,u,h,g,K,p){if(v.samples&&v.isAAC){var J=this;this.sampleAes.decryptAacSamples(v.samples,0,function(){J.decryptAndRemuxAvc(v,l,u,h,g,K,p)})}else{this.decryptAndRemuxAvc(v,l,u,h,g,K,p)}}},{key:"decryptAndRemuxAvc",value:function(v,l,u,h,g,K,p){if(l.samples){var J=this;this.sampleAes.decryptAvcSamples(l.samples,0,0,function(){J.remuxer.remux(v,l,u,h,g,K,p)})}else{this.remuxer.remux(v,l,u,h,g,K,p)}}},{key:"destroy",value:function(){this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(h,g){return(31&h[g+10])<<8|h[g+11]}},{key:"_parsePMT",value:function(J,L,g,v){var K,p,M,h,u={audio:-1,avc:-1,id3:-1,isAAC:!0};for(K=(15&J[L+1])<<8|J[L+2],p=L+3+K-4,M=(15&J[L+10])<<8|J[L+11],L+=12+M;L<p;){switch(h=(31&J[L+1])<<8|J[L+2],J[L]){case 207:if(!v){F.logger.log("unkown stream type:"+J[L]);break}case 15:u.audio===-1&&(u.audio=h);break;case 21:u.id3===-1&&(u.id3=h);break;case 219:if(!v){F.logger.log("unkown stream type:"+J[L]);break}case 27:u.avc===-1&&(u.avc=h);break;case 3:case 4:g?u.audio===-1&&(u.audio=h,u.isAAC=!1):F.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:F.logger.warn("HEVC stream type found, not supported for now");break;default:F.logger.log("unkown stream type:"+J[L])}L+=((15&J[L+3])<<8|J[L+4])+5}return u}},{key:"_parsePES",value:function(R){var W,v,N,U,L,X,K,M,V,S=0,Q=R.data;if(!R||0===R.size){return null}for(;Q[0].length<19&&Q.length>1;){var T=new Uint8Array(Q[0].length+Q[1].length);T.set(Q[0]),T.set(Q[1],Q[0].length),Q[0]=T,Q.splice(1,1)}if(W=Q[0],N=(W[0]<<16)+(W[1]<<8)+W[2],1===N){if(U=(W[4]<<8)+W[5],U&&U>R.size-6){return null}v=W[7],192&v&&(K=536870912*(14&W[9])+4194304*(255&W[10])+16384*(254&W[11])+128*(255&W[12])+(254&W[13])/2,K>4294967295&&(K-=8589934592),64&v?(M=536870912*(14&W[14])+4194304*(255&W[15])+16384*(254&W[16])+128*(255&W[17])+(254&W[18])/2,M>4294967295&&(M-=8589934592),K-M>5400000&&(F.logger.warn(Math.round((K-M)/90000)+"s delta between PTS and DTS, align them"),K=M)):M=K),L=W[8],V=L+9,R.size-=V,X=new Uint8Array(R.size);for(var O=0,P=Q.length;O<P;O++){W=Q[O];var J=W.byteLength;if(V){if(V>J){V-=J;continue}W=W.subarray(V),J-=V,V=0}X.set(W,S),S+=J}return U&&(U-=L+3),{data:X,pts:K,dts:M,len:U}}return null}},{key:"pushAccesUnit",value:function(n,h){if(n.units.length&&n.frame){var l=h.samples,g=l.length;!this.config.forceKeyFrameOnDiscontinuity||n.key===!0||h.sps&&(g||this.contiguous)?(n.id=g,l.push(n)):h.dropped++}n.debug.length&&F.logger.log(n.pts+"/"+n.dts+":"+n.debug)}},{key:"_parseAVCPES",value:function(K,N){var g,J,L,p=this,O=this._avcTrack,h=this._parseAVCNALu(K.data),v=!1,M=this.avcSample;K.data=null,h.forEach(function(Q){switch(Q.type){case 1:J=!0,v&&M&&(M.debug+="NDR "),M.frame=!0;var W=Q.data;if(W.length>4){var ab=new A["default"](W).readSliceType();2!==ab&&4!==ab&&7!==ab&&9!==ab||(M.key=!0)}break;case 5:J=!0,M||(M=p.avcSample=p._createAVCSample(!0,K.pts,K.dts,"")),v&&(M.debug+="IDR "),M.key=!0,M.frame=!0;break;case 6:J=!0,v&&M&&(M.debug+="SEI "),g=new A["default"](p.discardEPB(Q.data)),g.readUByte();for(var ac=0,Z=0,u=!1,aa=0;!u&&g.bytesAvailable>1;){ac=0;do{aa=g.readUByte(),ac+=aa}while(255===aa);Z=0;do{aa=g.readUByte(),Z+=aa}while(255===aa);if(4===ac&&0!==g.bytesAvailable){u=!0;var V=g.readUByte();if(181===V){var r=g.readUShort();if(49===r){var X=g.readUInt();if(1195456820===X){var e=g.readUByte();if(3===e){var P=g.readUByte(),Y=g.readUByte(),ad=31&P,ae=[P,Y];for(L=0;L<ad;L++){ae.push(g.readUByte()),ae.push(g.readUByte()),ae.push(g.readUByte())}p._insertSampleInOrder(p._txtTrack.samples,{type:3,pts:K.pts,bytes:ae})}}}}}else{if(Z<g.bytesAvailable){for(L=0;L<Z;L++){g.readUByte()}}}}break;case 7:if(J=!0,v&&M&&(M.debug+="SPS "),!O.sps){g=new A["default"](Q.data);var l=g.readSPS();O.width=l.width,O.height=l.height,O.pixelRatio=l.pixelRatio,O.sps=[Q.data],O.duration=p._duration;var U=Q.data.subarray(1,4),i="avc1.";for(L=0;L<3;L++){var n=U[L].toString(16);n.length<2&&(n="0"+n),i+=n}O.codec=i}break;case 8:J=!0,v&&M&&(M.debug+="PPS "),O.pps||(O.pps=[Q.data]);break;case 9:J=!1,M&&p.pushAccesUnit(M,O),M=p.avcSample=p._createAVCSample(!1,K.pts,K.dts,v?"AUD ":"");break;case 12:J=!1;break;default:J=!1,M&&(M.debug+="unknown NAL "+Q.type+" ")}if(M&&J){var s=M.units;s.push(Q)}}),N&&M&&(this.pushAccesUnit(M,O),this.avcSample=null)}},{key:"_createAVCSample",value:function(n,h,l,g){return{key:n,pts:h,dts:l,units:[],debug:g}}},{key:"_insertSampleInOrder",value:function(n,h){var l=n.length;if(l>0){if(h.pts>=n[l-1].pts){n.push(h)}else{for(var g=l-1;g>=0;g--){if(h.pts<n[g].pts){n.splice(g,0,h);break}}}}else{n.push(h)}}},{key:"_getLastNalUnit",value:function(){var o=this.avcSample,l=void 0;if(!o||0===o.units.length){var n=this._avcTrack,h=n.samples;o=h[h.length-1]}if(o){var g=o.units;l=g[g.length-1]}return l}},{key:"_parseAVCNALu",value:function(S){var Y,J,O,V,M,Z=0,L=S.byteLength,N=this._avcTrack,X=N.naluState||0,T=X,R=[],U=-1;for(X===-1&&(U=0,M=31&S[0],X=0,Z=1);Z<L;){if(Y=S[Z++],X){if(1!==X){if(Y){if(1===Y){if(U>=0){O={data:S.subarray(U,Z-X-1),type:M},R.push(O)}else{var P=this._getLastNalUnit();if(P&&(T&&Z<=4-T&&P.state&&(P.data=P.data.subarray(0,P.data.byteLength-T)),J=Z-X-1,J>0)){var W=new Uint8Array(P.data.byteLength+J);W.set(P.data,0),W.set(S.subarray(0,J),P.data.byteLength),P.data=W}}Z<L?(V=31&S[Z],U=Z,M=V,X=0):X=-1}else{X=0}}else{X=3}}else{X=Y?0:2}}else{X=Y?0:1}}if(U>=0&&X>=0&&(O={data:S.subarray(U,L),type:M,state:X},R.push(O)),0===R.length){var Q=this._getLastNalUnit();if(Q){var K=new Uint8Array(Q.data.byteLength+S.byteLength);K.set(Q.data,0),K.set(S,Q.data.byteLength),Q.data=K}}return N.naluState=X,R}},{key:"discardEPB",value:function(u){for(var l,p,h=u.byteLength,g=[],v=1;v<h-2;){0===u[v]&&0===u[v+1]&&3===u[v+2]?(g.push(v+2),v+=2):v++}if(0===g.length){return u}l=h-g.length,p=new Uint8Array(l);var o=0;for(v=0;v<l;o++,v++){o===g[0]&&(o++,g.shift()),p[v]=u[o]}return p}},{key:"_parseAACPES",value:function(W){var J,L,S,aa,N,K,P,X,V,Y=this._audioTrack,U=W.data,M=W.pts,u=0,O=this.aacOverFlow,g=this.aacLastPTS;if(O){var v=new Uint8Array(O.byteLength+U.byteLength);v.set(O,0),v.set(U,O.byteLength),U=v}for(N=u,X=U.length;N<X-1&&(255!==U[N]||240!==(240&U[N+1]));N++){}if(N){var Q,Z;if(N<X-1?(Q="AAC PES did not start with ADTS header,offset:"+N,Z=!1):(Q="no ADTS header found in AAC PES",Z=!0),F.logger.warn("parsing error:"+Q),this.observer.trigger(G["default"].ERROR,{type:z.ErrorTypes.MEDIA_ERROR,details:z.ErrorDetails.FRAG_PARSING_ERROR,fatal:Z,reason:Q}),Z){return}}if(!Y.samplerate){var ab=this.audioCodec;J=m["default"].getAudioConfig(this.observer,U,N,ab),Y.config=J.config,Y.samplerate=J.samplerate,Y.channelCount=J.channelCount,Y.codec=J.codec,Y.manifestCodec=J.manifestCodec,Y.duration=this._duration,F.logger.log("parsed codec:"+Y.codec+",rate:"+J.samplerate+",nb channel:"+J.channelCount)}if(aa=0,S=92160000/Y.samplerate,O&&g){var o=g+S;Math.abs(o-M)>1&&(F.logger.log("AAC: align PTS for overlapping frames by "+Math.round((o-M)/90)),M=o)}for(;N+5<X&&(K=1&U[N+1]?7:9,L=(3&U[N+3])<<11|U[N+4]<<3|(224&U[N+5])>>>5,L-=K,L>0&&N+K+L<=X);){for(P=M+aa*S,V={unit:U.subarray(N+K,N+K+L),pts:P,dts:P},Y.samples.push(V),Y.len+=L,N+=L+K,aa++;N<X-1&&(255!==U[N]||240!==(240&U[N+1]));N++){}}O=N<X?U.subarray(N,X):null,this.aacOverFlow=O,this.aacLastPTS=P}},{key:"_parseMPEGPES",value:function(u){for(var l,p=u.data,h=u.pts,g=p.length,v=0,o=0;o<g&&(l=this._parseMpeg(p,o,g,v++,h))>0;){o+=l}}},{key:"_onMpegFrame",value:function(J,L,g,v,K,p){var M=1152/g*1000,h=p+K*M,u=this._audioTrack;u.config=[],u.channelCount=v,u.samplerate=g,u.duration=this._duration,u.samples.push({unit:J,pts:h,dts:h}),u.len+=J.length}},{key:"_onMpegNoise",value:function(g){F.logger.warn("mpeg audio has noise: "+g.length+" bytes")}},{key:"_parseMpeg",value:function(aa,N,P,W,ad){var S=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],O=[44100,48000,32000,22050,24000,16000,11025,12000,8000];if(N+2>P){return -1}if(255===aa[N]||224===(224&aa[N+1])){if(N+24>P){return -1}var R=aa[N+1]>>3&3,V=aa[N+1]>>1&3,M=aa[N+2]>>4&15,ab=aa[N+2]>>2&3,Z=!!(2&aa[N+2]);if(1!==R&&0!==M&&15!==M&&3!==ab){var ac=3===R?3-V:3===V?3:4,X=1000*S[14*ac+M-1],L=3===R?0:2===R?1:2,Y=O[3*L+ab],Q=Z?1:0,K=aa[N+3]>>6===3?1:2,U=3===V?(3===R?12:6)*X/Y+Q<<2:(3===R?144:72)*X/Y+Q|0;return N+U>P?-1:(this._onMpegFrame&&this._onMpegFrame(aa.subarray(N,N+U),X,Y,K,W,ad),U)}}for(var J=N+2;J<P;){if(255===aa[J-1]&&224===(224&aa[J])){return this._onMpegNoise&&this._onMpegNoise(aa.subarray(N,J-1)),J-N-1}J++}return -1}},{key:"_parseID3PES",value:function(g){this._id3Track.samples.push(g)}}],[{key:"probe",value:function(g){return g.length>=564&&71===g[0]&&71===g[188]&&71===g[376]}}]),f}();j["default"]=k},{21:21,25:25,28:28,30:30,32:32,51:51}],30:[function(h,f,g){Object.defineProperty(g,"__esModule",{value:!0});g.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},g.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",MANIFEST_EMPTY_ERROR:"manifestEmptyError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException",WEBVTT_EXCEPTION:"webVTTException"}},{}],31:[function(q,y,g){function m(f){return f&&f.__esModule?f:{"default":f}}function w(i,f){if(!(i instanceof f)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(g,"__esModule",{value:!0});var j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(f){return typeof f}:function(f){return f&&"function"==typeof Symbol&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},z=function(){function f(s,n){for(var o=0;o<n.length;o++){var l=n[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value" in l&&(l.writable=!0),Object.defineProperty(s,l.key,l)}}return function(l,n,e){return n&&f(l.prototype,n),e&&f(l,e),l}}(),h=q(51),k=q(30),x=q(32),v=m(x),p=function(){function f(l){w(this,f),this.hls=l,this.onEvent=this.onEvent.bind(this);for(var o=arguments.length,e=Array(o>1?o-1:0),s=1;s<o;s++){e[s-1]=arguments[s]}this.handledEvents=e,this.useGenericHandler=!0,this.registerListeners()}return z(f,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===j(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(i){if("hlsEventGeneric"===i){throw new Error("Forbidden event name: "+i)}this.hls.on(i,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(i){this.hls.off(i,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(l,i){this.onEventGeneric(l,i)}},{key:"onEventGeneric",value:function(s,n){var o=function(A,i){var u="on"+A.replace("hls","");if("function"!=typeof this[u]){throw new Error("Event "+A+" has no generic handler in this "+this.constructor.name+" class (tried "+u+")")}return this[u].bind(this,i)};try{o.call(this,s,n).call()}catch(l){h.logger.error("internal error happened while processing "+s+":"+l.message),this.hls.trigger(v["default"].ERROR,{type:k.ErrorTypes.OTHER_ERROR,details:k.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:s,err:l})}}}]),f}();g["default"]=p},{30:30,32:32,51:51}],32:[function(h,f,g){f.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCH:"hlsLevelSwitch",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVEL_REMOVED:"hlsLevelRemoved",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",CUES_PARSED:"hlsCuesParsed",NON_NATIVE_TEXT_TRACKS_FOUND:"hlsNonNativeTextTracksFound",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPT_STARTED:"hlsFragDecryptStarted",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},{}],33:[function(k,h,j){function g(m,i){if(!(m instanceof i)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(j,"__esModule",{value:!0});var f=function(){function i(p,n){for(var o=0;o<n.length;o++){var m=n[o];m.enumerable=m.enumerable||!1,m.configurable=!0,"value" in m&&(m.writable=!0),Object.defineProperty(p,m.key,m)}}return function(m,n,e){return n&&i(m.prototype,n),e&&i(m,e),m}}(),l=function(){function i(){g(this,i)}return f(i,null,[{key:"getSilentFrame",value:function(n,m){switch(n){case"mp4a.40.2":if(1===m){return new Uint8Array([0,200,0,128,35,128])}if(2===m){return new Uint8Array([33,0,73,144,2,25,0,35,128])}if(3===m){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142])}if(4===m){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56])}if(5===m){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56])}if(6===m){return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}break;default:if(1===m){return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}if(2===m){return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}if(3===m){return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}return null}}]),i}();j["default"]=l},{}],34:[function(j,g,h){var f={isBuffered:function(n,l){if(n){for(var m=n.buffered,k=0;k<m.length;k++){if(l>=m.start(k)&&l<=m.end(k)){return !0}}}return !1},bufferInfo:function(u,m,q){var l={len:0,start:m,end:m,nextStart:void 0};if(!u){return l}try{for(var k=u.buffered,w=[],p=0;p<k.length;p++){w.push({start:k.start(p),end:k.end(p)})}return this.bufferedInfo(w,m,q)}catch(v){return l}},bufferedInfo:function(x,C,k){var v,A,p,D,m,q=[];for(x.sort(function(n,i){var l=n.start-i.start;return l?l:i.end-n.end}),m=0;m<x.length;m++){var B=q.length;if(B){var y=q[B-1].end;x[m].start-y<k?x[m].end>y&&(q[B-1].end=x[m].end):q.push(x[m])}else{q.push(x[m])}}for(m=0,v=0,A=p=C;m<q.length;m++){var w=q[m].start,z=q[m].end;if(C+k>=w&&C<z){A=w,p=z,v=p-C}else{if(C+k<w){D=w;break}}}return{len:v,start:A||0,end:p||0,nextStart:D}}};g.exports=f},{}],35:[function(k,h,j){var g=k(51),f={mergeDetails:function(y,D){var i,p=Math.max(y.startSN,D.startSN)-D.startSN,E=Math.min(y.endSN,D.endSN)-D.startSN,m=D.startSN-y.startSN,q=y.fragments,C=D.fragments,z=0;if(E<p){return void (D.PTSKnown=!1)}for(var x=p;x<=E;x++){var A=q[m+x],w=C[x];w&&A&&(z=A.cc-w.cc,isNaN(A.startPTS)||(w.start=w.startPTS=A.startPTS,w.endPTS=A.endPTS,w.duration=A.duration,w.backtracked=A.backtracked,w.dropped=A.dropped,i=w))}if(z){for(g.logger.log("discontinuity sliding from playlist, take drift into account"),x=0;x<C.length;x++){C[x].cc+=z}}if(i){f.updateFragPTSDTS(D,i.sn,i.startPTS,i.endPTS,i.startDTS,i.endDTS)}else{if(m>=0&&m<q.length){var B=q[m].start;for(x=0;x<C.length;x++){C[x].start+=B}}}D.PTSKnown=y.PTSKnown},updateFragPTSDTS:function(y,C,m,w,q,D){var p,v,B,z;if(!y||C<y.startSN||C>y.endSN){return 0}if(p=C-y.startSN,v=y.fragments,B=v[p],!isNaN(B.startPTS)){var x=Math.abs(B.startPTS-m);isNaN(B.deltaPTS)?B.deltaPTS=x:B.deltaPTS=Math.max(x,B.deltaPTS),m=Math.min(m,B.startPTS),w=Math.max(w,B.endPTS),q=Math.min(q,B.startDTS),D=Math.max(D,B.endDTS)}var A=m-B.start;for(B.start=B.startPTS=m,B.endPTS=w,B.startDTS=q,B.endDTS=D,B.duration=w-m,z=p;z>0;z--){f.updatePTS(v,z,z-1)}for(z=p;z<v.length-1;z++){f.updatePTS(v,z,z+1)}return y.PTSKnown=!0,A},updatePTS:function(p,l,o){var i=p[l],q=p[o],m=q.startPTS;isNaN(m)?o>l?q.start=i.start+i.duration:q.start=Math.max(i.start-q.duration,0):o>l?(i.duration=m-i.start,i.duration<0&&g.logger.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!")):(q.duration=i.start-m,q.duration<0&&g.logger.warn("negative duration computed for frag "+q.sn+",level "+q.level+", there should be some duration drift between playlist and fragment!"))}};h.exports=f},{51:51}],36:[function(S,C,F){function N(f){return f&&f.__esModule?f:{"default":f}}function X(g,f){if(!(g instanceof f)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(F,"__esModule",{value:!0});var J=function(){function f(l,h){for(var k=0;k<h.length;k++){var g=h[k];g.enumerable=g.enumerable||!1,g.configurable=!0,"value" in g&&(g.writable=!0),Object.defineProperty(l,g.key,g)}}return function(g,h,e){return h&&f(g.prototype,h),e&&f(g,e),g}}(),D=S(2),I=N(D),L=S(32),z=N(L),U=S(30),Q=S(40),V=N(Q),O=S(38),x=N(O),P=S(39),H=N(P),w=S(12),K=N(w),j=S(11),B=N(j),M=S(51),W=S(1),Y=N(W),q=S(4),G=function(){function f(){var Z=this,ab=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};X(this,f);var ag=f.DefaultConfig;if((ab.liveSyncDurationCount||ab.liveMaxLatencyDurationCount)&&(ab.liveSyncDuration||ab.liveMaxLatencyDuration)){throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration")}for(var ae in ag){ae in ab||(ab[ae]=ag[ae])}if(void 0!==ab.liveMaxLatencyDurationCount&&ab.liveMaxLatencyDurationCount<=ab.liveSyncDurationCount){throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"')}if(void 0!==ab.liveMaxLatencyDuration&&(ab.liveMaxLatencyDuration<=ab.liveSyncDuration||void 0===ab.liveSyncDuration)){throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"')}(0,M.enableLogs)(ab.debug),this.config=ab,this._autoLevelCapping=-1;var aa=this.observer=new Y["default"];aa.trigger=function(n){for(var h=arguments.length,l=Array(h>1?h-1:0),g=1;g<h;g++){l[g-1]=arguments[g]}aa.emit.apply(aa,[n,n].concat(l))},aa.off=function(n){for(var h=arguments.length,l=Array(h>1?h-1:0),g=1;g<h;g++){l[g-1]=arguments[g]}aa.removeListener.apply(aa,[n].concat(l))},this.on=aa.on.bind(aa),this.off=aa.off.bind(aa),this.trigger=aa.trigger.bind(aa);var ad=this.abrController=new ab.abrController(this),af=new ab.bufferController(this),E=new ab.capLevelController(this),ak=new ab.fpsController(this),aj=new V["default"](this),ah=new x["default"](this),ai=new H["default"](this),v=this.levelController=new B["default"](this),e=this.streamController=new K["default"](this),al=[v,e],m=ab.audioStreamController;m&&al.push(new m(this)),this.networkControllers=al;var ac=[aj,ah,ai,ad,af,E,ak];if(m=ab.audioTrackController){var k=new m(this);this.audioTrackController=k,ac.push(k)}if(m=ab.subtitleTrackController){var p=new m(this);this.subtitleTrackController=p,ac.push(p)}[ab.subtitleStreamController,ab.timelineController].forEach(function(g){g&&ac.push(new g(Z))}),this.coreComponents=ac}return J(f,null,[{key:"isSupported",value:function(){return window.MediaSource=window.MediaSource||window.WebKitMediaSource,window.MediaSource&&"function"==typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"version",get:function(){return"0.7.5"}},{key:"Events",get:function(){return z["default"]}},{key:"ErrorTypes",get:function(){return U.ErrorTypes}},{key:"ErrorDetails",get:function(){return U.ErrorDetails}},{key:"DefaultConfig",get:function(){return f.defaultConfig?f.defaultConfig:q.hlsDefaultConfig},set:function(e){f.defaultConfig=e}}]),J(f,[{key:"destroy",value:function(){M.logger.log("destroy"),this.trigger(z["default"].DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(g){g.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1}},{key:"attachMedia",value:function(g){M.logger.log("attachMedia"),this.media=g,this.trigger(z["default"].MEDIA_ATTACHING,{media:g})}},{key:"detachMedia",value:function(){M.logger.log("detachMedia"),this.trigger(z["default"].MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(g){g=I["default"].buildAbsoluteURL(window.location.href,g,{alwaysNormalize:!0}),M.logger.log("loadSource:"+g),this.url=g,this.trigger(z["default"].MANIFEST_LOADING,{url:g})}},{key:"startLoad",value:function(){var g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;M.logger.log("startLoad("+g+")"),this.networkControllers.forEach(function(e){e.startLoad(g)})}},{key:"stopLoad",value:function(){M.logger.log("stopLoad"),this.networkControllers.forEach(function(g){g.stopLoad()})}},{key:"swapAudioCodec",value:function(){M.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){M.logger.log("recoverMediaError");var g=this.media;this.detachMedia(),this.attachMedia(g)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(g){M.logger.log("set currentLevel:"+g),this.loadLevel=g,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(g){M.logger.log("set nextLevel:"+g),this.levelController.manualLevel=g,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(g){M.logger.log("set loadLevel:"+g),this.levelController.manualLevel=g}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(g){this.levelController.nextLoadLevel=g}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(g){M.logger.log("set firstLevel:"+g),this.levelController.firstLevel=g}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(h){M.logger.log("set startLevel:"+h);var g=this;h!==-1&&(h=Math.max(h,g.minAutoLevel)),g.levelController.startLevel=h}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(g){M.logger.log("set autoLevelCapping:"+g),this._autoLevelCapping=g}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var m=this,k=m.levels,l=m.config.minAutoBitrate,h=k?k.length:0,g=0;g<h;g++){var o=k[g].realBitrate?Math.max(k[g].realBitrate,k[g].bitrate):k[g].bitrate;if(o>l){return g}}return 0}},{key:"maxAutoLevel",get:function(){var l=this,h=l.levels,k=l.autoLevelCapping,g=void 0;return g=k===-1&&h&&h.length?h.length-1:k}},{key:"nextAutoLevel",get:function(){var g=this;return Math.min(Math.max(g.abrController.nextAutoLevel,g.minAutoLevel),g.maxAutoLevel)},set:function(h){var g=this;g.abrController.nextAutoLevel=Math.max(g.minAutoLevel,h)}},{key:"audioTracks",get:function(){var g=this.audioTrackController;return g?g.audioTracks:[]}},{key:"audioTrack",get:function(){var g=this.audioTrackController;return g?g.audioTrack:-1},set:function(h){var g=this.audioTrackController;g&&(g.audioTrack=h)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var g=this.subtitleTrackController;return g?g.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var g=this.subtitleTrackController;return g?g.subtitleTrack:-1},set:function(h){var g=this.subtitleTrackController;g&&(g.subtitleTrack=h)}}]),f}();F["default"]=G},{1:1,11:11,12:12,2:2,30:30,32:32,38:38,39:39,4:4,40:40,51:51}],37:[function(h,f,g){f.exports=h(36)["default"]},{36:36}],38:[function(x,D,g){function p(f){return f&&f.__esModule?f:{"default":f}}function A(h,f){if(!(h instanceof f)){throw new TypeError("Cannot call a class as a function")}}function k(h,f){if(!h){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return !f||"object"!=typeof f&&"function"!=typeof f?h:f}function E(h,f){if("function"!=typeof f&&null!==f){throw new TypeError("Super expression must either be null or a function, not "+typeof f)}h.prototype=Object.create(f&&f.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(h,f):h.__proto__=f)}Object.defineProperty(g,"__esModule",{value:!0});var j=function(){function f(o,l){for(var n=0;n<l.length;n++){var h=l[n];h.enumerable=h.enumerable||!1,h.configurable=!0,"value" in h&&(h.writable=!0),Object.defineProperty(o,h.key,h)}}return function(h,l,e){return l&&f(h.prototype,l),e&&f(h,e),h}}(),m=x(32),C=p(m),y=x(31),w=p(y),z=x(30),q=x(51),B=function(h){function f(l){A(this,f);var i=k(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,l,C["default"].FRAG_LOADING));return i.loaders={},i}return E(f,h),j(f,[{key:"destroy",value:function(){var n=this.loaders;for(var i in n){var l=n[i];l&&l.destroy()}this.loaders={},w["default"].prototype.destroy.call(this)}},{key:"onFragLoading",value:function(J){var M=J.frag,v=M.type,I=this.loaders[v],K=this.hls.config;M.loaded=0,I&&(q.logger.warn("abort previous fragment loader for type:"+v),I.abort()),I=this.loaders[v]=M.loader="undefined"!=typeof K.fLoader?new K.fLoader(K):new K.loader(K);var G=void 0,N=void 0,F=void 0;G={url:M.url,frag:M,responseType:"arraybuffer",progressData:!1};var H=M.byteRangeStartOffset,L=M.byteRangeEndOffset;isNaN(H)||isNaN(L)||(G.rangeStart=H,G.rangeEnd=L),N={timeout:K.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:K.fragLoadingMaxRetryTimeout},F={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},I.load(G,N,F)}},{key:"loadsuccess",value:function(u,o,s){var n=u.data,l=s.frag;l.loader=void 0,this.loaders[l.type]=void 0,this.hls.trigger(C["default"].FRAG_LOADED,{payload:n,frag:l,stats:o})}},{key:"loaderror",value:function(n,i){var l=i.loader;l&&l.abort(),this.loaders[i.type]=void 0,this.hls.trigger(C["default"].ERROR,{type:z.ErrorTypes.NETWORK_ERROR,details:z.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:i.frag,response:n})}},{key:"loadtimeout",value:function(n,i){var l=i.loader;l&&l.abort(),this.loaders[i.type]=void 0,this.hls.trigger(C["default"].ERROR,{type:z.ErrorTypes.NETWORK_ERROR,details:z.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:i.frag})}},{key:"loadprogress",value:function(s,n,o){var l=n.frag;l.loaded=s.loaded,this.hls.trigger(C["default"].FRAG_LOAD_PROGRESS,{frag:l,stats:s})}}]),f}(w["default"]);g["default"]=B},{30:30,31:31,32:32,51:51}],39:[function(x,D,g){function p(f){return f&&f.__esModule?f:{"default":f}}function A(h,f){if(!(h instanceof f)){throw new TypeError("Cannot call a class as a function")}}function k(h,f){if(!h){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return !f||"object"!=typeof f&&"function"!=typeof f?h:f}function E(h,f){if("function"!=typeof f&&null!==f){throw new TypeError("Super expression must either be null or a function, not "+typeof f)}h.prototype=Object.create(f&&f.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(h,f):h.__proto__=f)}Object.defineProperty(g,"__esModule",{value:!0});var j=function(){function f(o,l){for(var n=0;n<l.length;n++){var h=l[n];h.enumerable=h.enumerable||!1,h.configurable=!0,"value" in h&&(h.writable=!0),Object.defineProperty(o,h.key,h)}}return function(h,l,e){return l&&f(h.prototype,l),e&&f(h,e),h}}(),m=x(32),C=p(m),y=x(31),w=p(y),z=x(30),q=x(51),B=function(h){function f(l){A(this,f);var i=k(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,l,C["default"].KEY_LOADING));return i.loaders={},i.decryptkey=null,i.decrypturl=null,i}return E(f,h),j(f,[{key:"destroy",value:function(){for(var l in this.loaders){var i=this.loaders[l];i&&i.destroy()}this.loaders={},w["default"].prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(I){var L=I.frag,u=L.type,H=this.loaders[u],K=L.decryptdata,F=K.uri;if(F!==this.decrypturl||null===this.decryptkey){var M=this.hls.config;H&&(q.logger.warn("abort previous key loader for type:"+u),H.abort()),L.loader=this.loaders[u]=new M.loader(M),this.decrypturl=F,this.decryptkey=null;var v=void 0,G=void 0,J=void 0;v={url:F,frag:L,responseType:"arraybuffer"},G={timeout:M.fragLoadingTimeOut,maxRetry:M.fragLoadingMaxRetry,retryDelay:M.fragLoadingRetryDelay,maxRetryDelay:M.fragLoadingMaxRetryTimeout},J={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},L.loader.load(v,G,J)}else{this.decryptkey&&(K.key=this.decryptkey,this.hls.trigger(C["default"].KEY_LOADED,{frag:L}))}}},{key:"loadsuccess",value:function(s,n,o){var l=o.frag;this.decryptkey=l.decryptdata.key=new Uint8Array(s.data),l.loader=void 0,this.loaders[l.type]=void 0,this.hls.trigger(C["default"].KEY_LOADED,{frag:l})}},{key:"loaderror",value:function(s,n){var o=n.frag,l=o.loader;l&&l.abort(),this.loaders[n.type]=void 0,this.hls.trigger(C["default"].ERROR,{type:z.ErrorTypes.NETWORK_ERROR,details:z.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:o,response:s})}},{key:"loadtimeout",value:function(s,n){var o=n.frag,l=o.loader;l&&l.abort(),this.loaders[n.type]=void 0,this.hls.trigger(C["default"].ERROR,{type:z.ErrorTypes.NETWORK_ERROR,details:z.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:o})}}]),f}(w["default"]);g["default"]=B},{30:30,31:31,32:32,51:51}],40:[function(P,B,D){function L(f){return f&&f.__esModule?f:{"default":f}}function V(g,f){if(!g){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return !f||"object"!=typeof f&&"function"!=typeof f?g:f}function H(g,f){if("function"!=typeof f&&null!==f){throw new TypeError("Super expression must either be null or a function, not "+typeof f)}g.prototype=Object.create(f&&f.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),f&&(Object.setPrototypeOf?Object.setPrototypeOf(g,f):g.__proto__=f)}function C(g,f){if(!(g instanceof f)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(D,"__esModule",{value:!0});var G=function(){function f(l,h){for(var k=0;k<h.length;k++){var g=h[k];g.enumerable=g.enumerable||!1,g.configurable=!0,"value" in g&&(g.writable=!0),Object.defineProperty(l,g.key,g)}}return function(g,h,e){return h&&f(g.prototype,h),e&&f(g,e),g}}(),J=P(2),z=L(J),Q=P(32),O=L(Q),S=P(31),M=L(S),x=P(30),N=P(44),F=L(N),w=P(51),I=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,j=/#EXT-X-MEDIA:(.*)/g,A=/#EXTINF:(\d*(?:\.\d+)?)(?:,(.*))?|(?!#)(\S.+)|#EXT-X-BYTERANGE: *(.+)|#EXT-X-PROGRAM-DATE-TIME:(.+)|#.*/g,K=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,U=function(){function f(){C(this,f),this.method=null,this.key=null,this.iv=null,this._uri=null}return G(f,[{key:"uri",get:function(){return !this._uri&&this.reluri&&(this._uri=z["default"].buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),f}(),W=function(){function f(){C(this,f),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return G(f,[{key:"createInitializationVector",value:function(i){for(var g=new Uint8Array(16),h=12;h<16;h++){g[h]=i>>8*(15-h)&255}return g}},{key:"fragmentDecryptdataFromLevelkey",value:function(i,g){var h=i;return i&&i.method&&i.uri&&!i.iv&&(h=new U,h.method=i.method,h.baseuri=i.baseuri,h.reluri=i.reluri,h.iv=this.createInitializationVector(g)),h}},{key:"cloneObj",value:function(g){return JSON.parse(JSON.stringify(g))}},{key:"url",get:function(){return !this._url&&this.relurl&&(this._url=z["default"].buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(g){this._url=g}},{key:"programDateTime",get:function(){return !this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange){var i=this._byteRange=[];if(this.rawByteRange){var g=this.rawByteRange.split("@",2);if(1===g.length){var h=this.lastByteRangeEndOffset;i[0]=h?h:0}else{i[0]=parseInt(g[1])}i[1]=parseInt(g[0])+i[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),f}(),q=function(g){function f(i){C(this,f);var h=V(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,i,O["default"].MANIFEST_LOADING,O["default"].LEVEL_LOADING,O["default"].AUDIO_TRACK_LOADING,O["default"].SUBTITLE_TRACK_LOADING));return h.loaders={},h}return H(f,g),G(f,[{key:"destroy",value:function(){for(var i in this.loaders){var h=this.loaders[i];h&&h.destroy()}this.loaders={},M["default"].prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(h){this.load(h.url,{type:"manifest"})}},{key:"onLevelLoading",value:function(h){this.load(h.url,{type:"level",level:h.level,id:h.id})}},{key:"onAudioTrackLoading",value:function(h){this.load(h.url,{type:"audioTrack",id:h.id})}},{key:"onSubtitleTrackLoading",value:function(h){this.load(h.url,{type:"subtitleTrack",id:h.id})}},{key:"load",value:function(y,X){var h=this.loaders[X.type];if(h){var v=h.context;if(v&&v.url===y){return void w.logger.trace("playlist request ongoing")}w.logger.warn("abort previous loader for type:"+X.type),h.abort()}var R=this.hls.config,m=void 0,Y=void 0,k=void 0,p=void 0;"manifest"===X.type?(m=R.manifestLoadingMaxRetry,Y=R.manifestLoadingTimeOut,k=R.manifestLoadingRetryDelay,p=R.manifestLoadingMaxRetryTimeout):(m=R.levelLoadingMaxRetry,Y=R.levelLoadingTimeOut,k=R.levelLoadingRetryDelay,p=R.levelLoadingMaxRetryTimeout,w.logger.log("loading playlist for "+X.type+" "+(X.level||X.id))),h=this.loaders[X.type]=X.loader="undefined"!=typeof R.pLoader?new R.pLoader(R):new R.loader(R),X.url=y,X.responseType="";var T=void 0,E=void 0;T={timeout:Y,maxRetry:m,retryDelay:k,maxRetryDelay:p},E={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},h.load(X,T,E)}},{key:"resolve",value:function(i,h){return z["default"].buildAbsoluteURL(h,i,{alwaysNormalize:!0})}},{key:"parseMasterPlaylist",value:function(y,T){var h=[],v=void 0;for(I.lastIndex=0;null!=(v=I.exec(y));){var E={},m=E.attrs=new F["default"](v[1]);E.url=this.resolve(v[2],T);var X=m.decimalResolution("RESOLUTION");X&&(E.width=X.width,E.height=X.height),E.bitrate=m.decimalInteger("AVERAGE-BANDWIDTH")||m.decimalInteger("BANDWIDTH"),E.name=m.NAME;var k=m.CODECS;if(k){k=k.split(/[ ,]+/);for(var p=0;p<k.length;p++){var R=k[p];R.indexOf("avc1")!==-1?E.videoCodec=this.avc1toavcoti(R):E.audioCodec=R}}h.push(E)}return h}},{key:"parseMasterPlaylistMedia",value:function(u,l,p){var k=void 0,h=[],y=0;for(j.lastIndex=0;null!=(k=j.exec(u));){var m={},v=new F["default"](k[1]);v.TYPE===p&&(m.groupId=v["GROUP-ID"],m.instreamId=v["INSTREAM-ID"],m.name=v.NAME,m.type=p,m["default"]="YES"===v.DEFAULT,m.autoselect="YES"===v.AUTOSELECT,m.forced="YES"===v.FORCED,v.URI&&(m.url=this.resolve(v.URI,l)),m.lang=v.LANGUAGE,m.name||(m.name=m.lang),m.id=y++,h.push(m))}return h}},{key:"avc1toavcoti",value:function(k){var h,i=k.split(".");return i.length>2?(h=i.shift()+".",h+=parseInt(i.shift()).toString(16),h+=("000"+parseInt(i.shift()).toString(16)).substr(-4)):h=k,h}},{key:"parseLevelPlaylist",value:function(ar,ad,ah,an){var av,ak,af=0,aj=0,am={type:null,version:null,url:ad,fragments:[],live:!0,startSN:0},ac=new U,at=0,aq=null,au=new W;for(A.lastIndex=0;null!==(av=A.exec(ar));){var ao=av[1];if(ao){au.duration=parseFloat(ao);var ab=(" "+av[2]).slice(1);au.title=ab?ab:null,au.tagList.push(ab?["INF",ao,ab]:["INF",ao])}else{if(av[3]){if(!isNaN(au.duration)){var ap=af++;au.type=an,au.start=aj,au.levelkey=ac,au.sn=ap,au.level=ah,au.cc=at,au.baseurl=ad,au.relurl=(" "+av[3]).slice(1),am.fragments.push(au),aq=au,aj+=au.duration,au=new W}}else{if(av[4]){if(au.rawByteRange=(" "+av[4]).slice(1),aq){var al=aq.byteRangeEndOffset;al&&(au.lastByteRangeEndOffset=al)}}else{if(av[5]){au.rawProgramDateTime=(" "+av[5]).slice(1),au.tagList.push(["PROGRAM-DATE-TIME",au.rawProgramDateTime])}else{for(av=av[0].match(K),ak=1;ak<av.length&&void 0===av[ak];ak++){}var k=(" "+av[ak+1]).slice(1),y=(" "+av[ak+2]).slice(1);switch(av[ak]){case"#":au.tagList.push(y?[k,y]:[k]);break;case"PLAYLIST-TYPE":am.type=k.toUpperCase();break;case"MEDIA-SEQUENCE":af=am.startSN=parseInt(k);break;case"TARGETDURATION":am.targetduration=parseFloat(k);break;case"VERSION":am.version=parseInt(k);break;case"EXTM3U":break;case"ENDLIST":am.live=!1;break;case"DIS":at++,au.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":at=parseInt(k);break;case"KEY":var ai=k,p=new F["default"](ai),Y=p.enumeratedString("METHOD"),aa=p.URI,ae=p.hexadecimalInteger("IV");Y&&(ac=new U,aa&&["AES-128","SAMPLE-AES"].indexOf(Y)>=0&&(ac.method=Y,ac.baseuri=ad,ac.reluri=aa,ac.key=null,ac.iv=ae));break;case"START":var X=k,Z=new F["default"](X),ag=Z.decimalFloatingPoint("TIME-OFFSET");isNaN(ag)||(am.startTimeOffset=ag);break;case"MAP":var E=new F["default"](k);au.relurl=E.URI,au.rawByteRange=E.BYTERANGE,au.baseurl=ad,au.level=ah,au.type=an,au.sn="initSegment",am.initSegment=au,au=new W;break;default:w.logger.warn("line parsed but not handled: "+av)}}}}}}return au=aq,au&&!au.relurl&&(am.fragments.pop(),aj-=au.duration),am.totalduration=aj,am.averagetargetduration=aj/am.fragments.length,am.endSN=af-1,am.startCC=am.fragments[0]?am.fragments[0].cc:0,am.endCC=at,am}},{key:"loadsuccess",value:function(ac,ah,k){var Z=ac.data,af=ac.url,E=k.type,ai=k.id,y=k.level,X=this.hls;if(this.loaders[E]=void 0,void 0!==af&&0!==af.indexOf("data:")||(af=k.url),ah.tload=performance.now(),0===Z.indexOf("#EXTM3U")){if(Z.indexOf("#EXTINF:")>0){var ag="audioTrack"!==E&&"subtitleTrack"!==E,ad=isNaN(y)?isNaN(ai)?0:ai:y,ae=this.parseLevelPlaylist(Z,af,ad,"audioTrack"===E?"audio":"subtitleTrack"===E?"subtitle":"main");ae.tload=ah.tload,"manifest"===E&&X.trigger(O["default"].MANIFEST_LOADED,{levels:[{url:af,details:ae}],audioTracks:[],url:af,stats:ah}),ah.tparsed=performance.now(),ae.targetduration?ag?X.trigger(O["default"].LEVEL_LOADED,{details:ae,level:y||0,id:ai||0,stats:ah}):"audioTrack"===E?X.trigger(O["default"].AUDIO_TRACK_LOADED,{details:ae,id:ai,stats:ah}):"subtitleTrack"===E&&X.trigger(O["default"].SUBTITLE_TRACK_LOADED,{details:ae,id:ai,stats:ah}):X.trigger(O["default"].ERROR,{type:x.ErrorTypes.NETWORK_ERROR,details:x.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:af,reason:"invalid targetduration"})}else{var aa=this.parseMasterPlaylist(Z,af);if(aa.length){var ab=this.parseMasterPlaylistMedia(Z,af,"AUDIO"),v=this.parseMasterPlaylistMedia(Z,af,"SUBTITLES"),R=this.parseMasterPlaylistMedia(Z,af,"CLOSED-CAPTIONS");if(ab.length){var Y=!1;ab.forEach(function(h){h.url||(Y=!0)}),Y===!1&&aa[0].audioCodec&&!aa[0].attrs.AUDIO&&(w.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),ab.unshift({type:"main",name:"main"}))}X.trigger(O["default"].MANIFEST_LOADED,{levels:aa,audioTracks:ab,subtitles:v,captions:R,url:af,stats:ah})}else{"manifest"===E?X.trigger(O["default"].ERROR,{type:x.ErrorTypes.NETWORK_ERROR,details:x.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:af,reason:"no level found in manifest"}):X.trigger(O["default"].ERROR,{type:x.ErrorTypes.NETWORK_ERROR,details:x.ErrorDetails.MANIFEST_EMPTY_ERROR,fatal:!1,url:af,reason:"no level found in manifest",context:k})}}}else{X.trigger(O["default"].ERROR,{type:x.ErrorTypes.NETWORK_ERROR,details:x.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:af,reason:"no EXTM3U delimiter"})}}},{key:"loaderror",value:function(n,l){var m,k,h=l.loader;switch(l.type){case"manifest":m=x.ErrorDetails.MANIFEST_LOAD_ERROR,k=!0;break;case"level":m=x.ErrorDetails.LEVEL_LOAD_ERROR,k=!1;break;case"audioTrack":m=x.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,k=!1}h&&(h.abort(),this.loaders[l.type]=void 0),this.hls.trigger(O["default"].ERROR,{type:x.ErrorTypes.NETWORK_ERROR,details:m,fatal:k,url:l.url,loader:h,response:n,context:l})}},{key:"loadtimeout",value:function(n,l){var m,k,h=l.loader;switch(l.type){case"manifest":m=x.ErrorDetails.MANIFEST_LOAD_TIMEOUT,k=!0;break;case"level":m=x.ErrorDetails.LEVEL_LOAD_TIMEOUT,k=!1;break;case"audioTrack":m=x.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT,k=!1}h&&(h.abort(),this.loaders[l.type]=void 0),this.hls.trigger(O["default"].ERROR,{type:x.ErrorTypes.NETWORK_ERROR,details:m,fatal:k,url:l.url,loader:h,context:l})}}]),f}(M["default"]);D["default"]=q},{2:2,30:30,31:31,32:32,44:44,51:51}],41:[function(l,h,k){function g(n,i){if(!(n instanceof i)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(k,"__esModule",{value:!0});var f=function(){function i(q,o){for(var p=0;p<o.length;p++){var n=o[p];n.enumerable=n.enumerable||!1,n.configurable=!0,"value" in n&&(n.writable=!0),Object.defineProperty(q,n.key,n)}}return function(n,o,e){return o&&i(n.prototype,o),e&&i(n,e),n}}(),m=Math.pow(2,32)-1,j=function(){function i(){g(this,i)}return f(i,null,[{key:"init",value:function(){i.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var u;for(u in i.types){i.types.hasOwnProperty(u)&&(i.types[u]=[u.charCodeAt(0),u.charCodeAt(1),u.charCodeAt(2),u.charCodeAt(3)])}var w=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),q=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);i.HDLR_TYPES={video:w,audio:q};var p=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),y=new Uint8Array([0,0,0,0,0,0,0,0]);i.STTS=i.STSC=i.STCO=y,i.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),i.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),i.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),i.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var v=new Uint8Array([105,115,111,109]),x=new Uint8Array([97,118,99,49]),e=new Uint8Array([0,0,0,1]);i.FTYP=i.box(i.types.ftyp,v,e,v,x),i.DINF=i.box(i.types.dinf,i.box(i.types.dref,p))}},{key:"box",value:function(u){for(var q,s=Array.prototype.slice.call(arguments,1),p=8,o=s.length,v=o;o--;){p+=s[o].byteLength}for(q=new Uint8Array(p),q[0]=p>>24&255,q[1]=p>>16&255,q[2]=p>>8&255,q[3]=255&p,q.set(u,4),o=0,p=8;o<v;o++){q.set(s[o],p),p+=s[o].byteLength}return q}},{key:"hdlr",value:function(e){return i.box(i.types.hdlr,i.HDLR_TYPES[e])}},{key:"mdat",value:function(e){return i.box(i.types.mdat,e)}},{key:"mdhd",value:function(o,p){p*=o;var n=Math.floor(p/(m+1)),e=Math.floor(p%(m+1));return i.box(i.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,o>>24&255,o>>16&255,o>>8&255,255&o,n>>24,n>>16&255,n>>8&255,255&n,e>>24,e>>16&255,e>>8&255,255&e,85,196,0,0]))}},{key:"mdia",value:function(e){return i.box(i.types.mdia,i.mdhd(e.timescale,e.duration),i.hdlr(e.type),i.minf(e))}},{key:"mfhd",value:function(e){return i.box(i.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}},{key:"minf",value:function(e){return"audio"===e.type?i.box(i.types.minf,i.box(i.types.smhd,i.SMHD),i.DINF,i.stbl(e)):i.box(i.types.minf,i.box(i.types.vmhd,i.VMHD),i.DINF,i.stbl(e))}},{key:"moof",value:function(n,o,e){return i.box(i.types.moof,i.mfhd(n),i.traf(e,o))}},{key:"moov",value:function(n){for(var o=n.length,e=[];o--;){e[o]=i.trak(n[o])}return i.box.apply(null,[i.types.moov,i.mvhd(n[0].timescale,n[0].duration)].concat(e).concat(i.mvex(n)))}},{key:"mvex",value:function(n){for(var o=n.length,e=[];o--;){e[o]=i.trex(n[o])}return i.box.apply(null,[i.types.mvex].concat(e))}},{key:"mvhd",value:function(o,q){q*=o;var n=Math.floor(q/(m+1)),e=Math.floor(q%(m+1)),p=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,o>>24&255,o>>16&255,o>>8&255,255&o,n>>24,n>>16&255,n>>8&255,255&n,e>>24,e>>16&255,e>>8&255,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return i.box(i.types.mvhd,p)}},{key:"sdtp",value:function(p){var q,o,e=p.samples||[],s=new Uint8Array(4+e.length);for(o=0;o<e.length;o++){q=e[o].flags,s[o+4]=q.dependsOn<<4|q.isDependedOn<<2|q.hasRedundancy}return i.box(i.types.sdtp,s)}},{key:"stbl",value:function(e){return i.box(i.types.stbl,i.stsd(e),i.box(i.types.stts,i.STTS),i.box(i.types.stsc,i.STSC),i.box(i.types.stsz,i.STSZ),i.box(i.types.stco,i.STCO))}},{key:"avc1",value:function(B){var e,w,z,q=[],C=[];for(e=0;e<B.sps.length;e++){w=B.sps[e],z=w.byteLength,q.push(z>>>8&255),q.push(255&z),q=q.concat(Array.prototype.slice.call(w))}for(e=0;e<B.pps.length;e++){w=B.pps[e],z=w.byteLength,C.push(z>>>8&255),C.push(255&z),C=C.concat(Array.prototype.slice.call(w))}var p=i.box(i.types.avcC,new Uint8Array([1,q[3],q[4],q[5],255,224|B.sps.length].concat(q).concat([B.pps.length]).concat(C))),v=B.width,A=B.height,y=B.pixelRatio[0],x=B.pixelRatio[1];return i.box(i.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,v>>8&255,255&v,A>>8&255,255&A,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),p,i.box(i.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),i.box(i.types.pasp,new Uint8Array([y>>24,y>>16&255,y>>8&255,255&y,x>>24,x>>16&255,x>>8&255,255&x])))}},{key:"esds",value:function(o){var n=o.config.length;return new Uint8Array([0,0,0,0,3,23+n,0,1,0,4,15+n,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([n]).concat(o.config).concat([6,1,2]))}},{key:"mp4a",value:function(e){var n=e.samplerate;return i.box(i.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),i.box(i.types.esds,i.esds(e)))}},{key:"mp3",value:function(e){var n=e.samplerate;return i.box(i.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]))}},{key:"stsd",value:function(e){return"audio"===e.type?e.isAAC||"mp3"!==e.codec?i.box(i.types.stsd,i.STSD,i.mp4a(e)):i.box(i.types.stsd,i.STSD,i.mp3(e)):i.box(i.types.stsd,i.STSD,i.avc1(e))}},{key:"tkhd",value:function(q){var v=q.id,p=q.duration*q.timescale,n=q.width,u=q.height,w=Math.floor(p/(m+1)),e=Math.floor(p%(m+1));return i.box(i.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,v>>24&255,v>>16&255,v>>8&255,255&v,0,0,0,0,w>>24,w>>16&255,w>>8&255,255&w,e>>24,e>>16&255,e>>8&255,255&e,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,u>>8&255,255&u,0,0]))}},{key:"traf",value:function(p,u){var n=i.sdtp(p),e=p.id,q=Math.floor(u/(m+1)),v=Math.floor(u%(m+1));return i.box(i.types.traf,i.box(i.types.tfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e])),i.box(i.types.tfdt,new Uint8Array([1,0,0,0,q>>24,q>>16&255,q>>8&255,255&q,v>>24,v>>16&255,v>>8&255,255&v])),i.trun(p,n.length+16+20+8+16+8+8),n)}},{key:"trak",value:function(e){return e.duration=e.duration||4294967295,i.box(i.types.trak,i.tkhd(e),i.mdia(e))}},{key:"trex",value:function(e){var n=e.id;return i.box(i.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(C,e){var w,A,q,D,p,v,B=C.samples||[],y=B.length,x=12+16*y,z=new Uint8Array(x);for(e+=8+x,z.set([0,0,15,1,y>>>24&255,y>>>16&255,y>>>8&255,255&y,e>>>24&255,e>>>16&255,e>>>8&255,255&e],0),w=0;w<y;w++){A=B[w],q=A.duration,D=A.size,p=A.flags,v=A.cts,z.set([q>>>24&255,q>>>16&255,q>>>8&255,255&q,D>>>24&255,D>>>16&255,D>>>8&255,255&D,p.isLeading<<2|p.dependsOn,p.isDependedOn<<6|p.hasRedundancy<<4|p.paddingValue<<1|p.isNonSync,61440&p.degradPrio,15&p.degradPrio,v>>>24&255,v>>>16&255,v>>>8&255,255&v],12+16*w)}return i.box(i.types.trun,z)}},{key:"initSegment",value:function(n){i.types||i.init();var o,e=i.moov(n);return o=new Uint8Array(i.FTYP.byteLength+e.byteLength),o.set(i.FTYP),o.set(e,i.FTYP.byteLength),o}}]),i}();k["default"]=j},{}],42:[function(z,F,j){function q(f){return f&&f.__esModule?f:{"default":f}}function C(g,f){if(!(g instanceof f)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(j,"__esModule",{value:!0});var m=function(){function f(n,h){for(var l=0;l<h.length;l++){var g=h[l];g.enumerable=g.enumerable||!1,g.configurable=!0,"value" in g&&(g.writable=!0),Object.defineProperty(n,g.key,g)}}return function(g,h,e){return h&&f(g.prototype,h),e&&f(g,e),g}}(),G=z(33),k=q(G),p=z(32),E=q(p),A=z(51),y=z(41),B=q(y),w=z(30),D=10000,x=function(){function f(g,l,e,o){C(this,f),this.observer=g,this.config=l,this.typeSupported=e;var h=navigator.userAgent;this.isSafari=o&&o.indexOf("Apple")>-1&&h&&!h.match("CriOS"),this.ISGenerated=!1}return m(f,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(g){this._initPTS=this._initDTS=g}},{key:"resetInitSegment",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(I,L,g,H,K,u,M){if(this.ISGenerated||this.generateIS(I,L,K),this.ISGenerated){if(I.samples.length){var h=this.remuxAudio(I,K,u,M);if(L.samples.length){var v=void 0;h&&(v=h.endPTS-h.startPTS),this.remuxVideo(L,K,u,v)}}else{var J=void 0;L.samples.length&&(J=this.remuxVideo(L,K,u)),J&&I.codec&&this.remuxEmptyAudio(I,K,u,J)}}g.samples.length&&this.remuxID3(g,K),H.samples.length&&this.remuxText(H,K),this.observer.trigger(E["default"].FRAG_PARSED)}},{key:"generateIS",value:function(N,R,h){var K,P,I=this.observer,S=N.samples,H=R.samples,J=this.typeSupported,M="audio/mp4",Q={},L={tracks:Q},u=void 0===this._initPTS;if(u&&(K=P=1/0),N.config&&S.length&&(N.timescale=N.samplerate,A.logger.log("audio sampling rate : "+N.samplerate),N.isAAC||(J.mpeg?(M="audio/mpeg",N.codec=""):J.mp3&&(N.codec="mp3")),Q.audio={container:M,codec:N.codec,initSegment:!N.isAAC&&J.mpeg?new Uint8Array:B["default"].initSegment([N]),metadata:{channelCount:N.channelCount}},u&&(K=P=S[0].pts-N.inputTimeScale*h)),R.sps&&R.pps&&H.length){var O=R.inputTimeScale;R.timescale=O,Q.video={container:"video/mp4",codec:R.codec,initSegment:B["default"].initSegment([R]),metadata:{width:R.width,height:R.height}},u&&(K=Math.min(K,H[0].pts-O*h),P=Math.min(P,H[0].dts-O*h),this.observer.trigger(E["default"].INIT_PTS_FOUND,{initPTS:K}))}Object.keys(Q).length?(I.trigger(E["default"].FRAG_PARSING_INIT_SEGMENT,L),this.ISGenerated=!0,u&&(this._initPTS=K,this._initDTS=P)):I.trigger(E["default"].ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(aY,aK,aM,aV){var a1,aQ,aL,aP,aS,aX,aJ,aW,aO=8,aF=aY.timescale,aR=aY.samples,ag=[],aw=aR.length,aT=this._PTSNormalize,aZ=this._initDTS;aR.sort(function(o,l){var n=o.dts-l.dts,g=o.pts-l.pts;return n?n:g?g:o.id-l.id});var a2=aR.reduce(function(i,g){return Math.max(Math.min(i,g.pts-g.dts),-18000)},0);if(a2<0){A.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(a2/90)+" ms to overcome this issue");for(var ai=0;ai<aR.length;ai++){aR[ai].dts+=a2}}var aB=void 0;aB=aM?this.nextAvcDts:aK*aF;var ah=aR[0];aS=Math.max(aT(ah.dts-aZ,aB),0),aP=Math.max(aT(ah.pts-aZ,aB),0);var ao=Math.round((aS-aB)/90);aM&&ao&&(ao>1?A.logger.log("AVC:"+ao+" ms hole between fragments detected,filling it"):ao<-1&&A.logger.log("AVC:"+-ao+" ms overlapping between fragments detected"),aS=aB,aR[0].dts=aS+aZ,aP=Math.max(aP-ao,aB),aR[0].pts=aP+aZ,A.logger.log("Video/PTS/DTS adjusted: "+Math.round(aP/90)+"/"+Math.round(aS/90)+",delta:"+ao+" ms")),aX=aS,ah=aR[aR.length-1],aW=Math.max(aT(ah.dts-aZ,aB),0),aJ=Math.max(aT(ah.pts-aZ,aB),0),aJ=Math.max(aJ,aW);var aI=this.isSafari;aI&&(a1=Math.round((aW-aS)/(aR.length-1)));for(var ay=0,al=0,ar=0;ar<aw;ar++){for(var az=aR[ar],ak=az.units,aH=ak.length,an=0,am=0;am<aH;am++){an+=ak[am].data.length}al+=an,ay+=aH,az.length=an,aI?az.dts=aS+ar*a1:az.dts=Math.max(aT(az.dts-aZ,aB),aS),az.pts=Math.max(aT(az.pts-aZ,aB),az.dts)}var av=al+4*ay+8;try{aQ=new Uint8Array(av)}catch(af){return void this.observer.trigger(E["default"].ERROR,{type:w.ErrorTypes.MUX_ERROR,details:w.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:av,reason:"fail allocating video mdat "+av})}var aA=new DataView(aQ.buffer);aA.setUint32(0,av),aQ.set(B["default"].types.mdat,4);for(var au=0;au<aw;au++){for(var aU=aR[au],ad=aU.units,at=0,ac=void 0,ap=0,u=ad.length;ap<u;ap++){var aN=ad[ap],aa=aN.data,aE=aN.data.byteLength;aA.setUint32(aO,aE),aO+=4,aQ.set(aa,aO),aO+=aE,at+=4+aE}if(aI){ac=Math.max(0,a1*Math.round((aU.pts-aU.dts)/a1))}else{if(au<aw-1){a1=aR[au+1].dts-aU.dts}else{var aq=this.config,aj=aU.dts-aR[au>0?au-1:au].dts;if(aq.stretchShortVideoTrack){var h=aq.maxBufferHole,aC=aq.maxSeekHole,a0=Math.floor(Math.min(h,aC)*aF),ab=(aV?aP+aV*aF:this.nextAudioPts)-aU.pts;ab>a0?(a1=ab-aj,a1<0&&(a1=aj),A.logger.log("It is approximately "+ab/90+" ms to the next segment; using duration "+a1/90+" ms for the last video frame.")):a1=aj}else{a1=aj}}ac=Math.round(aU.pts-aU.dts)}ag.push({size:at,duration:a1,cts:ac,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:aU.key?2:1,isNonSync:aU.key?0:1}})}this.nextAvcDts=aW+a1;var aG=aY.dropped;if(aY.len=0,aY.nbNalu=0,aY.dropped=0,ag.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var aD=ag[0].flags;aD.dependsOn=2,aD.isNonSync=0}aY.samples=ag,aL=B["default"].moof(aY.sequenceNumber++,aS,aY),aY.samples=[];var ax={data1:aL,data2:aQ,startPTS:aP/aF,endPTS:(aJ+a1)/aF,startDTS:aS/aF,endDTS:this.nextAvcDts/aF,type:"video",nb:ag.length,dropped:aG};return this.observer.trigger(E["default"].FRAG_PARSING_DATA,ax),ax}},{key:"remuxAudio",value:function(aQ,aD,aF,aN){var aT,aI,aE,aK,aP,aO,aH,aA,aJ,ad,at,aL,aR,aU,af,ax,ae=aQ.inputTimeScale,al=aQ.timescale,aC=ae/al,au=aQ.isAAC?1024:1152,ai=au*aC,ao=this._PTSNormalize,av=this._initDTS,ah=!aQ.isAAC&&this.typeSupported.mpeg,aB=ah?0:8,ak=[],aj=[];if(aQ.samples.sort(function(i,g){return i.pts-g.pts}),aj=aQ.samples,ax=this.nextAudioPts,aF|=aj.length&&ax&&(Math.abs(aD-ax/ae)<0.1||Math.abs(aj[0].pts-ax-av)<20*ai),aF||(ax=aD*ae),aN&&aQ.isAAC){for(var ar=0,ac=ax;ar<aj.length;){var aw=aj[ar],aq=ao(aw.pts-av,ax),aM=aq-ac,ab=Math.abs(1000*aM/ae);if(aM<=-ai){A.logger.warn("Dropping 1 audio frame @ "+(ac/ae).toFixed(3)+"s due to "+ab+" ms overlap."),aj.splice(ar,1),aQ.len-=aw.unit.length}else{if(aM>=ai&&ab<D&&ac){var ap=Math.round(aM/ai);A.logger.warn("Injecting "+ap+" audio frame @ "+(ac/ae).toFixed(3)+"s due to "+1000*aM/ae+" ms gap.");for(var aa=0;aa<ap;aa++){af=ac+av,af=Math.max(af,av),aU=k["default"].getSilentFrame(aQ.manifestCodec||aQ.codec,aQ.channelCount),aU||(A.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),aU=aw.unit.subarray()),aj.splice(ar,0,{unit:aU,pts:af,dts:af}),aQ.len+=aU.length,ac+=ai,ar+=1}aw.pts=aw.dts=ac+av,ac+=ai,ar+=1}else{Math.abs(aM)>0.1*ai,ac+=ai,0===ar?aw.pts=aw.dts=av+ax:aw.pts=aw.dts=aj[ar-1].pts+ai,ar+=1}}}}for(var am=0,o=aj.length;am<o;am++){if(aI=aj[am],aK=aI.unit,ad=aI.pts-av,at=aI.dts-av,void 0!==aJ){aL=ao(ad,aJ),aR=ao(at,aJ),aE.duration=Math.round((aR-aJ)/aC)}else{aL=ao(ad,ax),aR=ao(at,ax);var aG=Math.round(1000*(aL-ax)/ae),u=0;if(aF&&aQ.isAAC&&aG){if(aG>0&&aG<D){u=Math.round((aL-ax)/ai),A.logger.log(aG+" ms hole between AAC samples detected,filling it"),u>0&&(aU=k["default"].getSilentFrame(aQ.manifestCodec||aQ.codec,aQ.channelCount),aU||(aU=aK.subarray()),aQ.len+=u*aU.length)}else{if(aG<-12){A.logger.log(-aG+" ms overlapping between AAC samples detected, drop frame"),aQ.len-=aK.byteLength;continue}}aL=aR=ax}if(aH=Math.max(0,aL),aA=Math.max(0,aR),!(aQ.len>0)){return}var az=ah?aQ.len:aQ.len+8;try{aP=new Uint8Array(az)}catch(an){return void this.observer.trigger(E["default"].ERROR,{type:w.ErrorTypes.MUX_ERROR,details:w.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:az,reason:"fail allocating audio mdat "+az})}ah||(aT=new DataView(aP.buffer),aT.setUint32(0,az),aP.set(B["default"].types.mdat,4));for(var ag=0;ag<u;ag++){af=aL-(u-ag)*ai,aU=k["default"].getSilentFrame(aQ.manifestCodec||aQ.codec,aQ.channelCount),aU||(A.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),aU=aK.subarray()),aP.set(aU,aB),aB+=aU.byteLength,aE={size:aU.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},ak.push(aE)}}aP.set(aK,aB);var h=aK.byteLength;aB+=h,aE={size:h,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},ak.push(aE),aJ=aR}var ay=0,aS=ak.length;if(aS>=2&&(ay=ak[aS-2].duration,aE.duration=ay),aS){this.nextAudioPts=aL+aC*ay,aQ.len=0,aQ.samples=ak,aO=ah?new Uint8Array:B["default"].moof(aQ.sequenceNumber++,aA/aC,aQ),aQ.samples=[];var v={data1:aO,data2:aP,startPTS:aH/ae,endPTS:this.nextAudioPts/ae,startDTS:aA/ae,endDTS:(aR+aC*ay)/ae,type:"audio",nb:aS};return this.observer.trigger(E["default"].FRAG_PARSING_DATA,v),v}return null}},{key:"remuxEmptyAudio",value:function(P,V,o,L){var S=P.inputTimeScale,I=P.samplerate?P.samplerate:S,W=S/I,K=this.nextAudioPts,U=(void 0!==K?K:L.startDTS*S)+this._initDTS,O=L.endDTS*S+this._initDTS,Q=1024,M=W*Q,T=Math.ceil((O-U)/M),N=k["default"].getSilentFrame(P.manifestCodec||P.codec,P.channelCount);if(A.logger.warn("remux empty Audio"),!N){return void A.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")}for(var H=[],R=0;R<T;R++){var J=U+R*M;H.push({unit:N,pts:J,dts:J}),P.len+=N.length}P.samples=H,this.remuxAudio(P,V,o)}},{key:"remuxID3",value:function(H,l){var v,h=H.samples.length,g=H.inputTimeScale,J=this._initPTS,u=this._initDTS;if(h){for(var I=0;I<h;I++){v=H.samples[I],v.pts=(v.pts-J)/g,v.dts=(v.dts-u)/g}this.observer.trigger(E["default"].FRAG_PARSING_METADATA,{samples:H.samples})}H.samples=[],l=l}},{key:"remuxText",value:function(v,l){v.samples.sort(function(n,i){return n.pts-i.pts});var u,h=v.samples.length,g=v.inputTimeScale,H=this._initPTS;if(h){for(var o=0;o<h;o++){u=v.samples[o],u.pts=(u.pts-H)/g}this.observer.trigger(E["default"].FRAG_PARSING_USERDATA,{samples:v.samples})}v.samples=[],l=l}},{key:"_PTSNormalize",value:function(i,g){var h;if(void 0===g){return i}for(h=g<i?-8589934592:8589934592;Math.abs(i-g)>4294967296;){i+=h}return i}}]),f}();j["default"]=x},{30:30,32:32,33:33,41:41,51:51}],43:[function(m,q,f){function k(i){return i&&i.__esModule?i:{"default":i}}function p(l,i){if(!(l instanceof i)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(f,"__esModule",{value:!0});var h=function(){function i(s,n){for(var o=0;o<n.length;o++){var l=n[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value" in l&&(l.writable=!0),Object.defineProperty(s,l.key,l)}}return function(l,n,e){return n&&i(l.prototype,n),e&&i(l,e),l}}(),u=m(32),g=k(u),j=function(){function i(e){p(this,i),this.observer=e}return h(i,[{key:"destroy",value:function(){}},{key:"resetTimeStamp",value:function(){}},{key:"resetInitSegment",value:function(){}},{key:"remux",value:function(y,C,o,x,A,v,D,w){var B=this.observer,z="";y&&(z+="audio"),C&&(z+="video"),B.trigger(g["default"].FRAG_PARSING_DATA,{data1:w,startPTS:A,startDTS:A,type:z,nb:1,dropped:0}),B.trigger(g["default"].FRAG_PARSED)}}]),i}();f["default"]=j},{32:32}],44:[function(l,h,k){function g(n,i){if(!(n instanceof i)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(k,"__esModule",{value:!0});var f=function(){function i(s,o){for(var q=0;q<o.length;q++){var n=o[q];n.enumerable=n.enumerable||!1,n.configurable=!0,"value" in n&&(n.writable=!0),Object.defineProperty(s,n.key,n)}}return function(n,o,e){return o&&i(n.prototype,o),e&&i(n,e),n}}(),p=/^(\d+)x(\d+)$/,j=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,m=function(){function i(e){g(this,i),"string"==typeof e&&(e=i.parseAttrList(e));for(var n in e){e.hasOwnProperty(n)&&(this[n]=e[n])}}return f(i,[{key:"decimalInteger",value:function(o){var n=parseInt(this[o],10);return n>Number.MAX_SAFE_INTEGER?1/0:n}},{key:"hexadecimalInteger",value:function(s){if(this[s]){var o=(this[s]||"0x").slice(2);o=(1&o.length?"0":"")+o;for(var q=new Uint8Array(o.length/2),n=0;n<o.length/2;n++){q[n]=parseInt(o.slice(2*n,2*n+2),16)}return q}return null}},{key:"hexadecimalIntegerAsNumber",value:function(o){var n=parseInt(this[o],16);return n>Number.MAX_SAFE_INTEGER?1/0:n}},{key:"decimalFloatingPoint",value:function(n){return parseFloat(this[n])}},{key:"enumeratedString",value:function(n){return this[n]}},{key:"decimalResolution",value:function(o){var n=p.exec(this[o]);if(null!==n){return{width:parseInt(n[1],10),height:parseInt(n[2],10)}}}}],[{key:"parseAttrList",value:function(u){var q,s={};for(j.lastIndex=0;null!==(q=j.exec(u));){var o=q[2],n='"';0===o.indexOf(n)&&o.lastIndexOf(n)===o.length-1&&(o=o.slice(1,-1)),s[q[1]]=o}return s}}]),i}();k["default"]=m},{}],45:[function(j,g,h){var f={search:function(q,m){for(var p=0,l=q.length-1,k=null,u=null;p<=l;){k=(p+l)/2|0,u=q[k];var o=m(u);if(o>0){p=k+1}else{if(!(o<0)){return u}l=k-1}}return null}};g.exports=f},{}],46:[function(O,A,C){function K(g,f){if(!(g instanceof f)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(C,"__esModule",{value:!0});var R=function(){function f(l,h){for(var k=0;k<h.length;k++){var g=h[k];g.enumerable=g.enumerable||!1,g.configurable=!0,"value" in g&&(g.writable=!0),Object.defineProperty(l,g.key,g)}}return function(g,h,e){return h&&f(g.prototype,h),e&&f(g,e),g}}(),G={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},B=function(g){var f=g;return G.hasOwnProperty(g)&&(f=G[g]),String.fromCharCode(f)},F=15,I=100,x={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},P={17:2,18:4,21:6,22:8,23:10,19:13,20:15},N={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Q={25:2,26:4,29:6,30:8,31:10,27:13,28:15},L=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],w={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(f){this.time=f},log:function(h,f){var g=this.verboseFilter[h];this.verboseLevel>=g&&console.log(this.time.toFixed(3)+" ["+h+"] "+f)}},M=function(h){for(var f=[],g=0;g<h.length;g++){f.push(h[g].toString(16))}return f},D=function(){function f(g,i,e,k,h){K(this,f),this.foreground=g||"white",this.underline=i||!1,this.italics=e||!1,this.background=k||"black",this.flash=h||!1}return R(f,[{key:"reset",value:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function(l){for(var h=["foreground","underline","italics","background","flash"],k=0;k<h.length;k++){var g=h[k];l.hasOwnProperty(g)&&(this[g]=l[g])}}},{key:"isDefault",value:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}},{key:"equals",value:function(g){return this.foreground===g.foreground&&this.underline===g.underline&&this.italics===g.italics&&this.background===g.background&&this.flash===g.flash}},{key:"copy",value:function(g){this.foreground=g.foreground,this.underline=g.underline,this.italics=g.italics,this.background=g.background,this.flash=g.flash}},{key:"toString",value:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),f}(),q=function(){function f(g,i,e,l,h,k){K(this,f),this.uchar=g||" ",this.penState=new D(i,e,l,h,k)}return R(f,[{key:"reset",value:function(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function(h,g){this.uchar=h,this.penState.copy(g)}},{key:"setPenState",value:function(g){this.penState.copy(g)}},{key:"equals",value:function(g){return this.uchar===g.uchar&&this.penState.equals(g.penState)}},{key:"copy",value:function(g){this.uchar=g.uchar,this.penState.copy(g.penState)}},{key:"isEmpty",value:function(){return" "===this.uchar&&this.penState.isDefault()}}]),f}(),H=function(){function f(){K(this,f),this.chars=[];for(var e=0;e<I;e++){this.chars.push(new q)}this.pos=0,this.currPenState=new D}return R(f,[{key:"equals",value:function(i){for(var g=!0,h=0;h<I;h++){if(!this.chars[h].equals(i.chars[h])){g=!1;break}}return g}},{key:"copy",value:function(h){for(var g=0;g<I;g++){this.chars[g].copy(h.chars[g])}}},{key:"isEmpty",value:function(){for(var h=!0,g=0;g<I;g++){if(!this.chars[g].isEmpty()){h=!1;break}}return h}},{key:"setCursor",value:function(g){this.pos!==g&&(this.pos=g),this.pos<0?(w.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>I&&(w.log("ERROR","Too large cursor position "+this.pos),this.pos=I)}},{key:"moveCursor",value:function(i){var g=this.pos+i;if(i>1){for(var h=this.pos+1;h<g+1;h++){this.chars[h].setPenState(this.currPenState)}}this.setCursor(g)}},{key:"backSpace",value:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function(h){h>=144&&this.backSpace();var g=B(h);return this.pos>=I?void w.log("WARNING","Cannot insert "+h.toString(16)+" ("+g+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(g,this.currPenState),void this.moveCursor(1))}},{key:"clearFromPos",value:function(h){var g;for(g=h;g<I;g++){this.chars[g].reset()}}},{key:"clear",value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function(){for(var l=[],h=!0,k=0;k<I;k++){var g=this.chars[k].uchar;" "!==g&&(h=!1),l.push(g)}return h?"":l.join("")}},{key:"setPenStyles",value:function(h){this.currPenState.setStyles(h);var g=this.chars[this.pos];g.setPenState(this.currPenState)}}]),f}(),j=function(){function f(){K(this,f),this.rows=[];for(var e=0;e<F;e++){this.rows.push(new H)}this.currRow=F-1,this.nrRollUpRows=null,this.reset()}return R(f,[{key:"reset",value:function(){for(var g=0;g<F;g++){this.rows[g].clear()}this.currRow=F-1}},{key:"equals",value:function(i){for(var g=!0,h=0;h<F;h++){if(!this.rows[h].equals(i.rows[h])){g=!1;break}}return g}},{key:"copy",value:function(h){for(var g=0;g<F;g++){this.rows[g].copy(h.rows[g])}}},{key:"isEmpty",value:function(){for(var h=!0,g=0;g<F;g++){if(!this.rows[g].isEmpty()){h=!1;break}}return h}},{key:"backSpace",value:function(){var g=this.rows[this.currRow];g.backSpace()}},{key:"clearToEndOfRow",value:function(){var g=this.rows[this.currRow];g.clearToEndOfRow()}},{key:"insertChar",value:function(h){var g=this.rows[this.currRow];g.insertChar(h)}},{key:"setPen",value:function(h){var g=this.rows[this.currRow];g.setPenStyles(h)}},{key:"moveCursor",value:function(h){var g=this.rows[this.currRow];g.moveCursor(h)}},{key:"setCursor",value:function(h){w.log("INFO","setCursor: "+h);var g=this.rows[this.currRow];g.setCursor(h)}},{key:"setPAC",value:function(p){w.log("INFO","pacData = "+JSON.stringify(p));var S=p.row-1;if(this.nrRollUpRows&&S<this.nrRollUpRows-1&&(S=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==S){for(var g=0;g<F;g++){this.rows[g].clear()}var m=this.currRow+1-this.nrRollUpRows,y=this.lastOutputScreen;if(y){var h=y.rows[m].cueStartTime;if(h&&h<w.time){for(var T=0;T<this.nrRollUpRows;T++){this.rows[S-this.nrRollUpRows+T+1].copy(y.rows[m+T])}}}}this.currRow=S;var k=this.rows[this.currRow];if(null!==p.indent){var E=p.indent,v=Math.max(E-1,0);k.setCursor(p.indent),p.color=k.chars[v].penState.foreground}var o={foreground:p.color,underline:p.underline,italics:p.italics,background:"black",flash:!1};this.setPen(o)}},{key:"setBkgData",value:function(g){w.log("INFO","bkgData = "+JSON.stringify(g)),this.backSpace(),this.setPen(g),this.insertChar(32)}},{key:"setRollUpRows",value:function(g){this.nrRollUpRows=g}},{key:"rollUp",value:function(){if(null===this.nrRollUpRows){return void w.log("DEBUG","roll_up but nrRollUpRows not set yet")}w.log("TEXT",this.getDisplayText());var h=this.currRow+1-this.nrRollUpRows,g=this.rows.splice(h,1)[0];g.clear(),this.rows.splice(this.currRow,0,g),w.log("INFO","Rolling up")}},{key:"getDisplayText",value:function(m){m=m||!1;for(var k=[],l="",h=-1,g=0;g<F;g++){var o=this.rows[g].getTextString();o&&(h=g+1,m?k.push("Row "+h+": '"+o+"'"):k.push(o.trim()))}return k.length>0&&(l=m?"["+k.join(" | ")+"]":k.join("\n")),l}},{key:"getTextAndFormat",value:function(){return this.rows}}]),f}(),z=function(){function f(e,g){K(this,f),this.chNr=e,this.outputFilter=g,this.mode=null,this.verbose=0,this.displayedMemory=new j,this.nonDisplayedMemory=new j,this.lastOutputScreen=new j,this.currRollUpRow=this.displayedMemory.rows[F-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return R(f,[{key:"reset",value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[F-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null}},{key:"getHandler",value:function(){return this.outputFilter}},{key:"setHandler",value:function(g){this.outputFilter=g}},{key:"setPAC",value:function(g){this.writeScreen.setPAC(g)}},{key:"setBkgData",value:function(g){this.writeScreen.setBkgData(g)}},{key:"setMode",value:function(g){g!==this.mode&&(this.mode=g,w.log("INFO","MODE="+g),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=g)}},{key:"insertChars",value:function(i){for(var g=0;g<i.length;g++){this.writeScreen.insertChar(i[g])}var h=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";w.log("INFO",h+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(w.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}},{key:"ccRCL",value:function(){w.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function(){w.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function(){}},{key:"ccAON",value:function(){}},{key:"ccDER",value:function(){w.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function(g){w.log("INFO","RU("+g+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(g)}},{key:"ccFON",value:function(){w.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function(){w.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function(){w.log("INFO","TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function(){w.log("INFO","RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function(){w.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()}},{key:"ccCR",value:function(){w.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()}},{key:"ccENM",value:function(){w.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function(){if(w.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var g=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=g,this.writeScreen=this.nonDisplayedMemory,w.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()}},{key:"ccTO",value:function(g){w.log("INFO","TO("+g+") - Tab Offset"),this.writeScreen.moveCursor(g)}},{key:"ccMIDROW",value:function(l){var h={flash:!1};if(h.underline=l%2===1,h.italics=l>=46,h.italics){h.foreground="white"}else{var k=Math.floor(l/2)-16,g=["white","green","blue","cyan","red","yellow","magenta"];h.foreground=g[k]}w.log("INFO","MIDROW: "+JSON.stringify(h)),this.writeScreen.setPen(h)}},{key:"outputDataUpdate",value:function(){var g=w.time;null!==g&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(g,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,g,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:g):this.cueStartTime=g,this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function(g){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,g,this.displayedMemory),this.cueStartTime=g))}}]),f}(),J=function(){function f(g,h,e){K(this,f),this.field=g||1,this.outputs=[h,e],this.channels=[new z(1,h),new z(2,e)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,"char":0,cmd:0,other:0}}return R(f,[{key:"getHandler",value:function(g){return this.channels[g].getHandler()}},{key:"setHandler",value:function(h,g){this.channels[h].setHandler(g)}},{key:"addData",value:function(p,k){var m,h,g,v=!1;this.lastTime=p,w.setTime(p);for(var l=0;l<k.length;l+=2){if(h=127&k[l],g=127&k[l+1],0!==h||0!==g){if(w.log("DATA","["+M([k[l],k[l+1]])+"] -> ("+M([h,g])+")"),m=this.parseCmd(h,g),m||(m=this.parseMidrow(h,g)),m||(m=this.parsePAC(h,g)),m||(m=this.parseBackgroundAttributes(h,g)),!m&&(v=this.parseChars(h,g))){if(this.currChNr&&this.currChNr>=0){var u=this.channels[this.currChNr-1];u.insertChars(v)}else{w.log("WARNING","No channel found yet. TEXT-MODE?")}}m?this.dataCounters.cmd+=2:v?this.dataCounters["char"]+=2:(this.dataCounters.other+=2,w.log("WARNING","Couldn't parse cleaned data "+M([h,g])+" orig: "+M([k[l],k[l+1]])))}else{this.dataCounters.padding+=2}}}},{key:"parseCmd",value:function(m,k){var l=null,h=(20===m||28===m)&&32<=k&&k<=47,g=(23===m||31===m)&&33<=k&&k<=35;if(!h&&!g){return !1}if(m===this.lastCmdA&&k===this.lastCmdB){return this.lastCmdA=null,this.lastCmdB=null,w.log("DEBUG","Repeated command ("+M([m,k])+") is dropped"),!0}l=20===m||23===m?1:2;var o=this.channels[l-1];return 20===m||28===m?32===k?o.ccRCL():33===k?o.ccBS():34===k?o.ccAOF():35===k?o.ccAON():36===k?o.ccDER():37===k?o.ccRU(2):38===k?o.ccRU(3):39===k?o.ccRU(4):40===k?o.ccFON():41===k?o.ccRDC():42===k?o.ccTR():43===k?o.ccRTD():44===k?o.ccEDM():45===k?o.ccCR():46===k?o.ccENM():47===k&&o.ccEOC():o.ccTO(k-32),this.lastCmdA=m,this.lastCmdB=k,this.currChNr=l,!0}},{key:"parseMidrow",value:function(l,h){var k=null;if((17===l||25===l)&&32<=h&&h<=47){if(k=17===l?1:2,k!==this.currChNr){return w.log("ERROR","Mismatch channel in midrow parsing"),!1}var g=this.channels[k-1];return g.ccMIDROW(h),w.log("DEBUG","MIDROW ("+M([l,h])+")"),!0}return !1}},{key:"parsePAC",value:function(p,k){var m=null,h=null,g=(17<=p&&p<=23||25<=p&&p<=31)&&64<=k&&k<=127,v=(16===p||24===p)&&64<=k&&k<=95;if(!g&&!v){return !1}if(p===this.lastCmdA&&k===this.lastCmdB){return this.lastCmdA=null,this.lastCmdB=null,!0}m=p<=23?1:2,h=64<=k&&k<=95?1===m?x[p]:N[p]:1===m?P[p]:Q[p];var l=this.interpretPAC(h,k),u=this.channels[m-1];return u.setPAC(l),this.lastCmdA=p,this.lastCmdB=k,this.currChNr=m,!0}},{key:"interpretPAC",value:function(l,h){var k=h,g={color:null,italics:!1,indent:null,underline:!1,row:l};return k=h>95?h-96:h-64,g.underline=1===(1&k),k<=13?g.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(k/2)]:k<=15?(g.italics=!0,g.color="white"):g.indent=4*Math.floor((k-16)/2),g}},{key:"parseChars",value:function(m,k){var l=null,h=null,g=null;if(m>=25?(l=2,g=m-8):(l=1,g=m),17<=g&&g<=19){var s=k;s=17===g?k+80:18===g?k+112:k+144,w.log("INFO","Special char '"+B(s)+"' in channel "+l),h=[s]}else{32<=m&&m<=127&&(h=0===k?[m]:[m,k])}if(h){var p=M(h);w.log("DEBUG","Char codes =  "+p.join(",")),this.lastCmdA=null,this.lastCmdB=null}return h}},{key:"parseBackgroundAttributes",value:function(p,k){var m,h,g,v,l=(16===p||24===p)&&32<=k&&k<=47,u=(23===p||31===p)&&45<=k&&k<=47;return !(!l&&!u)&&(m={},16===p||24===p?(h=Math.floor((k-32)/2),m.background=L[h],k%2===1&&(m.background=m.background+"_semi")):45===k?m.background="transparent":(m.foreground="black",47===k&&(m.underline=!0)),g=p<24?1:2,v=this.channels[g-1],v.setBkgData(m),this.lastCmdA=null,this.lastCmdB=null,!0)}},{key:"reset",value:function(){for(var g=0;g<this.channels.length;g++){this.channels[g]&&this.channels[g].reset()}this.lastCmdA=null,this.lastCmdB=null}},{key:"cueSplitAtTime",value:function(h){for(var g=0;g<this.channels.length;g++){this.channels[g]&&this.channels[g].cueSplitAtTime(h)}}}]),f}();C["default"]=J},{}],47:[function(l,h,k){function g(i){return i&&i.__esModule?i:{"default":i}}var f=l(54),p=l(53),j=g(p),m={createCues:function(z,D,q){for(var x,v,s,w,C,A=[],y=0;y<q.rows.length;y++){if(x=q.rows[y],s=!0,w=0,C="",!x.isEmpty()){for(var B=0;B<x.chars.length;B++){x.chars[B].uchar.match(/\s/)&&s?w++:(C+=x.chars[B].uchar,s=!1)}x.cueStartTime=z,z===D&&(D+=0.0001),v=new j["default"](z,D,(0,f.fixLineBreaks)(C.trim())),w>=16?w--:w++,navigator.userAgent.match(/Firefox\//)?v.line=y+1:v.line=y>7?y-2:y+1,v.align="left",v.position=Math.max(0,Math.min(100,100*(w/32))),A.push(v)}}return A}};h.exports=m},{53:53,54:54}],48:[function(q,z,g){function m(f){return f&&f.__esModule?f:{"default":f}}function x(s,n){for(var o=null,l=0;l<s.length;l+=1){var f=s[l];if(f&&f.cc===n){o=f;break}}return o}function j(i,f){return p["default"].search(i,function(l){return l.cc<f?1:l.cc>f?-1:0})}function A(o,l,n){var f=!1;return l&&l.details&&n&&(n.endCC>n.startCC||o&&o.cc<n.startCC)&&(f=!0),f}function h(s,l){var o=s.fragments,f=l.fragments;if(!f.length||!o.length){return void w.logger.log("No fragments to align")}var u=x(o,f[0].cc);return !u||u&&!u.startPTS?void w.logger.log("No frag in previous level to align on"):u}function k(i,f){i&&(f.fragments.forEach(function(e,l){e&&(e.duration=i.duration,e.end=e.endPTS=i.endPTS+e.duration*l,e.start=e.startPTS=i.startPTS+e.start)}),f.PTSKnown=!0)}function y(o,l,n){if(A(o,l,n)){w.logger.log("Adjusting PTS using last level due to CC increase within current level");var f=h(l.details,n);k(f,n)}}Object.defineProperty(g,"__esModule",{value:!0}),g.findFirstFragWithCC=x,g.findFragWithCC=j,g.shouldAlignOnDiscontinuities=A,g.findDiscontinuousReferenceFrag=h,g.adjustPtsByReferenceFrag=k,g.alignDiscontinuities=y;var v=q(45),p=m(v),w=q(51)},{45:45,51:51}],49:[function(m,q,f){function k(i){return i&&i.__esModule?i:{"default":i}}function p(l,i){if(!(l instanceof i)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(f,"__esModule",{value:!0});var h=function(){function i(s,n){for(var o=0;o<n.length;o++){var l=n[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value" in l&&(l.writable=!0),Object.defineProperty(s,l.key,l)}}return function(l,n,e){return n&&i(l.prototype,n),e&&i(l,e),l}}(),u=m(50),g=k(u),j=function(){function i(l,o,e,s){p(this,i),this.hls=l,this.defaultEstimate_=s,this.minWeight_=0.001,this.minDelayMs_=50,this.slow_=new g["default"](o),this.fast_=new g["default"](e)}return h(i,[{key:"sample",value:function(s,n){s=Math.max(s,this.minDelayMs_);var o=8000*n/s,l=s/1000;this.fast_.sample(l,o),this.slow_.sample(l,o)}},{key:"canEstimate",value:function(){var l=this.fast_;return l&&l.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"destroy",value:function(){}}]),i}();f["default"]=j},{50:50}],50:[function(k,h,j){function g(m,i){if(!(m instanceof i)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(j,"__esModule",{value:!0});var f=function(){function i(p,n){for(var o=0;o<n.length;o++){var m=n[o];m.enumerable=m.enumerable||!1,m.configurable=!0,"value" in m&&(m.writable=!0),Object.defineProperty(p,m.key,m)}}return function(m,n,e){return n&&i(m.prototype,n),e&&i(m,e),m}}(),l=function(){function i(e){g(this,i),this.alpha_=e?Math.exp(Math.log(0.5)/e):0,this.estimate_=0,this.totalWeight_=0}return f(i,[{key:"sample",value:function(o,m){var n=Math.pow(this.alpha_,o);this.estimate_=m*(1-n)+n*this.estimate_,this.totalWeight_+=o}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var m=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/m}return this.estimate_}}]),i}();j["default"]=l},{}],51:[function(m,v,f){function k(){}function p(l,i){return i="["+l+"] > "+i}function h(l){var i=self.console[l];return i?function(){for(var o=arguments.length,e=Array(o),s=0;s<o;s++){e[s]=arguments[s]}e[0]&&(e[0]=p(l,e[0])),i.apply(self.console,e)}:k}function w(s){for(var n=arguments.length,o=Array(n>1?n-1:0),l=1;l<n;l++){o[l-1]=arguments[l]}o.forEach(function(e){q[e]=s[e]?s[e].bind(s):h(e)})}Object.defineProperty(f,"__esModule",{value:!0});var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},j={trace:k,debug:k,log:k,warn:k,info:k,error:k},q=j;f.enableLogs=function(l){if(l===!0||"object"===("undefined"==typeof l?"undefined":g(l))){w(l,"debug","log","info","warn","error");try{q.log()}catch(i){q=j}}else{q=j}},f.logger=q},{}],52:[function(j,g,h){var f={toString:function(n){for(var l="",m=n.length,k=0;k<m;k++){l+="["+n.start(k).toFixed(3)+","+n.end(k).toFixed(3)+"]"}return l}};g.exports=f},{}],53:[function(h,f,g){Object.defineProperty(g,"__esModule",{value:!0}),g["default"]=function(){function p(n){if("string"!=typeof n){return !1}var i=q[n.toLowerCase()];return !!i&&n.toLowerCase()}function l(n){if("string"!=typeof n){return !1}var i=m[n.toLowerCase()];return !!i&&n.toLowerCase()}function o(v){for(var s=1;s<arguments.length;s++){var u=arguments[s];for(var n in u){v[n]=u[n]}}return v}function k(H,C,z){var B=this,F=function(){if("undefined"!=typeof navigator){return/MSIE\s8\.0/.test(navigator.userAgent)}}(),w={};F?B=document.createElement("custom"):w.enumerable=!0,B.hasBeenReset=!1;var L="",K=!1,M=H,I=C,t=z,J=null,A="",r=!0,D="auto",e="start",x=50,G=50,N="middle";if(Object.defineProperty(B,"id",o({},w,{get:function(){return L},set:function(i){L=""+i}})),Object.defineProperty(B,"pauseOnExit",o({},w,{get:function(){return K},set:function(i){K=!!i}})),Object.defineProperty(B,"startTime",o({},w,{get:function(){return M},set:function(i){if("number"!=typeof i){throw new TypeError("Start time must be set to a number.")}M=i,this.hasBeenReset=!0}})),Object.defineProperty(B,"endTime",o({},w,{get:function(){return I},set:function(i){if("number"!=typeof i){throw new TypeError("End time must be set to a number.")}I=i,this.hasBeenReset=!0}})),Object.defineProperty(B,"text",o({},w,{get:function(){return t},set:function(i){t=""+i,this.hasBeenReset=!0}})),Object.defineProperty(B,"region",o({},w,{get:function(){return J},set:function(i){J=i,this.hasBeenReset=!0}})),Object.defineProperty(B,"vertical",o({},w,{get:function(){return A},set:function(i){var n=p(i);if(n===!1){throw new SyntaxError("An invalid or illegal string was specified.")}A=n,this.hasBeenReset=!0}})),Object.defineProperty(B,"snapToLines",o({},w,{get:function(){return r},set:function(i){r=!!i,this.hasBeenReset=!0}})),Object.defineProperty(B,"line",o({},w,{get:function(){return D},set:function(i){if("number"!=typeof i&&i!==j){throw new SyntaxError("An invalid number or illegal string was specified.")}D=i,this.hasBeenReset=!0}})),Object.defineProperty(B,"lineAlign",o({},w,{get:function(){return e},set:function(n){var i=l(n);if(!i){throw new SyntaxError("An invalid or illegal string was specified.")}e=i,this.hasBeenReset=!0}})),Object.defineProperty(B,"position",o({},w,{get:function(){return x},set:function(i){if(i<0||i>100){throw new Error("Position must be between 0 and 100.")}x=i,this.hasBeenReset=!0}})),Object.defineProperty(B,"size",o({},w,{get:function(){return G},set:function(i){if(i<0||i>100){throw new Error("Size must be between 0 and 100.")}G=i,this.hasBeenReset=!0}})),Object.defineProperty(B,"align",o({},w,{get:function(){return N},set:function(n){var i=l(n);if(!i){throw new SyntaxError("An invalid or illegal string was specified.")}N=i,this.hasBeenReset=!0}})),B.displayState=void 0,F){return B}}if("undefined"!=typeof window&&window.VTTCue){return window.VTTCue}var j="auto",q={"":!0,lr:!0,rl:!0},m={start:!0,middle:!0,end:!0,left:!0,right:!0};return k.prototype.getCueAsHTML=function(){var i=window.WebVTT;return i.convertCueToDOMTree(window,this.text)},k}()},{}],54:[function(x,D,g){function p(f){return f&&f.__esModule?f:{"default":f}}function A(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new z,this.regionList=[]}function k(i){function f(s,n,o,l){return 3600*(0|s)+60*(0|n)+(0|o)+(0|l)/1000}var h=i.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return h?h[3]?f(h[1],h[2],h[3].replace(":",""),h[4]):h[1]>59?f(h[1],h[2],0,h[4]):f(0,h[1],h[2],h[4]):null}function E(){this.values=Object.create(null)}function j(G,I,f,F){var H=F?G.split(F):[G];for(var u in H){if("string"==typeof H[u]){var J=H[u].split(f);if(2===J.length){var h=J[0],v=J[1];I(h,v)}}}}function m(F,s,v){function o(){var e=k(F);if(null===e){throw new Error("Malformed timestamp: "+n)}return F=F.replace(/^[^\sa-zA-Z-]+/,""),e}function h(G,u){var r=new E;j(G,function(K,I){switch(K){case"region":for(var i=v.length-1;i>=0;i--){if(v[i].id===I){r.set(K,v[i].region);break}}break;case"vertical":r.alt(K,I,["rl","lr"]);break;case"line":var L=I.split(","),J=L[0];r.integer(K,J),r.percent(K,J)&&r.set("snapToLines",!1),r.alt(K,J,["auto"]),2===L.length&&r.alt("lineAlign",L[1],["start",B,"end"]);break;case"position":L=I.split(","),r.percent(K,L[0]),2===L.length&&r.alt("positionAlign",L[1],["start",B,"end","line-left","line-right","auto"]);break;case"size":r.percent(K,I);break;case"align":r.alt(K,I,["start",B,"end","left","right"])}},/:/,/\s/),u.region=r.get("region",null),u.vertical=r.get("vertical","");var l=r.get("line","auto");"auto"===l&&q.line===-1&&(l=-1),u.line=l,u.lineAlign=r.get("lineAlign","start"),u.snapToLines=r.get("snapToLines",!0),u.size=r.get("size",100),u.align=r.get("align",B);var H=r.get("position","auto");"auto"===H&&50===q.position&&(H="start"===u.align||"left"===u.align?0:"end"===u.align||"right"===u.align?100:50),u.position=H}function f(){F=F.replace(/^\s+/,"")}var n=F;if(f(),s.startTime=o(),f(),"-->"!==F.substr(0,3)){throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n)}F=F.substr(3),f(),s.endTime=o(),f(),h(F,s)}function C(f){return f.replace(/<br(?: \/)?>/gi,"\n")}Object.defineProperty(g,"__esModule",{value:!0}),g.fixLineBreaks=void 0;var y=x(53),w=p(y),z=function(){return{decode:function(f){if(!f){return""}if("string"!=typeof f){throw new Error("Error - expected string data.")}return decodeURIComponent(encodeURIComponent(f))}}};E.prototype={set:function(h,f){this.get(h)||""===f||(this.values[h]=f)},get:function(i,f,h){return h?this.has(i)?this.values[i]:f[h]:this.has(i)?this.values[i]:f},has:function(f){return f in this.values},alt:function(n,h,l){for(var f=0;f<l.length;++f){if(h===l[f]){this.set(n,h);break}}},integer:function(h,f){/^-?\d+$/.test(f)&&this.set(h,parseInt(f,10))},percent:function(i,f){var h;return !!((h=f.match(/^([\d]{1,3})(\.[\d]*)?%$/))&&(f=parseFloat(f),f>=0&&f<=100))&&(this.set(i,f),!0)}};var q=new w["default"](0,0,0),B="middle"===q.align?"middle":"center";A.prototype={parse:function(o){function G(){var s=l.buffer,i=0;for(s=C(s);i<s.length&&"\r"!==s[i]&&"\n"!==s[i];){++i}var n=s.substr(0,i);return"\r"===s[i]&&++i,"\n"===s[i]&&++i,l.buffer=s.substr(i),n}function f(i){j(i,function(r,n){switch(r){case"Region":console.log("parse region",n)}},/:/)}var l=this;o&&(l.buffer+=l.decoder.decode(o,{stream:!0}));try{var F;if("INITIAL"===l.state){if(!/\r\n|\n/.test(l.buffer)){return this}F=G();var h=F.match(/^WEBVTT([ \t].*)?$/);if(!h||!h[0]){throw new Error("Malformed WebVTT signature.")}l.state="HEADER"}for(var H=!1;l.buffer;){if(!/\r\n|\n/.test(l.buffer)){return this}switch(H?H=!1:F=G(),l.state){case"HEADER":/:/.test(F)?f(F):F||(l.state="ID");continue;case"NOTE":F||(l.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(F)){l.state="NOTE";break}if(!F){continue}if(l.cue=new w["default"](0,0,""),l.state="CUE",F.indexOf("-->")===-1){l.cue.id=F;continue}case"CUE":try{m(F,l.cue,l.regionList)}catch(u){l.cue=null,l.state="BADCUE";continue}l.state="CUETEXT";continue;case"CUETEXT":var v=F.indexOf("-->")!==-1;if(!F||v&&(H=!0)){l.oncue&&l.oncue(l.cue),l.cue=null,l.state="ID";continue}l.cue.text&&(l.cue.text+="\n"),l.cue.text+=F;continue;case"BADCUE":F||(l.state="ID");continue}}}catch(u){"CUETEXT"===l.state&&l.cue&&l.oncue&&l.oncue(l.cue),l.cue=null,l.state="INITIAL"===l.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var h=this;try{if(h.buffer+=h.decoder.decode(),(h.cue||"HEADER"===h.state)&&(h.buffer+="\n\n",h.parse()),"INITIAL"===h.state){throw new Error("Malformed WebVTT signature.")}}catch(f){throw f}return h.onflush&&h.onflush(),this}},g.fixLineBreaks=C,g["default"]=A},{53:53}],55:[function(m,v,f){function k(i){return i&&i.__esModule?i:{"default":i}}var p=m(54),h=k(p),w=function(n,i,l){return n.substr(l||0,i.length)===i},g=function(u){var o=parseInt(u.substr(-3)),s=parseInt(u.substr(-6,2)),n=parseInt(u.substr(-9,2)),l=u.length>9?parseInt(u.substr(0,u.indexOf(":"))):0;return isNaN(o)||isNaN(s)||isNaN(n)||isNaN(l)?-1:(o+=1000*s,o+=60000*n,o+=3600000*l)},j=function(u,o,s){var n=u[o],l=u[n.prevCC];if(!l||!l["new"]&&n["new"]){return u.ccOffset=u.presentationOffset=n.start,void (n["new"]=!1)}for(;l&&l["new"];){u.ccOffset+=n.start-l.start,n["new"]=!1,n=l,l=u[n.prevCC]}u.presentationOffset=s},q={parse:function(C,J,l,x,G,I){var D=/\r\n|\n\r|\n|\r/g,B=String.fromCharCode.apply(null,new Uint8Array(C)).trim().replace(D,"\n").split("\n"),E="00:00.000",z=0,H=0,A=0,n=[],F=void 0,o=!0,s=new h["default"];s.oncue=function(u){var r=l[x],i=l.ccOffset;r&&r["new"]&&(H?i=l.ccOffset=r.start:j(l,x,A)),A&&!H&&(i=A+l.ccOffset-l.presentationOffset),u.startTime+=i-H,u.endTime+=i-H,u.text=decodeURIComponent(escape(u.text)),u.endTime>0&&n.push(u)},s.onparsingerror=function(i){F=i},s.onflush=function(){return F&&I?void I(F):void G(n)},B.forEach(function(t){if(o){if(w(t,"X-TIMESTAMP-MAP=")){o=!1,t.substr(16).split(",").forEach(function(r){w(r,"LOCAL:")?E=r.substr(6):w(r,"MPEGTS:")&&(z=parseInt(r.substr(7)))});try{J=J<0?J+8589934592:J,z-=J,H=g(E)/1000,A=z/90000,H===-1&&(F=new Error("Malformed X-TIMESTAMP-MAP: "+t))}catch(i){F=new Error("Malformed X-TIMESTAMP-MAP: "+t)}return}""===t&&(o=!1)}s.parse(t+"\n")}),s.flush()}};v.exports=q},{54:54}],56:[function(l,h,k){function g(n,i){if(!(n instanceof i)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(k,"__esModule",{value:!0});var f=function(){function i(q,o){for(var p=0;p<o.length;p++){var n=o[p];n.enumerable=n.enumerable||!1,n.configurable=!0,"value" in n&&(n.writable=!0),Object.defineProperty(q,n.key,n)}}return function(n,o,e){return o&&i(n.prototype,o),e&&i(n,e),n}}(),m=l(51),j=function(){function i(e){g(this,i),e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}return f(i,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var n=this.loader;n&&4!==n.readyState&&(this.stats.aborted=!0,n.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"load",value:function(p,n,o){this.context=p,this.config=n,this.callbacks=o,this.stats={trequest:performance.now(),retry:0},this.retryDelay=n.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var s,p=this.context;s="undefined"!=typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest;var q=this.stats;q.tfirst=0,q.loaded=0;var o=this.xhrSetup;try{if(o){try{o(s,p.url)}catch(n){s.open("GET",p.url,!0),o(s,p.url)}}s.readyState||s.open("GET",p.url,!0)}catch(n){return void this.callbacks.onError({code:s.status,text:n.message},p)}p.rangeEnd&&s.setRequestHeader("Range","bytes="+p.rangeStart+"-"+(p.rangeEnd-1)),s.onreadystatechange=this.readystatechange.bind(this),s.onprogress=this.loadprogress.bind(this),s.responseType=p.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),s.send()}},{key:"readystatechange",value:function(w){var A=w.currentTarget,n=A.readyState,v=this.stats,y=this.context,B=this.config;if(!v.aborted&&n>=2){if(window.clearTimeout(this.requestTimeout),0===v.tfirst&&(v.tfirst=Math.max(performance.now(),v.trequest)),4===n){var p=A.status;if(p>=200&&p<300){v.tload=Math.max(v.tfirst,performance.now());var q=void 0,z=void 0;"arraybuffer"===y.responseType?(q=A.response,z=q.byteLength):(q=A.responseText,z=q.length),v.loaded=v.total=z;var x={url:A.responseURL,data:q};this.callbacks.onSuccess(x,v,y)}else{v.retry>=B.maxRetry||p>=400&&p<499?(m.logger.error(p+" while loading "+y.url),this.callbacks.onError({code:p,text:A.statusText},y)):(m.logger.warn(p+" while loading "+y.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,B.maxRetryDelay),v.retry++)}}else{this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),B.timeout)}}}},{key:"loadtimeout",value:function(){m.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context)}},{key:"loadprogress",value:function(p){var n=this.stats;n.loaded=p.loaded,p.lengthComputable&&(n.total=p.total);var o=this.callbacks.onProgress;o&&o(n,this.context,null)}}]),i}();k["default"]=j},{51:51}]},{},[37])(37)})}});